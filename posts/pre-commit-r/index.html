<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Neil Shephard">
<meta name="dcterms.date" content="2023-07-29">

<title>Pre-commit and R Packaging – blog.nshephard.dev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-79bb3942e891885f9f7af119cd221462.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2c4fe801cce5de4490d2fc2b466292bf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<link rel="alternate" type="application/rss+xml" title="blog.nshephard.dev" href="index.xml" data-external="1"></head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">blog.nshephard.dev</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../links.html"> 
<span class="menu-text">Links</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ns-rse" rel="me"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://gitlab.com/nshephard" rel="me"> <i class="bi bi-gitlab" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://forgejo.nshephard.dev"> 
<span class="menu-text"><img src="img/forgejo-monochrome.svg" class="img-fluid"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://codeberg.org/slackline"> 
<span class="menu-text"><img src="img/codeberg-logo_icon_white.svg" class="img-fluid"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="me"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@nshephard" rel="me"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0001-8301-6857" rel="me"> 
<span class="menu-text"><img src="img/codeberg-logo_icon_white.svg" class="img-fluid"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Pre-commit and R Packaging</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">quarto</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">git</div>
                <div class="quarto-category">pre-commit</div>
                <div class="quarto-category">github actions</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Neil Shephard <a href="https://orcid.org/0000-0001-8301-6857" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 29, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pre-commit" id="toc-pre-commit" class="nav-link active" data-scroll-target="#pre-commit">pre-commit</a>
  <ul>
  <li><a href="#codemetar" id="toc-codemetar" class="nav-link" data-scroll-target="#codemetar">codemetar</a></li>
  <li><a href="#roxygenize" id="toc-roxygenize" class="nav-link" data-scroll-target="#roxygenize">roxygenize</a></li>
  <li><a href="#style-files" id="toc-style-files" class="nav-link" data-scroll-target="#style-files">style-files</a></li>
  <li><a href="#lintr" id="toc-lintr" class="nav-link" data-scroll-target="#lintr">lintr</a></li>
  <li><a href="#spell-check" id="toc-spell-check" class="nav-link" data-scroll-target="#spell-check"><code>spell-check</code></a></li>
  <li><a href="#deps-in-desc" id="toc-deps-in-desc" class="nav-link" data-scroll-target="#deps-in-desc"><code>deps-in-desc</code></a></li>
  </ul></li>
  <li><a href="#usethis-package" id="toc-usethis-package" class="nav-link" data-scroll-target="#usethis-package">usethis package</a>
  <ul>
  <li><a href="#readme.rmd" id="toc-readme.rmd" class="nav-link" data-scroll-target="#readme.rmd"><code>README.Rmd</code></a></li>
  <li><a href="#use_github_action" id="toc-use_github_action" class="nav-link" data-scroll-target="#use_github_action"><code>use_github_action()</code></a></li>
  <li><a href="#badges" id="toc-badges" class="nav-link" data-scroll-target="#badges">Badges</a></li>
  </ul></li>
  <li><a href="#gotchas" id="toc-gotchas" class="nav-link" data-scroll-target="#gotchas">Gotchas</a>
  <ul>
  <li><a href="#the-following-spelling-errors-were-found" id="toc-the-following-spelling-errors-were-found" class="nav-link" data-scroll-target="#the-following-spelling-errors-were-found"><code>The following spelling errors were found:</code></a></li>
  <li><a href="#codemeta.json-is-out-of-date" id="toc-codemeta.json-is-out-of-date" class="nav-link" data-scroll-target="#codemeta.json-is-out-of-date"><code>! codemeta.json is out of date</code></a></li>
  <li><a href="#warning-undocumented-code-objects" id="toc-warning-undocumented-code-objects" class="nav-link" data-scroll-target="#warning-undocumented-code-objects"><code>Warning: Undocumented code objects:</code></a></li>
  </ul></li>
  <li><a href="#windows" id="toc-windows" class="nav-link" data-scroll-target="#windows">Windows</a>
  <ul>
  <li><a href="#install-r" id="toc-install-r" class="nav-link" data-scroll-target="#install-r">Install R</a></li>
  <li><a href="#install-rstudio" id="toc-install-rstudio" class="nav-link" data-scroll-target="#install-rstudio">Install Rstudio</a></li>
  <li><a href="#install-gitbash" id="toc-install-gitbash" class="nav-link" data-scroll-target="#install-gitbash">Install GitBash</a>
  <ul class="collapse">
  <li><a href="#configure-git" id="toc-configure-git" class="nav-link" data-scroll-target="#configure-git">Configure Git</a></li>
  </ul></li>
  <li><a href="#configure-rstudiogithub-with-ssh-keys" id="toc-configure-rstudiogithub-with-ssh-keys" class="nav-link" data-scroll-target="#configure-rstudiogithub-with-ssh-keys">Configure RStudio/GitHub with SSH keys</a></li>
  <li><a href="#clone-repository" id="toc-clone-repository" class="nav-link" data-scroll-target="#clone-repository">Clone Repository</a></li>
  <li><a href="#install-pre-commit" id="toc-install-pre-commit" class="nav-link" data-scroll-target="#install-pre-commit">Install <code>pre-commit</code></a>
  <ul class="collapse">
  <li><a href="#install-precommit-and-reticulate" id="toc-install-precommit-and-reticulate" class="nav-link" data-scroll-target="#install-precommit-and-reticulate">Install <code>precommit</code> and <code>reticulate</code></a></li>
  <li><a href="#install-miniconda-environment" id="toc-install-miniconda-environment" class="nav-link" data-scroll-target="#install-miniconda-environment">Install Miniconda environment</a></li>
  <li><a href="#install-pre-commit-framework" id="toc-install-pre-commit-framework" class="nav-link" data-scroll-target="#install-pre-commit-framework">Install <code>pre-commit</code> framework</a></li>
  <li><a href="#use-precommit-with-the-existing-project" id="toc-use-precommit-with-the-existing-project" class="nav-link" data-scroll-target="#use-precommit-with-the-existing-project">Use <code>precommit</code> with the existing project</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#links" id="toc-links" class="nav-link" data-scroll-target="#links">Links</a>
  <ul>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages">R Packages</a></li>
  <li><a href="#python" id="toc-python" class="nav-link" data-scroll-target="#python">Python</a></li>
  <li><a href="#pre-commit-1" id="toc-pre-commit-1" class="nav-link" data-scroll-target="#pre-commit-1">Pre-commit</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This post is aimed at getting you up and running with the R <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">precommit</a> Package. This shouldn’t be confused with the Python <a href="https://ns-rse.github.io/pre-commit" target="_blank">pre-commit</a> Package although as you might suspect they are closely related.</p>
<p>The R package (<code>precommit</code>) consists of a number of R specific hooks that are run by <code>pre-commit</code> before commits are made and check various aspects of your code for compliance with certain style and coding standards (mostly aspects of R packages and I’ll be posting more on R packaging in due course).</p>
<p>A major part of this post is about getting things setup on Windows, I’ve only given a light overview of some of the hooks and common problems encountered as I’ve gone about using and learning R packaging because not everyone uses Windows.</p>
<p>Most of the work on the R package is by <a href="https://github.com/lorenzwalthert/" target="_blank">Lorenz Walthert</a>, if you find it useful consider sponsoring his work, these things take a lot of time and effort and whilst they can be used for free are worth supporting.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/52985095726_49c5b394f1_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://flickr.com/photos/slackline/52985095726/" target="_blank">Erwin Wurm sculpture at Yorkshire Sculpture Park</a> by me</figcaption>
</figure>
</div>
<section id="pre-commit" class="level2">
<h2 class="anchored" data-anchor-id="pre-commit">pre-commit</h2>
<p>I love using <a href="https://pre-commit.com" target="_blank">pre-commit</a> in my development pipelines and have <a href="https://ns-rse.github.io/#category=pre-commit" target="_blank">blogged about it</a> a few times already. It saves so much hassle (once you are used to it) not just for yourself but also your collaborators who are reviewing your Pull Requests. The <a href="https://github.com/lorenzwalthert/precommit" target="_blank">R precommit package</a> comes with a set of hooks that can be enabled and configured individually. I’ve recently and reason to start making and R package and as I’ve not used R much for a few years and this was my first time attempting to develop a package, I decided to use the hooks to impose the various style standards and checks that are expected.</p>
<p>I opted to enable <em>all</em> of the hooks. I’ve not covered them all here in detail (yet) but describe some of them below and show how to use some additional hooks from the <a href="https://usethis.r-lib.org" target="_blank">usethis</a> package too.</p>
<section id="codemetar" class="level3">
<h3 class="anchored" data-anchor-id="codemetar">codemetar</h3>
<p>There is a hook for checking the <a href="https://codemeta.github.io/" target="_blank">Codemeta</a>, which is in JSON-LD format is created correctly. The R package <a href="https://cran.r-project.org/web//packages//codemetar/vignettes/codemetar.html" target="_blank">codemetar</a> facilitates creating this and pulls metadata from the <code>DESCRIPTION</code>, <code>README.Rmd</code> and other aspects of your package to format them in JSON Codemeta. It comes with a handy function to write the file for you, so after installing you can just run <code>codemetar::write_codemeta()</code> which will create the <code>codemeta.json</code> for you. Remember to run this each and every time you update and of the files from which the metadata is created (although keep an eye on <a href="https://github.com/lorenzwalthert/precommit/issues/491" target="_blank">#491</a> which suggests updating automatically)</p>
</section>
<section id="roxygenize" class="level3">
<h3 class="anchored" data-anchor-id="roxygenize">roxygenize</h3>
<p><a href="https://roxygen2.r-lib.org/" target="_blank">Roxygen2</a> is a package for making the documentation to go with your package, it does this by parsing the documentation strings (“docstrings” for short) that you adorn your functions with that describe the arguments and show example usages. This hook requires additional configuration in <code>.pre-commit-config.yaml</code> as you have to install your package dependencies. Fortunately there is a helper function in the <code>precommit</code> package so you can just run <code>precommit::snippet_generate("additional-deps-roxygenize")</code> and it will output the YAML that you need to add to your <code>.pre-commit-config.yaml</code>. It might look something like the following.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> no-debug-statement</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> roxygenize</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">additional_dependencies</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    data.table</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    dplyr</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    dtplyr</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    duckdb</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    IMD</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    lubridate</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at">    stringr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="style-files" class="level3">
<h3 class="anchored" data-anchor-id="style-files">style-files</h3>
<p>The <code>style-files</code> hook runs the <a href="https://styler.r-lib.org/" target="_blank">styler</a> package against your code to ensure it follows the <a href="https://style.tidyverse.org/" target="_blank">tidyverse style guide</a> by default, although it can be configured to use a custom style guide of your own creation.</p>
</section>
<section id="lintr" class="level3">
<h3 class="anchored" data-anchor-id="lintr">lintr</h3>
<p>The <a href="https://lintr.r-lib.org/" target="_blank">lintr</a> package lints your code automatically. It can be configured by adding a <code>.lintr</code> configuration file to your repository, a simple example is shown below. Note the indented closing parenthesis is important you get a complaint about that and any other formatting issues.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>linters<span class="sc">:</span> <span class="fu">linters_with_defaults</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">line_length_linter</span>(<span class="dv">120</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">object_name_linter =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">object_usage_linter =</span> <span class="cn">NULL</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="spell-check" class="level3">
<h3 class="anchored" data-anchor-id="spell-check"><code>spell-check</code></h3>
<p>This is a useful hook that checks your spelling and adds unusual words to a custom dictionary <code>inst/WORDLIST</code>.</p>
</section>
<section id="deps-in-desc" class="level3">
<h3 class="anchored" data-anchor-id="deps-in-desc"><code>deps-in-desc</code></h3>
<p>This hook ensures that all dependencies that are loaded by your package are listed in the <code>DESCRIPTION</code> file so that when the package is installed the necessary dependencies are also pulled in, fairly essential..</p>
</section>
</section>
<section id="usethis-package" class="level2">
<h2 class="anchored" data-anchor-id="usethis-package">usethis package</h2>
<p>The <a href="https://usethis.r-lib.org" target="_blank">usethis</a> package is a compliment to the <a href="https://devtools.r-lib.org" target="_blank">devtools</a> package that has a lot of very useful helper functions. Some of these enable additional <code>pre-commit</code> hooks whilst others enable GitHub actions, which are part of Continuous Integration pipelines and I would highly recommend enabling them.</p>
<section id="readme.rmd" class="level3">
<h3 class="anchored" data-anchor-id="readme.rmd"><code>README.Rmd</code></h3>
<p>The <a href="https://usethis.r-lib.org/reference/use_readme_rmd.html" target="_blank"><code>user_readme_rmd()</code></a> function automatically generates a <code>README.Rmd</code> template and will also create a <code>pre-commit</code> hook that keeps it synchronised with <code>README.md</code> whenever you update it. This is useful because the later, plain-markdown, file is automatically rendered by GitHub/GitLab/Codeberg as your repositories front-page.</p>
</section>
<section id="use_github_action" class="level3">
<h3 class="anchored" data-anchor-id="use_github_action"><code>use_github_action()</code></h3>
<p>Invoking <code>use_github_action()</code> within your package repository will prompt you for the type of action you wish to add to it. There are, as of writing, three options.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="sc">&gt;</span> <span class="fu">use_github_action</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    Which action do you want to add? (<span class="dv">0</span> to exit)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    (See <span class="sc">&lt;</span>https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>actions<span class="sc">/</span>tree<span class="sc">/</span>v2<span class="sc">/</span>examples<span class="sc">&gt;</span> <span class="cf">for</span> other options)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span> check<span class="sc">-</span>standard<span class="sc">:</span> Run <span class="st">`</span><span class="at">R CMD check</span><span class="st">`</span> on Linux, macOS, and Windows</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span><span class="sc">:</span> test<span class="sc">-</span>coverage<span class="sc">:</span> Compute test coverage and report to https<span class="sc">:</span><span class="er">//</span>about.codecov.io</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span><span class="sc">:</span> pr<span class="sc">-</span>commands<span class="sc">:</span> Add <span class="sc">/</span>document and <span class="sc">/</span>style commands <span class="cf">for</span> pull requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Selecting one will write a file to <code>/.github/workflows/&lt;FILENAME&gt;.yaml</code> and then print out code to add a badge to your repository.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Selection<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    ✔ Adding <span class="st">'*.html'</span> to <span class="st">'.github/.gitignore'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    ✔ Creating <span class="st">'.github/workflows/'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    ✔ Saving <span class="st">'r-lib/actions/examples/check-standard.yaml@v2'</span> to <span class="st">'.github/workflows/R-CMD-check.yaml'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    • Learn more at <span class="sc">&lt;</span>https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>actions<span class="sc">/</span>blob<span class="sc">/</span>v2<span class="sc">/</span>examples<span class="sc">/</span>README.md<span class="sc">&gt;</span>.</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    • Copy and paste the following lines into <span class="st">'README.Rmd'</span><span class="sc">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="er">&lt;</span><span class="sc">!--</span> badges<span class="sc">:</span> start <span class="sc">-</span><span class="ot">-&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      [<span class="sc">!</span>[R<span class="sc">-</span>CMD<span class="sc">-</span>check](https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>CUREd<span class="sc">-</span>Plus<span class="sc">/</span>cuRed<span class="sc">/</span>actions<span class="sc">/</span>workflows<span class="sc">/</span>R<span class="sc">-</span>CMD<span class="sc">-</span>check.yaml<span class="sc">/</span>badge.svg)](https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>CUREd<span class="sc">-</span>Plus<span class="sc">/</span>cuRed<span class="sc">/</span>actions<span class="sc">/</span>workflows<span class="sc">/</span>R<span class="sc">-</span>CMD<span class="sc">-</span>check.yaml)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;!--</span> badges<span class="sc">:</span> end <span class="sc">-</span><span class="ot">-&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      [Copied to clipboard]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="badges" class="level3">
<h3 class="anchored" data-anchor-id="badges">Badges</h3>
<p>Most of the GitHub Action functions described above include output that can be copy and pasted into <code>README.Rmd</code> to include badges in your GitHub front page. Again the <a href="https://usethis.r-lib.org/reference/badges.html" target="_blank">usethis</a> has you covered and can generate the necessary code for the different badges it supports.</p>
</section>
</section>
<section id="gotchas" class="level2">
<h2 class="anchored" data-anchor-id="gotchas">Gotchas</h2>
<p>When starting out I found that I regularly didn’t pass the <code>pre-commit</code> hooks first time. This can be jarring and confusing to start with but its not something to worry about, they are there to ensure your code and package meet the standards required. If you ever come to submit to <a href="https://cran.r-project.org" target="_blank">CRAN</a> you will be grateful to have adhered to these standards.</p>
<p>Below I detail common “gotchas” I encountered when developing the package, what they mean and how to resolve them.</p>
<section id="the-following-spelling-errors-were-found" class="level3">
<h3 class="anchored" data-anchor-id="the-following-spelling-errors-were-found"><code>The following spelling errors were found:</code></h3>
<p>The <code>spell-check</code> hook <em>will</em> fail if you’ve introduced new words that aren’t in standard dictionaries with messages similar to the those shown below. Sometimes these will be new words, sometimes they might be catching typos you have made. In the example below <code>famiy</code> should be <code>family</code> so you need to correct the source of the typo (and you’re told where this is, in this case it was line 27 of <code>CITATION.cff</code>), or if the new word should be added to the dictionary you will have to stage the updated <code>inst/WORDLIST</code> file for inclusion in your commit.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">spell-check..............................................................Failed</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> hook id: spell-check</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> exit code: 1</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> files were modified by this hook</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ℹ</span> Using R 4.3.1 <span class="er">(</span><span class="fu">lockfile</span> was generated with R 4.2.1<span class="kw">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ℹ</span> Using R 4.3.1 <span class="er">(</span><span class="fu">lockfile</span> was generated with R 4.2.1<span class="kw">)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following spelling errors were found:</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">WORD</span>    FOUND IN</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">famiy</span>   CITATION.cff:27</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">All</span> spelling errors found were copied to inst/WORDLIST assuming they were not spelling errors and will be ignored in the future. Please  review the above list and for each word that is an actual typo:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> fix it in the source code.</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> remove it again manually from inst/WORDLIST to make sure it<span class="st">'s not</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="st">   ignored in the future.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="st"> Then, try committing again.</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="st">Error: Spell check failed</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">Execution halted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="codemeta.json-is-out-of-date" class="level3">
<h3 class="anchored" data-anchor-id="codemeta.json-is-out-of-date"><code>! codemeta.json is out of date</code></h3>
<p>If you modify the <code>DESCRIPTION</code> or <code>CITATION.cff</code> then the <code>codemeta-description-updated</code> hook <em>will</em> fail with error messages similar to the following.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">codemeta-description-updated.............................................Failed</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> hook id: codemeta-description-updated</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> exit code: 1</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ℹ</span> Using R 4.3.1 <span class="er">(</span><span class="fu">lockfile</span> was generated with R 4.2.1<span class="kw">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ℹ</span> Using R 4.3.1 <span class="er">(</span><span class="fu">lockfile</span> was generated with R 4.2.1<span class="kw">)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Error:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ot">! </span><span class="ex">codemeta.json</span> is out of date<span class="kw">;</span> <span class="ex">please</span> re-run codemetar::write_codemeta<span class="er">(</span><span class="kw">)</span><span class="bu">.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Backtrace:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">▆</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">1.</span> └─rlang::abort<span class="er">(</span><span class="st">"codemeta.json is out of date; please re-run codemetar::write_codemeta()."</span><span class="kw">)</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Execution</span> halted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This means yo need to update the <code>codemeta.json</code> with</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>codemetar<span class="sc">::</span><span class="fu">write_codemeta</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="warning-undocumented-code-objects" class="level3">
<h3 class="anchored" data-anchor-id="warning-undocumented-code-objects"><code>Warning: Undocumented code objects:</code></h3>
<p>If this error arises its because there is a <code>.Rd</code> file missing. You can generate these by ensuring you have the appropriate docstring definition prior to your function and then use the <code>roxygen2::reoxygenise()</code> function to generate the documentation automatically. Don’t forget to <code>git stage</code> and <code>git commit</code> the files to your repository, pushing if needed (e.g.&nbsp;a Continuous Integration pipeline is failing).</p>
</section>
</section>
<section id="windows" class="level2">
<h2 class="anchored" data-anchor-id="windows">Windows</h2>
<p>I haven’t used Windows for about 23 years but I often have colleagues who do and that was the case with the R package that I have started developing so I needed to get all members of the team up and running with the <code>precommit</code> R package/pipeline.</p>
<p>Windows doesn’t come with Python by default, but <a href="https://pre-commit.com" target="_blank">pre-commit</a> is written in Python and so an environment is required in order to run the above pre-commit hooks. There are many options for this, including using <a href="https://learn.microsoft.com/en-us/windows/wsl/install" target="_blank">Windows Subsystem for Linux (WSL)</a>. I opted to try the solution provided in the <a href="https://cran.r-project.org/web/packages/precommit/vignettes/precommit.html" target="_blank">precommit vignette</a>. This shows how to use the <a href="https://rstudio.github.io/reticulate/" target="_blank">reticulate</a> package which acts as a glue between <a href="https://r-project.org" target="_blank">R</a> and <a href="https://python.org" target="_blank">Python</a>, to handle installing a <a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a> environment and setting up <code>precommit</code>/<code>pre-commit</code>.</p>
<p>The following runs you through the things you need to install (R, RStudio, GitBash), setting up GitHub with <a href="https://ns-rse.github.io/#category=ssh" target="_blank">SSH</a> keys and enabling <code>precommit</code> for your R package locally.</p>
<section id="install-r" class="level3">
<h3 class="anchored" data-anchor-id="install-r">Install <a href="https://www.r-project.org" target="_blank">R</a></h3>
<p>When installing the defaults are fine, request admin permissions if required.</p>
</section>
<section id="install-rstudio" class="level3">
<h3 class="anchored" data-anchor-id="install-rstudio">Install <a href="https://posit.co/downloads/" target="_blank">Rstudio</a></h3>
<p>Defaults are fine, request admin permissions if required.</p>
</section>
<section id="install-gitbash" class="level3">
<h3 class="anchored" data-anchor-id="install-gitbash">Install <a href="https://git-scm.com/download/win" target="_blank">GitBash</a></h3>
<p>During installation you’ll be asked a number of questions, if you’re unsure how to respond to any of them the following provides guidance.</p>
<ol type="1">
<li><strong>Text Editor</strong> - Configure with your choice of editor, obviously you’ll want to have <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> available and select that! <span class="emoji" data-emoji="wink">😉</span></li>
<li><strong>Adjust your PATH environment</strong> - At the bare minimum go with the <code>Recommended</code> option and allow <em>Git from the command line and also from 3rd-party software</em>. Optionally I would recommend the third option of <em>Use Git and optional UNIX tools from the Command Prompt</em>, particularly if you are either a) familiar with UNIX commands or b) not at all familiar with them (as you won’t have to re-learn the Windows commands, just learn the Bash commands they are more widely applicable).</li>
<li><strong>Use Bundled SSH library</strong> - Use the bundled SSH library.</li>
<li><strong>Use Bundled OpenSSL library</strong> - Use the bundled OpenSSL library.</li>
<li><strong>Checkout Windows-style, commit Unix-style line endings</strong> - This is fine, it just changes the internal representation of the carriage return to be more universal.</li>
<li><strong>Use MinTTY</strong> - The default terminal of MSYS2 is fine and more functional than the Windows’ default console window.</li>
<li><strong>Default Merge behaviour</strong> - The default (fast-forward or merge) this is fine.</li>
<li><strong>Choose a credential helper</strong> - Select <em>None</em> here, we will let RStudio manage these.</li>
<li><strong>Configure Extra Options</strong> - Defaults are fine.</li>
<li><strong>Configuring experimental options</strong> - No need to enable any of these.</li>
</ol>
<section id="configure-git" class="level4">
<h4 class="anchored" data-anchor-id="configure-git">Configure Git</h4>
<p>Start a GitBash shell and configure your email address and name.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.email <span class="st">"you@example.com"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.name <span class="st">"Your Name"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="configure-rstudiogithub-with-ssh-keys" class="level3">
<h3 class="anchored" data-anchor-id="configure-rstudiogithub-with-ssh-keys">Configure RStudio/GitHub with SSH keys</h3>
<ol type="1">
<li>Start RStudio</li>
<li>Create SSH key - Navigate to <em>Tools &gt; General Options &gt; Git/SVN &gt; Create SSH Key</em> and under <em>SSH key type</em> select the default (<em>ED25519</em>) this is a <a href="https://blog.g3rt.nl/upgrade-your-ssh-keys.html" target="_blank">very secure elliptic curve algorithm</a> and is supported by GitHub. Use a secure password (i.e.&nbsp;long), do <strong>not</strong> change the location it is created at.</li>
<li>Once created select <em>View public key</em> and use <em>Ctrl + c</em> to copy this to your clipboard.</li>
<li>Navigate to <a href="https://github.com/" target="_blank">GitHub</a> and login then click on your avatar in the top right and select <em>Settings &gt; SSH and GPG keys &gt; New SSH Key</em>.</li>
<li>Give the key a name and paste into the box below where indicated/instructed then click on <em>Add SSH key</em>.</li>
</ol>
</section>
<section id="clone-repository" class="level3">
<h3 class="anchored" data-anchor-id="clone-repository">Clone Repository</h3>
<p>Its likely that you will have an existing repository that you wish to work on with this pipeline, if so you will have to clone it locally so you can work on it with the <code>precommit</code> pipeline. The following assumes you have added your SSH key to your GitHub account as described above.</p>
<ol type="1">
<li>Navigate to the repository you wish to clone (e.g.&nbsp;<a href="https://github.com/CUREd-Plus/cuRed/" target="_blank">https://github.com/CUREd-Plus/cuRed/</a>) and click on the <em>Code</em> button then select <em>SSH</em> under the <em>Local</em> tab in the box that appears.</li>
<li>Click on the box that has two small squares to the right of some text to copy the URL to clipboard.</li>
<li>Return to RStudio and start a new project with <em>File &gt; New Project &gt; Version Control &gt; Git</em> and paste the URL into the <em>Repository URL</em>. Select a location to clone to under <em>Create project as subdirectory of:</em>, e.g.&nbsp;<code>c:/Users/&lt;username&gt;/work/cuRed</code> (replacing <code>&lt;username&gt;</code> with <em>your</em> username).</li>
<li>If prompted for password enter it. If asked to answer <em>Yes\/No</em> answer <em>Yes</em> and then if prompted to <em>Store password for this session</em> answer <em>Yes</em>.</li>
<li>You should now have cloned the repository and have a project to work on.</li>
</ol>
</section>
<section id="install-pre-commit" class="level3">
<h3 class="anchored" data-anchor-id="install-pre-commit">Install <code>pre-commit</code></h3>
<p>As mentioned above <code>pre-commit</code> refers to two things, primarily it is the Python package <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> that does all the work of running Linting, Tests etc. before making commits. It also refers to an R package <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">precommit</a> (note the omission of the hyphen <code>-</code>) that works with the Python package to enable use of various R packages that carry out such checks. Because it is a Python package it needs a Python Virtual Environment to run. This may sound unfamiliar but don’t worry the R <code>precommit</code> package and documentation guides you through doing so, what follows is a rehash of the <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">official documentation</a>.</p>
<section id="install-precommit-and-reticulate" class="level4">
<h4 class="anchored" data-anchor-id="install-precommit-and-reticulate">Install <code>precommit</code> and <code>reticulate</code></h4>
<p>From RStudio install the <code>remotes</code> and <code>reticulate</code> package, then install the most recent version of <code>precommit</code> directly from GitHub.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"remotes"</span>, <span class="st">"reticulate"</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"lorenzwalthert/precommit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-miniconda-environment" class="level4">
<h4 class="anchored" data-anchor-id="install-miniconda-environment">Install Miniconda environment</h4>
<p>You can now use <code>reticulate</code> to install a <a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a> virtual environment framework for R to run Python packages (i.e.&nbsp;<code>pre-commit</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">600</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">install_miniconda</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-pre-commit-framework" class="level4">
<h4 class="anchored" data-anchor-id="install-pre-commit-framework">Install <code>pre-commit</code> framework</h4>
<p>This step now installs the Python package <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> within a new Miniconda virtual environment (by default <code>r-precommit</code>). There will be a fair bit of output here as all the dependencies in Python for <code>pre-commit</code> are downloaded.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>precommit<span class="sc">::</span><span class="fu">install_precommit</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>precommit<span class="sc">::</span><span class="fu">autoupdate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="use-precommit-with-the-existing-project" class="level4">
<h4 class="anchored" data-anchor-id="use-precommit-with-the-existing-project">Use <code>precommit</code> with the existing project</h4>
<p>You should have cloned the repository you wish to enable <code>precommit</code> to use (see above). You now need to enable <code>precommit</code> for this local copy of the repository. This will place a script in <code>.git/hooks/pre-commit</code> that says which Miniconda environment to use (<code>r-precommit</code>) and will activate this whenever a commit is made, the <code>install_hooks = TRUE</code> ensures that the R specific hooks and their required environments are installed (under <code>\~/.config/pre-commit/</code>).</p>
<p>Make sure you have opened the <code>.Rproj</code> file in RStudio, this ensures you are within the project directory that you want to install <code>precommit</code> to (alternatively used <code>setwd()</code>).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>precommit<span class="sc">::</span><span class="fu">use_precommit</span>(<span class="at">install_hooks =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://r-pkgs.org/" target="_blank">R Packages book by Hadley Wickham and Jenny Bryan</a></li>
<li><a href="https://happygitwithr.com" target="_blank">Happy Git and GitHub for the useR by Jenny Bryan</a></li>
</ul>
<section id="r-packages" class="level3">
<h3 class="anchored" data-anchor-id="r-packages">R Packages</h3>
<ul>
<li><a href="https://devtools.r-lib.org/" target="_blank">devtools</a></li>
<li><a href="https://usethis.r-lib.org" target="_blank">usethis</a></li>
<li><a href="https://roxygen2.r-lib.org/" target="_blank">roxygen2</a></li>
<li><a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">R precommit</a></li>
<li>(<a href="https://github.com/lorenzwalthert/precommit" target="_blank">GitHub | lorenzwalthert/precommit</a> check the <a href="https://github.com/lorenzwalthert/precommit/issues" target="_blank">Issues</a>, can be useful for troubleshooting.</li>
</ul>
</section>
<section id="python" class="level3">
<h3 class="anchored" data-anchor-id="python">Python</h3>
<ul>
<li><a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a></li>
</ul>
</section>
<section id="pre-commit-1" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit-1">Pre-commit</h3>
<ul>
<li><a href="https://pre-commit.com" target="_blank">pre-commit</a></li>
<li><a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a></li>
<li><a href="https://ns-rse.github.io/#category=pre-commit" target="_blank">ns-rse | pre-commit</a> blog posts I’ve made about <code>pre-commit</code>.</li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2023,
  author = {Shephard, Neil},
  title = {Pre-Commit and {R} {Packaging}},
  date = {2023-07-29},
  url = {https://blog.nshephard.dev/posts/pre-commit-r/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Shephard, Neil. 2023. <span>“Pre-Commit and R Packaging.”</span> July
29, 2023. <a href="https://blog.nshephard.dev/posts/pre-commit-r/">https://blog.nshephard.dev/posts/pre-commit-r/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/blog\.nshephard\.dev\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>