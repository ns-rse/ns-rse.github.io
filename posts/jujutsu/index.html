<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Neil Shephard">
<meta name="dcterms.date" content="2025-02-08">

<title>Version Control with Jujutsu – blog.nshephard.dev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-79bb3942e891885f9f7af119cd221462.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2c4fe801cce5de4490d2fc2b466292bf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<link rel="alternate" type="application/rss+xml" title="blog.nshephard.dev" href="index.xml" data-external="1"></head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">blog.nshephard.dev</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../links.html"> 
<span class="menu-text">Links</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ns-rse" rel="me"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://gitlab.com/nshephard" rel="me"> <i class="bi bi-gitlab" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://forgejo.nshephard.dev"> 
<span class="menu-text"><img src="img/forgejo-monochrome.svg" class="img-fluid"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://codeberg.org/slackline"> 
<span class="menu-text"><img src="img/codeberg-logo_icon_white.svg" class="img-fluid"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="me"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@nshephard" rel="me"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0001-8301-6857" rel="me"> 
<span class="menu-text"><img src="img/codeberg-logo_icon_white.svg" class="img-fluid"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Version Control with Jujutsu</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">jujutsu</div>
                <div class="quarto-category">git</div>
                <div class="quarto-category">version control</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Neil Shephard <a href="https://orcid.org/0000-0001-8301-6857" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 8, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#installation" id="toc-installation" class="nav-link active" data-scroll-target="#installation">Installation</a>
  <ul>
  <li><a href="#gentoo" id="toc-gentoo" class="nav-link" data-scroll-target="#gentoo">Gentoo</a></li>
  <li><a href="#nixos" id="toc-nixos" class="nav-link" data-scroll-target="#nixos">NixOS</a></li>
  <li><a href="#arch-linux" id="toc-arch-linux" class="nav-link" data-scroll-target="#arch-linux">Arch Linux</a></li>
  <li><a href="#shell-integration" id="toc-shell-integration" class="nav-link" data-scroll-target="#shell-integration">Shell Integration</a>
  <ul class="collapse">
  <li><a href="#bash" id="toc-bash" class="nav-link" data-scroll-target="#bash">Bash</a></li>
  <li><a href="#zsh" id="toc-zsh" class="nav-link" data-scroll-target="#zsh">ZSH</a></li>
  </ul></li>
  <li><a href="#initial-configuration" id="toc-initial-configuration" class="nav-link" data-scroll-target="#initial-configuration">Initial Configuration</a></li>
  </ul></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">Usage</a>
  <ul>
  <li><a href="#new-commits" id="toc-new-commits" class="nav-link" data-scroll-target="#new-commits">New commits</a></li>
  </ul></li>
  <li><a href="#diffing" id="toc-diffing" class="nav-link" data-scroll-target="#diffing">Diffing</a></li>
  <li><a href="#remotes" id="toc-remotes" class="nav-link" data-scroll-target="#remotes">Remotes</a></li>
  <li><a href="#bookmarks-aka-branches" id="toc-bookmarks-aka-branches" class="nav-link" data-scroll-target="#bookmarks-aka-branches">Bookmarks (aka branches)</a></li>
  <li><a href="#merging-branches" id="toc-merging-branches" class="nav-link" data-scroll-target="#merging-branches">Merging Branches</a>
  <ul>
  <li><a href="#conflicts" id="toc-conflicts" class="nav-link" data-scroll-target="#conflicts">Conflicts</a></li>
  </ul></li>
  <li><a href="#revisions-and-revsets" id="toc-revisions-and-revsets" class="nav-link" data-scroll-target="#revisions-and-revsets">Revisions and Revsets</a>
  <ul>
  <li><a href="#symbols" id="toc-symbols" class="nav-link" data-scroll-target="#symbols">Symbols</a></li>
  <li><a href="#operators" id="toc-operators" class="nav-link" data-scroll-target="#operators">Operators</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  </ul></li>
  <li><a href="#configuration" id="toc-configuration" class="nav-link" data-scroll-target="#configuration">Configuration</a></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a>
  <ul>
  <li><a href="#squash-workflow" id="toc-squash-workflow" class="nav-link" data-scroll-target="#squash-workflow">Squash Workflow</a></li>
  <li><a href="#edit-workflow" id="toc-edit-workflow" class="nav-link" data-scroll-target="#edit-workflow">Edit Workflow</a>
  <ul class="collapse">
  <li><a href="#editing-older-commits" id="toc-editing-older-commits" class="nav-link" data-scroll-target="#editing-older-commits">Editing older commits</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ideinterfaces" id="toc-ideinterfaces" class="nav-link" data-scroll-target="#ideinterfaces">IDE/Interfaces</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#links" id="toc-links" class="nav-link" data-scroll-target="#links">Links</a>
  <ul>
  <li><a href="#tutorials" id="toc-tutorials" class="nav-link" data-scroll-target="#tutorials">Tutorials</a></li>
  <li><a href="#emacs-packages" id="toc-emacs-packages" class="nav-link" data-scroll-target="#emacs-packages">Emacs Packages</a></li>
  <li><a href="#blogs" id="toc-blogs" class="nav-link" data-scroll-target="#blogs">Blogs</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I’d bread about and heard a good things about <a href="https://martinvonz.github.io/jj/latest/" target="_blank">Jujutsu</a>, a new Version Control System developed by Martin von Zweigbergk at Google, although it is not an official Google product and is Open Source Software licensed under the Apache 2.0 license. It has its own internal/native backend but also supports using <a href="https://git-scm.com/" target="_blank">Git</a> in the background to undertake all tasks. As such it can be used as a drop-in replacement for <a href="https://git-scm.com/" target="_blank">Git</a>. A big difference from the familiar Git model is that the working copy is automatically committed. If you check out a commit this introduces a new working-copy commit where changes are recorded (no more <code>detached HEAD</code> state!). I recently purchased a refurbished ThinkPad T490s and decided to give <a href="https://nixos.org" target="_blank">NixOS</a> a whirl so what better opportunity to try Jujutsu than to use it to version control my <code>/etc/nixos</code> directory.</p>
<p>This post covers my experience of getting started with Jujutsu.</p>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Whilst notionally installing and using it on NixOS I use both <a href="https://gentoo.org/" target="_blank">Gentoo</a> and <a href="https://archlinux.org" target="_blank">Arch</a> Linux so have installed it on those systems too.</p>
<section id="gentoo" class="level3">
<h3 class="anchored" data-anchor-id="gentoo">Gentoo</h3>
<p><code>jj</code> is available in the <a href="https://overlays.gentoo.org/" target="_blank">Gentoo Overlays</a> <code>guru</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">eselect</span> repository enable guru</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">eix-sync</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">emerge</span> <span class="at">-av</span> dev-vcs/jj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="nixos" class="level3">
<h3 class="anchored" data-anchor-id="nixos">NixOS</h3>
<p><code>jj</code> is also available for <a href="https://nixos.org" target="_blank">NixOS</a>. You can use <a href="https://wiki.nixos.org/wiki/Flakes" target="_blank">flake</a> or <a href="https://wiki.nixos.org/wiki/Home_Manager" target="_blank">HomeManager</a>, I opted for the former and added the following to <code>/etc/nixos/flake.nix</code>. Just add the following to <code>/etc/nixos/configuration.nix</code> to install the most recent release system wide.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">environment.systemPackages</span> = with pkgs{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">jujutsu</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then either <code>nixos-rebuild test</code> to install and test the installation (you should now have <code>jj</code> in your command line) and if happy <code>nixos-rebuild switch</code> to make the change permanent and available on the next boot.</p>
</section>
<section id="arch-linux" class="level3">
<h3 class="anchored" data-anchor-id="arch-linux">Arch Linux</h3>
<p>Stable version is included in <a href="https://aur.archlinux.org/packages/jj" target="_blank">packages</a>, although you can keep track of development using the <a href="https://aur.archlinux.org/packages/jj-git" target="_blank">AUR <sub>jj-git</sub></a> package.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pacman</span> <span class="at">-Syu</span> jj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="shell-integration" class="level3">
<h3 class="anchored" data-anchor-id="shell-integration">Shell Integration</h3>
<p>There is integration with both <a href="https://www.gnu.org/software/bash/" target="_blank">Bash</a> and <a href="https://www.zsh.org/" target="_blank">ZSH</a> as well as <a href="https://jj-vcs.github.io/jj/latest/install-and-setup/#command-line-completion" target="_blank">other shells</a>.</p>
<section id="bash" class="level4">
<h4 class="anchored" data-anchor-id="bash">Bash</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> <span class="op">&lt;(</span><span class="ex">jj</span> util completion bash<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="zsh" class="level4">
<h4 class="anchored" data-anchor-id="zsh">ZSH</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">autoload</span> <span class="at">-U</span> compinit</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">compinit</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> <span class="op">&lt;(</span><span class="ex">jj</span> util completion zsh<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="initial-configuration" class="level3">
<h3 class="anchored" data-anchor-id="initial-configuration">Initial Configuration</h3>
<p>As with Git you need to add your <code>user.name</code> and <code>user.email</code> to the configuration.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> config set <span class="at">--user</span> user.name <span class="st">"Your Name"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> config set <span class="at">--user</span> user.email <span class="st">"your@email.address"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">We</span> can check the configuration…</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span><span class="fu">sh</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> config list</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ui.editor</span> = <span class="st">"/usr/bin/nano"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">ui.pager</span> = <span class="st">"less"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">user.email</span> = <span class="st">"nshephard@protonmail.com"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="ex">user.name</span> = <span class="st">"Neil Shephard"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This looks ok but I found that <code>/usr/bin/nano</code> is <em>wrong</em> for a NixOS system….</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> nano</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/run/current-system-sw/bin/nano</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>..so updated that along with a switch from <code>less</code> to <code>most</code> for paging.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> config set <span class="at">--user</span> ui.editor <span class="st">"/run/current-system/sw/bin/nano"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span> set <span class="at">--user</span> ui.pager <span class="st">"/run/current-system/sw/bin/most"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>I wanted to keep <code>/etc/nixos</code> under version control using <code>jj</code> and as advised in <a href="https://steveklabnik.github.io/jujutsu-tutorial/introduction/introduction.html" target="_blank">Steve’s Jujutsu Tutorial</a> opted to use the Git backend.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /etc/nixos</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git init</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> st</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Working</span> copy changes:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> agenix.nix</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> audio.nix</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> bluetooth.nix</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> configuration.nix</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> configuration.nix~</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> flake.lock</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> flake.nix</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> flake.nix~</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> hardware-configuration.nix</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> home.nix</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> home.nix~</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> luks.nix</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> secrets/secrets.nix</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> secrets/slack-vpn.age</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> xfce.nix</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">A</span> xfce.nix~</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Working</span> copy : vpqtltus 35cc03d2 <span class="er">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Parent</span> commit: zzzzzzzz 00000000 <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First things first, I’d already edited some files using Emacs and didn’t want the temporary files it leaves behind included. According to the <a href="https://jj-vcs.github.io/jj/latest/working-copy/#ignored-files" target="_blank">documentation</a> there is no <code>.jjignore</code> yet so we use <code>.gitignore</code> instead listing our files and patterns there.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">*~</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">\#*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>…but the files are already being tracked because they were present when the repository was initialised. We therefore need to untrack them with…</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> file untrack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This failed because <code>~</code> is used in the syntax for <a href="https://jj-vcs.github.io/jj/latest/filesets/" target="_blank">jj filesets</a> which is a method of defining patterns of files. I tried a few things but in the end couldn’t suss it out in the five minutes so took the brute force option of <code>rm -rf .jj</code> and initialising the repository anew. We can look at the status with <code>jj st</code> and it will use our configured pager (which I’ve set to <code>most</code>) to show the changes.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> st</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy changes:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> .gitignore</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> agenix.nix</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> audio.nix</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> bluetooth.nix</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> configuration.nix</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> flake.lock</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> flake.nix</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> hardware-configuration.nix</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> home.nix</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> luks.nix</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> secrets/secrets.nix</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> secrets/slack-vpn.age</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span> xfce.nix</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy : nxzzlvzo 43e6338e <span class="er">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: zzzzzzzz 00000000 <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can see the changes (i.e.&nbsp;all new files) are already noted as being under the working copy. We can also use <code>jj describe</code> to look at the changes and add a description. If we use the <code>-m "A message"</code> flag and value we can add a message and it will replace the <code>no description set</code> shown by <code>jj st</code>. With <code>jj describe</code> the information is opened up in an editor, and if a message has already been set it will be shown at the top. Note that lines beginning with <code>JJ</code> will be removed (i.e.&nbsp;they are comment lines). On adding a message or changing it the commit ID changes, the change ID remains the same but the commit ID changes over time allowing us to refer to individual commits rather than a whole change set.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> describe <span class="at">-m</span> <span class="st">"Initial commit with jj :)"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy now at: nxzzlvzo d2d192ec Initial commit with jj :<span class="er">)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit      : zzzzzzzz 00000000 <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="new-commits" class="level3">
<h3 class="anchored" data-anchor-id="new-commits">New commits</h3>
<p>We’re ready to make some changes, but unlike Git we can make our commit <em>first</em> rather than after having made the changes. We do this with <code>jj new</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> new</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy now at: mkrknnyv d20e2368 <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit      : nxzzlvzo d2d192ec Initial commit with jj :<span class="er">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can now modify a file, in this case I tidied up <code>/etc/nixos/configuration.nix</code> and put all <code>network.*</code> options within a <code>network = {...};</code> block and similar aggregated all <code>nix.*</code> options into a <code>nix = {...};</code> block.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> st</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy changes:</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">M</span> configuration.nix</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy : mkrknnyv 31f1c759 <span class="er">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: nxzzlvzo d2d192ec Initial commit with jj :<span class="er">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can see the full commit history with <code>jj log</code> (no surprisese there!)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">@</span>  mkrknnyv nshephard@protonmail.com 2024-12-21 16:20:53 31f1c759</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>  <span class="er">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">○</span>  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>  Initial commit with jj :<span class="er">)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span>  zzzzzzzz root<span class="er">(</span><span class="kw">)</span> <span class="ex">00000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s interesting to note that the bold/highlighting of the start of commit hashes gives you an indication of the unique component of that hash (but you’ll have to take my word for that as I’ve not bothered to copy that over to the blog!).</p>
<p>It is important to note that there is no need to explicitly make a commit, the work done/changes are already part of the current commit. When you are ready to start the next piece of work you <code>jj new</code> (optionally with <code>-m "&lt;message&gt;"</code>) to start a new piece of work.</p>
<p>This naturally leads to the question of how to undo work that you have done With <code>jj</code> you can move back to commits using <code>jj edit @-</code> or referring to the commit directly with <code>jj edit &lt;hash&gt;</code> and then use</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> edit @-</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> abandon <span class="op">&lt;</span>hash_of_latest_commit<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="diffing" class="level2">
<h2 class="anchored" data-anchor-id="diffing">Diffing</h2>
<p>You can view differences with <code>jj diff</code> and it will show the differences between the current “<code>HEAD</code>” and the previous commit. I use <code>difftastic</code> (see Configuration section below) so have colourized output which isn’t shown below.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>    home.nix --- Nix</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    152 152       urldecode = "python3 -c 'import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))'";</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    153 153       urlencode = "python3 -c 'import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))'";</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    154 154     };</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    ... 155     # initExtra = ''</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    ... 156     #   if command -v keychain &gt; /dev/null 2&gt;&amp;1; then eval $(keychain --eval --nogui ${keyFilename} --quiet); fi</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    ... 157     # '';</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    155 158   };</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    156 159</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    157 160   programs.emacs = {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    configuration.nix --- 1/2 --- Nix</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    177   # Some programs need SUID wrappers, can be configured further or are      177   # Some programs need SUID wrappers, can be configured further or are</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    178   # started in user sessions.                                               178   # started in user sessions.</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    179   # programs.mtr.enable = true;                                             179   # programs.mtr.enable = true;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    180   programs.gnupg.agent = {                                                  180   programs = {</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    ...                                                                             181     gnupg.agent = {</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    181     enable = true;                                                          182       enable = true;</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    ...                                                                             183       # enableSSHSupport = true;</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    ...                                                                             184     };</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    182     enableSSHSupport = true;                                                185     ssh.startAgent = true;</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    183   };                                                                        186   };</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    184                                                                             187</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    185   # List services that you want to enable:                                  188   # List services that you want to enable:</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    186   services = {                                                              189   services = {</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    configuration.nix --- 2/2 --- Nix</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    210 213     fprintd = {</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    211 214       enable = true;</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    212 215     };</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    ... 216     # yubikey</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    ... 217     yubikey-agent = {</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    ... 218       enable = true;</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    ... 219     };</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    213 220   };</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    214 221   # Open ports in the firewall.</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    215 222   # networking.firewall.allowedTCPPorts = [ ... ];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to look at differences between two specific commits you can use the <code>--from</code> and <code>--to</code> options (the former likely being more useful than the later).</p>
</section>
<section id="remotes" class="level2">
<h2 class="anchored" data-anchor-id="remotes">Remotes</h2>
<p>I wanted to back my work up remotely and have a few options the ubiquitous <a href="https://github.com/" target="_blank">GitHub</a>, <a href="https://gitlab.com/" target="_blank">GitLab</a>, or my self-hosted <a href="https://forgejo.org/" target="_blank">Forgejo</a>. I opted for the later which is hosted on the VPS I pay for with <a href="https://ovh.co.uk" target="_blank">OVH</a>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git remote add origin <span class="op">&lt;</span>git@forgejo.nshephard.dev<span class="op">&gt;</span>:nshephard/crow.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However trying to push failed with a rather cryptic and unhelpful message.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git push</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> to push to origin:</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Add</span> bookmark trunk to bfce9c9ab2aa</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Error:</span> failed to connect to forgejo.nshephard.dev: Invalid argument<span class="kw">;</span> <span class="va">class</span><span class="op">=</span>Os <span class="kw">(</span><span class="ex">2</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I use a non-standard port for SSH on my server (i.e.&nbsp;not <code>22</code> ). The “trick” here was to use the <code>scp</code> like syntax to specifying the <code>url</code> under the <code>remote</code> in the <code>git</code> configuration which resides in <code>.jj/repo/store/git/config</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[remote</span> <span class="st">"origin"</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">url</span> = ssh://git@forgejo.nshephard.dev:2222/~/nshephard/crow.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Success, I can reach the remote, but it fails to authenticate.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">jj</span> <span class="dt">git</span> <span class="dt">push</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Changes</span> <span class="dt">to</span> <span class="dt">push</span> <span class="dt">to</span> <span class="dt">origin</span><span class="er">:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Add</span> <span class="dt">bookmark</span> <span class="dt">trunk</span> <span class="dt">to</span> <span class="dt">bfce9c9ab2aa</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">Error</span><span class="er">:</span> <span class="dt">failed</span> <span class="dt">to</span> <span class="dt">authenticate</span> <span class="dt">SSH</span> <span class="dt">session</span><span class="er">:</span> <span class="dt">Unable</span> <span class="dt">to</span> <span class="dt">extract</span> <span class="dt">public</span> <span class="dt">key</span> <span class="dt">from</span> <span class="dt">private</span> <span class="dt">key</span> <span class="dt">file</span><span class="er">:</span> <span class="dt">Wrong</span> <span class="dt">passphrase</span> <span class="dt">or</span> <span class="dt">invalid</span><span class="er">/</span><span class="dt">unrecognized</span> <span class="dt">private</span> <span class="dt">key</span> <span class="dt">file</span> <span class="dt">format</span><span class="er">;</span> <span class="dt">class</span><span class="op">=</span><span class="dt">Ssh</span> <span class="er">(</span><span class="dt">23</span><span class="er">)</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">Hint</span><span class="er">:</span> <span class="dt">Jujutsu</span> <span class="dt">uses</span> <span class="dt">libssh2</span><span class="er">,</span> <span class="dt">which</span> <span class="dt">doesn't respect ~/.ssh/config. Does `ssh -F /dev/null` to the host work?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Checking my <code>~/.ssh/config</code> and my <a href="https://forgejo.org/" target="_blank">Forgejo</a> configuration and I realised that I have it configured to run as user <code>forgejo</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[remote</span> <span class="kw">"</span><span class="dt">origin"</span><span class="kw">]</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span> <span class="op">=</span> <span class="dt">ssh</span><span class="er">://</span><span class="dt">forgejo</span><span class="er">@</span><span class="dt">forgejo.nshephard.dev</span><span class="er">:</span><span class="dt">2222</span><span class="er">/</span><span class="dt">nshephard</span><span class="er">/</span><span class="dt">crow.git</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bookmarks-aka-branches" class="level2">
<h2 class="anchored" data-anchor-id="bookmarks-aka-branches">Bookmarks (aka branches)</h2>
<p>These are mainly for compatibility with Git, <code>jj</code> actually prefers to use anonymous rather than named branches (sometimes called a “branchless” workflow). You create a bookmark at a given point and it stays there until you move it. This is kind of weird compared to Git where commits are stacked on top of each other to make branches and you are always checked out on the <code>HEAD</code> commit at the top or otherwise in a “detached” status.</p>
<p>Create a bookmark with…</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> bookmark create <span class="op">&lt;</span>name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to move a bookmark after its creation you can do so…</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> bookmark move <span class="op">&lt;</span>bookmark_name<span class="op">&gt;</span> --to <span class="op">&lt;</span>revision<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the default <code>--to</code> is <code>@</code> so <code>jj bookrmark move &lt;bookmark_name&gt;</code> will move it to your current location, whether that is the tip or not.</p>
</section>
<section id="merging-branches" class="level2">
<h2 class="anchored" data-anchor-id="merging-branches">Merging Branches</h2>
<p>I found when it came to pushing to my <a href="https://forgejo.org/" target="_blank">Forgejo</a> instance where I had created the repository I had to first <code>jj git pull</code> to get the initial commit there and then setup remote tracking.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git push</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Warning:</span> Non-tracking remote bookmark trunk@origin exists</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Hint:</span> Run <span class="kw">`</span><span class="ex">jj</span> bookmark track trunk@origin<span class="kw">`</span> to import the remote bookmark.</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Nothing</span> changed.</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git fetch</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bookmark:</span> trunk@origin <span class="pp">[</span><span class="ss">new</span><span class="pp">]</span> untracked</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> bookmark track trunk@origin</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">jj</span> log</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">◆</span>  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 trunk@origin 12c4747e</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>  Initial commit</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> @  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 trunk bfce9c9a</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Adding tree to systemPackages</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  ZSH home.nix configuration</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  system: emacs daemon for user</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Adding difftastic</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Tidying up nix and network sections</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ○  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├─╯</span>  Initial commit with jj :<span class="er">)</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="ex">◆</span>  zzzzzzzz root<span class="er">(</span><span class="kw">)</span> <span class="ex">00000000</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#+end_</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this point the two “branches” (<code>trunk@origin</code> and the local <code>trunk</code>) have diverged and are in conflict, preventing me from pushing</p>
<p>jj git push Warning: Bookmark trunk is conflicted Hint: Run <code>jj bookmark list</code> to inspect, and use <code>jj bookmark set</code> to fix it up. Nothing changed.</p>
<p>There is an old command in Jujutsu to <code>jj merge</code> but, as the help informs you, it has been deprecated in favour of <code>jj new</code>. This isn’t too dissimilar to Git though since “merges” are just commits that bring two branches together. The syntax for this is <code>jj new [OPTIONS] [REVISIONS]</code>, by default the <code>REVISIONS</code> is simply <code>@</code> the current “<code>HEAD</code>”, but specifying more than one will merge the two together. You can of course include <code>-m "Message about merging"</code>. Taking the above output from <code>jj log</code> I can make a merge with the following (the minimal hashes are highlighted in the terminal but not above and here the <code>to my</code> refers to merging to the latest commit).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> new <span class="at">-m</span> <span class="st">"merge: local work with remote init"</span> to my</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy now at: oupkqwzo da0ebd37 <span class="er">(</span><span class="ex">conflict</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="ex">merge:</span> local work with remote init</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit      : tossulss bfce9c9a trunk<span class="pp">??</span> <span class="kw">|</span> <span class="ex">Add</span> pcscd to services for GnuPG pinentry</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit      : myqxkksp 12c4747e trunk<span class="pp">??</span> trunk@origin <span class="kw">|</span> <span class="ex">Initial</span> commit</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Added</span> 2 files, modified 1 files, removed 0 files</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">There</span> are unresolved conflicts at these paths:</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="ex">.gitignore</span>    2-sided conflict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="conflicts" class="level3">
<h3 class="anchored" data-anchor-id="conflicts">Conflicts</h3>
<p>The manual covers <a href="https://jj-vcs.github.io/jj/latest/conflicts/" target="_blank">conflict</a> resolution and its worth reading that. That I encountered merge conflicts isn’t entirely unexpected I had created <code>.gitignore</code> both locally and on the remote so bringing them together the is natural. Lets look at this…</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> .gitignore</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> Conflict <span class="ex">1</span> of 1</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">%%%%%%%</span> Changes from base to side <span class="co">#1</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">+##</span> Emacs temporary files</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">+*~</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">+\#*</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">+++++++</span> Contents of side <span class="co">#2</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ---&gt; Nix</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignore build outputs from performing a nix-build or `nix build` command</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="ex">result</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="ex">result-*</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span> Conflict <span class="ex">1</span> of 1 ends</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is fairly similar to Git merge conflicts, but I like the <code>side 1~/~side 2</code> notation (you get the same in Git by default but its occluded and you have to read up to understand that first bit delimited by ‘&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;’ is from the current branch and the other bit is from the branch that is being merged).</p>
<p>I know I want both of these included in <code>.gitignore</code> so I make the changes, removing all the conflict markup and save the file. This tidies up the current commit, there is no need to make another commit to take a snapshot of those changes as there is in Git. However the bookmarks are still in conflict so we need to set that to the correct commit.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> st</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy changes:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">M</span> .gitignore</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy : oupkqwzo f10df751 merge: local work with remote init</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: tossulss bfce9c9a trunk<span class="pp">??</span> <span class="kw">|</span> <span class="ex">Add</span> pcscd to services for GnuPG pinentry</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: myqxkksp 12c4747e trunk<span class="pp">??</span> trunk@origin <span class="kw">|</span> <span class="ex">Initial</span> commit</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">These</span> bookmarks have conflicts:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="ex">trunk</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="kw">`</span><span class="ex">jj</span> bookmark list<span class="kw">`</span> to see details. Use <span class="kw">`</span><span class="ex">jj</span> bookmark set <span class="op">&lt;</span>name<span class="op">&gt;</span> -r <span class="op">&lt;</span>rev<span class="op">&gt;</span><span class="kw">`</span> to resolve.</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> bookmark set trunk <span class="at">-r</span> ou</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> st</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy changes:</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="ex">M</span> .gitignore</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy : oupkqwzo f10df751 trunk<span class="pp">*</span> <span class="kw">|</span> <span class="ex">merge:</span> local work with remo</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: tossulss bfce9c9a Add pcscd to services for GnuPG pine</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit: myqxkksp 12c4747e trunk@origin <span class="kw">|</span> <span class="ex">Initial</span> commit</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> log</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">@</span>    oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk<span class="pp">*</span> f10df751</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├─╮</span>  merge: local work with remote init</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> ◆  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 trunk@origin 12c4747e</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Initial commit</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 bfce9c9a</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Adding tree to systemPackages</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  ZSH home.nix configuration</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  system: emacs daemon for user</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Adding difftastic</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span> │  Tidying up nix and network sections</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">○</span> │  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├─╯</span>  Initial commit with jj :<span class="er">)</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">◆</span>  zzzzzzzz root<span class="er">(</span><span class="kw">)</span> <span class="ex">00000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ve merged out branches but <code>trunk@origin</code> is behind that merge we can bring that up-to-date by pushing</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> git push</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> to push to origin:</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Move</span> forward bookmark trunk from 12c4747edb21 to f10df751ab04</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> The working-copy commit in workspace <span class="st">'default'</span> became immutable, so a new commit has been created on top of it.</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> copy now at: tuwxwnqw 4e3890c1 <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Parent</span> commit      : oupkqwzo f10df751 trunk <span class="kw">|</span> <span class="ex">merge:</span> local work with remote init</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> log</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">@</span>  tuwxwnqw nshephard@protonmail.com 2024-12-23 11:58:36 4e3890c1</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>  <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">◆</span>  oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk f10df751</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>  merge: local work with remote init</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">~</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Not sure where the rest of the commit history is but it is showing up on the ForgeJo repository <a href="https://forgejo.nshephard.dev/nshephard/crow/commits/branch/trunk" target="_blank">commit history</a>. I’ll return to that later.</p>
</section>
</section>
<section id="revisions-and-revsets" class="level2">
<h2 class="anchored" data-anchor-id="revisions-and-revsets">Revisions and Revsets</h2>
<p>A revision set or “revset” is a range of commits and <code>jj</code> has its own language for describing refsets.</p>
<section id="symbols" class="level3">
<h3 class="anchored" data-anchor-id="symbols">Symbols</h3>
<p>We’ve already encountered <code>@</code> which points to our current working copy that we have checked out (sometimes “<code>HEAD</code>” but could be elsewhere in history).</p>
</section>
<section id="operators" class="level3">
<h3 class="anchored" data-anchor-id="operators">Operators</h3>
<p>The tutorial notes the following common operators.</p>
<ul>
<li><code>x &amp; y</code>: changes that are in both <code>x</code> and <code>y</code>.</li>
<li><code>x | y</code>: changes that are in either <code>x</code> or <code>y</code>.</li>
<li><code>::x</code> Ancestors of <code>x</code>.</li>
<li><code>x::</code> Descendants of <code>x</code>.</li>
</ul>
<p>We found that we couldn’t review the history of the current checked out commit (<code>@</code>) any more but lets see if we can use this new knowledge to find view the log history. We want to look at all ancestors so we can use <code>::t</code> to view the ancestors of the most recent, empty, commit.</p>
<p>****NB**** It might be worth adding a description with <code>jj describe</code> before undertaking work, remember that the changes in the working directory are always part of the current commit.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jj</span> log <span class="at">-r</span> ::t</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">@</span>  tuwxwnqw nshephard@protonmail.com 2024-12-23 11:58:36 4e3890c1</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>  <span class="er">(</span><span class="ex">empty</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">no</span> description set<span class="kw">)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span>    oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk f10df751</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├─╮</span>  merge: local work with remote init</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> ◆  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 12c4747e</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Initial commit</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 bfce9c9a</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Adding tree to systemPackages</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  ZSH home.nix configuration</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  system: emacs daemon for user</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Adding difftastic</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span> │  Tidying up nix and network sections</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span> │  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="ex">├─╯</span>  Initial commit with jj :<span class="er">)</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="ex">◆</span>  zzzzzzzz root<span class="er">(</span><span class="kw">)</span> <span class="ex">00000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>The revset language also includes a number of functions that help filter log messages such as <code>author()</code>, <code>description()</code>, <code>ancestors(x, depth)</code> (an extended version of <code>::x</code>) and <code>parents()</code>.</p>
<p>I’m not going to dig too deep into these at the moment as I have limited use for them right now but see the <a href="https://steveklabnik.github.io/jujutsu-tutorial/branching-merging-and-conflicts/revsets.html" target="_blank">Figuring out where our changes are with revsets - Steve’s Jujutsu Tutorial</a> and the <a href="https://jj-vcs.github.io/jj/latest/revsets/" target="_blank">Revset language</a> of the official documentation.</p>
</section>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<p>You can edit the <a href="https://jj-vcs.github.io/jj/latest/config/" target="_blank">configuration</a> either at the <code>--user</code> or <code>--repo</code> level with <code>jj config edit --[user|repo]</code> (to find the path of the users configuration file use <code>jj config path --user</code>, repository configuration is in <code>.jj/repo/config.toml</code>). These are <a href="id:80ebb47c-7c3e-4aa4-93c4-bb15f0ee7a01" target="_blank">TOML</a> files.</p>
<p>I enabled color using the brilliant <a href="https://difftastic.wilfred.me.uk/" target="_blank">difftastic</a></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[user]</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span> <span class="op">=</span> <span class="st">"Neil Shephard"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">email</span> <span class="op">=</span> <span class="st">"nshephard@protonmail.com"</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[ui]</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">editor</span> <span class="op">=</span> <span class="st">"/run/current-system/sw/bin/nano"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pager</span> <span class="op">=</span> <span class="st">"/run/current-system/sw/bin/most"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span> <span class="op">=</span> <span class="st">"always"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Use Difftastic by default</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">diff.tool</span> <span class="op">=</span> <span class="op">[</span><span class="st">"difft"</span><span class="op">,</span> <span class="st">"--color=always"</span><span class="op">,</span> <span class="st">"$left"</span><span class="op">,</span> <span class="st">"$right"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>…there are a lot more configuration options available (see <a href="https://jj-vcs.github.io/jj/latest/config/" target="_blank">configuration</a> documentation for full details).</p>
</section>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<p>Two popular workflows are described in the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/" target="_blank">tutorial</a>, the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/the-squash-workflow.html" target="_blank">Squash Workflow</a> and the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/the-edit-workflow.html" target="_blank">Edit Workflow</a>.</p>
<section id="squash-workflow" class="level3">
<h3 class="anchored" data-anchor-id="squash-workflow">Squash Workflow</h3>
<p>This is kind of link <code>git commit --amend</code> where changes are added to the existing <code>HEAD</code> commit of the branch. The <code>jj</code> workflow has at it’s head (denoted by <code>@</code> in the <code>jj log</code> output) the “unstaged” changes and <code>jj squash</code> adds them to the previous commit, which is typically created <em>before</em> making any changes with a description of the intended work (you could do this with <code>git commit -a --allow-empty -m "bug: I'm going to squash a bug!"</code> ) and then repeatedly <code>git commit --amend</code> as we complete the work. With <code>jj</code> squash workflow though it encourages making smaller more atomic commits and reduces the amount of “/fixing an error/typo” commits by those averse to using <code>--amend</code>. By default all files are included but you can specify just those files you want to include by listing them.</p>
<p>Jujutsu also allows interactive selection of lines to edit via the <code>-i</code> flag. A terminal interface opens and it is possible to select which lines to include prior to making the commit. After having selected all the changes simply hit `c` to confirm them.</p>
<p>If you decide you don’t want to keep the work you can <code>jj abandon</code> the work in progress and it reverts all changes. In fact <code>jj squash</code> offers much of the functionality of <code>git rebase -i</code>.</p>
</section>
<section id="edit-workflow" class="level3">
<h3 class="anchored" data-anchor-id="edit-workflow">Edit Workflow</h3>
<p>Continuing from the previous example we make some more changes, but rather than using <code>new</code>, because there is already an empty change there as we squashed the existing changes into the previous commit leaving <code>@</code> empty, we use <code>jj describe -m "message"</code> to add a message to the empty commit that we are <em>not</em> going to squash. Now make the changes and when ready to start a new piece of work you can use <code>jj new -m ""</code>.</p>
<section id="editing-older-commits" class="level4">
<h4 class="anchored" data-anchor-id="editing-older-commits">Editing older commits</h4>
<p>In Git this can be done either by adding a <code>git commit --fixup</code> or using <code>git rebase -i</code> tp interactively squash commits. In <code>jj</code> though we can use <code>jj new -B @ -m "a new message"</code> and what this does is add a new commit before the <code>~@</code> commit (other references can be used if you want to modify a commit further back in the commit history). You get for free a rebase of descendant commits, of course conflicts can arise but this command <em>will</em> always complete without resolving the conflicts (yet!).</p>
<p>The “<code>HEAD</code>” of the “branch” has been moved to this commit and changes can be made and saved (they’re already included as there is no staging in Jujutsu). When done you can return to the “<code>HEAD</code>” using <code>jj edit &lt;minimal_hash&gt;</code> or the convenience shortcut <code>jj next --edit</code> which moves <code>@</code> to the “child” commit and allows editing.</p>
<p>You can edit earlier commits with <code>jj edit @-</code> for the previous commit or <code>jj edit &lt;commit&gt;</code></p>
</section>
</section>
</section>
<section id="ideinterfaces" class="level2">
<h2 class="anchored" data-anchor-id="ideinterfaces">IDE/Interfaces</h2>
<p>Being an Emacs user I naturally wanted to use Jujutsu via Emacs and was hoping for a <a href="https://magit.vc/" target="_blank">Magit</a> equivalent. Being considerably newer there isn’t anything quite as powerful as Magit just yet but there is work in progress in the form of <a href="https://git.sr.ht/~puercopop/jujutsushi" target="_blank">jujutsushi - A emacs interface to jujutsu</a> and <a href="https://github.com/bennyandresen/jujutsu.el" target="_blank">jujutsu.el: An Emacs interface for jujutsu</a> (although the former’s author has stated they have deprioritized development in light of the later, see <a href="https://www.reddit.com/r/emacs/comments/1hbmpub/comment/m1inz3i/" target="_blank">here</a>).</p>
<p>The <a href="https://github.com/jj-vcs/jj/wiki/" target="_blank">wiki</a> is a useful resource on IDE integration</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>After a few weeks or so tinkering with Jujutsu/<sub>jj</sub> I’ve found there are a number of features that differ from my Git experience to date. Having a mental model of Version Control is important for these to make sense. Obviously I need to spend longer working with the system to have a deeper understanding and appreciation of how it works and a better comparison to Git, but first impressions are good, although switching full scale would mean abandoning the amazing <a href="https://magit.vc/" target="_blank">Magit</a> which is one of the best <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> packages going, but there are some Emacs packages for working with Jujutsu in the pipeline.</p>
<ul>
<li>All changes are “staged”.</li>
<li>Branch names are redundant but are available (as “bookmarks”) for compatibility with Git and these need updating to the most recent commit.</li>
<li>Moving around commits seems more intuitive and there is no warning about the dangers of being in a “detached HEAD” state.</li>
<li>As a consequence it’s easy to update changes that should have been in older commits.</li>
<li>When this happens rebasing descendent commits is free, even if conflicts arise, they are still committed. They will need resolving eventually but you can do this once on the commit you wish to rather than repeatedly and having to rely on <a href="https://git-scm.com/book/en/v2/Git-Tools-Rerere" target="_blank"><code>git rerere</code></a></li>
</ul>
<p>I’d highly recommend reading some other people’s blogs on Jujutsu for a more technical understanding and broader view. In particular I liked the post <a href="https://kubamartin.com/posts/introduction-to-the-jujutsu-vcs/" target="_blank">Jujutsu VCS Introduction and Patterns | Kuba Martin</a>.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://martinvonz.github.io/jj/latest/" target="_blank">Jujutsu Documentation</a></li>
<li><a href="https://github.com/martinvonz/jj#command-line-completion" target="_blank">martinvonz/jj: A Git-compatible VCS that is both simple and powerful</a></li>
</ul>
<section id="tutorials" class="level3">
<h3 class="anchored" data-anchor-id="tutorials">Tutorials</h3>
<ul>
<li><a href="https://steveklabnik.github.io/jujutsu-tutorial/introduction/introduction.html" target="_blank">Steve’s Jujutsu Tutorial</a></li>
</ul>
</section>
<section id="emacs-packages" class="level3">
<h3 class="anchored" data-anchor-id="emacs-packages">Emacs Packages</h3>
<ul>
<li><a href="https://git.sr.ht/~puercopop/jujutsushi" target="_blank">jujutsushi - A emacs interface to jujutsu</a></li>
<li><a href="https://github.com/bennyandresen/jujutsu.el" target="_blank">jujutsu.el: An Emacs interface for jujutsu, inspired by magit and humbly not attempting to match it in scope.</a></li>
<li><a href="https://codeberg.org/vifon/vc-jj.el" target="_blank">vc-jj.el</a></li>
</ul>
</section>
<section id="blogs" class="level3">
<h3 class="anchored" data-anchor-id="blogs">Blogs</h3>
<ul>
<li><a href="https://v5.chriskrycho.com/essays/jj-init/" target="_blank">jj init — Sympolymathesy, by Chris Krycho</a></li>
<li><a href="https://reasonablypolymorphic.com/blog/jj-strategy/index.html" target="_blank">Jujutsu Strategies :: Reasonably Polymorphic</a></li>
<li><a href="https://ofcr.se/jujutsu-merge-workflow" target="_blank">A Better Merge Workflow with Jujutsu | ofcrse by Benjamin Tan</a></li>
<li><a href="https://tonyfinn.com/blog/jj/" target="_blank">Jujutsu (jj), a git compatible VCS - Tony Finn</a></li>
<li><a href="https://www.felesatra.moe/blog/2024/12/23/jj-is-great-for-the-wrong-reason" target="_blank">Jujutsu is great for the wrong reason</a></li>
<li><a href="https://kubamartin.com/posts/introduction-to-the-jujutsu-vcs/" target="_blank">Jujutsu VCS Introduction and Patterns | Kuba Martin</a></li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2025,
  author = {Shephard, Neil},
  title = {Version {Control} with {Jujutsu}},
  date = {2025-02-08},
  url = {https://blog.nshephard.dev/posts/jujutsu/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Shephard, Neil. 2025. <span>“Version Control with Jujutsu.”</span>
February 8, 2025. <a href="https://blog.nshephard.dev/posts/jujutsu/">https://blog.nshephard.dev/posts/jujutsu/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/blog\.nshephard\.dev\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>