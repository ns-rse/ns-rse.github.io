<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>blog.nshephard.dev</title>
<link>https://blog.nshephard.dev/links.html#category=git</link>
<atom:link href="https://blog.nshephard.dev/links-git.xml" rel="self" type="application/rss+xml"/>
<description>Software development in a Research Environment</description>
<image>
<url>https://blog.nshephard.dev/img/links.jpg</url>
<title>blog.nshephard.dev</title>
<link>https://blog.nshephard.dev/links.html#category=git</link>
</image>
<generator>quarto-1.6.11</generator>
<lastBuildDate>Tue, 10 Jun 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>Debugging GitHub Actions with tmate</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/tmate/</link>
  <description><![CDATA[ 





<p>If you work with remote computer systems regularly you are probably familiar with <a href="privacy_ssh.md" target="_blank">SSH</a> for making your connections. You might also have come across <a href="https://github.com/tmux/tmux/wiki" target="_blank">tmux</a>, its fork<a href="https://tmate.io/" target="_blank">tmate</a> or the GNU programme <a href="https://www.gnu.org/software/screen/" target="_blank">screen</a> all of which allow you to maintain and/or share a session on a remote system.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/54529600682_763b548c4f_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.flickr.com/photos/slackline/54529600682/in/datetaken/" target="_blank">Returning from Bowfell Buttress by Me</a></figcaption>
</figure>
</div>
<p>The ability to connect remotely to a machine is invaluable, but what does that have to do with debugging GitHub Actions? You have your development environment on your local computer where you have made sure all tests pass and the documentation builds. Well often tests are run on a multitiude of operating systems and you may not always have access to these locally, even with the availability of emulators, for example licensing issues may prevent you from emulating some systems.</p>
<p>This is where <code>tmate</code> comes in handy because there is a <a href="github_actions.md" target="_blank">GitHub Actions</a> which sets up <code>tmate</code> on the runner that was spun on the GitHub servers and if you’ve setup your SSH keys correctly then you can connect to this machine and set about debugging errors.</p>
<p>The <a href="https://mxschmitt.github.io/action-tmate/" target="_blank">official documentation</a> is comprehensive and well written and I would recommend you read through it if you want to know more. Here I give a brief overview of how I use <code>tmate</code> in my work. Its pretty basic but has been invaluable.</p>
<section id="setup-and-configuration" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-configuration">Setup and Configuration</h2>
<section id="ssh-keys" class="level3">
<h3 class="anchored" data-anchor-id="ssh-keys">SSH Keys</h3>
<p>It is essential that you have your public SSH key stored in your GitHub account. A while back GitHub started enforcing this for development so chances are you have already got this setup, if not follow the instructions . GitHub have an excellent series of posts on <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/" target="_blank">connecting to GitHub with SSH</a>.</p>
<p>Work through those if you need to setup SSH. Once you have setup your SSH keys you are ready to add the <code>tmate</code> step to your GitHub Action.</p>
</section>
<section id="testing-on-multiple-oss-and-versions" class="level3">
<h3 class="anchored" data-anchor-id="testing-on-multiple-oss-and-versions">Testing on multiple OS’s and versions</h3>
<p>You can configure your GitHub Action to run on a range of operating systems by setting up single or multi-dimension <code>matrix</code> under the <code>strategy</code>. The example below<sup>1</sup> tests multiple operating systems and multiple versions of Python.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test (${{ matrix.python-version }}, ${{ matrix.os }})</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ matrix.os }}</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strategy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">os</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ubuntu-22.04"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ubuntu-20.04"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ubuntu-latest"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"macos-latest"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"windows-latest"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb1-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.10"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.11"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.12"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.13"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb1-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v4</span></span>
<span id="cb1-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Set up Python</span></span>
<span id="cb1-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v5</span></span>
<span id="cb1-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ matrix.python-version }}</span></span>
<span id="cb1-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    ...</span></span></code></pre></div>
</section>
<section id="tmate-github-action" class="level3">
<h3 class="anchored" data-anchor-id="tmate-github-action"><code>tmate</code> GitHub Action</h3>
<p>To use <code>tmate</code> to debug your workflow you need to add the <a href="https://mxschmitt.github.io/action-tmate/" target="_blank">action-tmate</a> to the <code>.github/workflows/&lt;action&gt;.yaml</code> you wish to debug. There are a lot of options available but a very basic configuration is shown below and you should add this as the last step in your workflow.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  ...</span></span>
<span id="cb2-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Setup tmate session</span></span>
<span id="cb2-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ failure() }}</span></span>
<span id="cb2-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> mxschmitt/action-tmate@v3</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">timeout-minutes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span></code></pre></div>
<p>This will use the <code>mxschmitt/action-tmate</code> step <em>only</em> if there is a failure and will make the SSH session on the runner available for just 5 minutes. Its quite likely that it will take me than 5 minutes to work out what is causing the error and so after have encountered an error I typically increase this amount to allow me longer to work on debugging the problem.</p>
</section>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>Once you have staged and committed the changes to you have made to your workflow to include the <code>action-tmate</code> step using it is pretty straight-forward. If everything runs ok you will see this in your workflows log because the step only runs on failure.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/tmate/img/tmate_skipped.png" class="img-fluid figure-img"></p>
<figcaption>No errors so the tmate action did not run</figcaption>
</figure>
</div>
<p>If however there <em>is</em> a failure in one of the preceding steps of your workflow then the <code>tmate</code> job kicks in and you will see the following in your jobs logs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/tmate/img/tmate_kicks_in.png" class="img-fluid figure-img"></p>
<figcaption><code>tmate</code> kicks in on failure of a preceding job</figcaption>
</figure>
</div>
<p>The key bit of information here are the lines at the bottom which are repeated…</p>
<pre class="shell"><code>2025-06-03T15:29:21.4815179Z openssh-client is already the newest version (1:9.6p1-3ubuntu13.11).
2025-06-03T15:29:21.4816354Z xz-utils is already the newest version (5.6.1+really5.4.5-1ubuntu0.2).
2025-06-03T15:29:21.4817296Z 0 upgraded, 0 newly installed, 0 to remove and 28 not upgraded.
2025-06-03T15:29:22.4080716Z ssh 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io
2025-06-03T15:29:22.4113791Z
2025-06-03T15:29:22.4125076Z SSH: ssh 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io
2025-06-03T15:29:22.4125623Z or: ssh -i &lt;path-to-private-SSH-key&gt; 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io
2025-06-03T15:29:27.4141023Z SSH: ssh 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io
2025-06-03T15:29:27.4141669Z or: ssh -i &lt;path-to-private-SSH-key&gt; 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io</code></pre>
<p>These messages are shown after the <code>mxschmitt/action-tmate</code> job has installed <code>tmate</code> on the GitHub runner (/remote server) and it is now available for you to connect to using SSH. If you have your SSH key loaded in a <a href="https://www.funtoo.org/Funtoo:Keychain" target="_blank">Keychain</a><sup>2</sup> or other SSH key manager then you can use the first form.</p>
<pre class="shell"><code>ssh 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io</code></pre>
<p>If you get a <code>Permission Denied</code> error then try the second form, substituting <code>&lt;path-to-private-SSH-key&gt;</code> for the private key that corresponds to the one you have on your GitHub account.</p>
<pre class="shell"><code>ssh -i &lt;path-to-private-SSH-key&gt; 7Nus3JTkxyGCmscUBKKV8fp3z@nyc1.tmate.io</code></pre>
<p>Once connected you have all the tools in the current version of the host operating system along with those your job installed, including the package and its dependencies you are testing or using in the workflow that has failed (remember this is the machine on which the job failed and your workflow sets up the environment for testing/building <span class="emoji" data-emoji="wink">😉</span>).</p>
<p>You can now set about debugging why the job failed in more detail. You may want to run <code>pytest --lf -x</code> to re-run the last failed jobs and start poking around. If you use <a href="https://docs.python.org/3/library/pdb.html" target="_blank"><code>pdb</code></a> to debug then you can add <code>breakpoint()</code> at the point you want to start debugging.</p>
<p>Astute readers will have noticed that you are time-limited as the configuration for this step in the workflow specified <code>timeout-minutes: 5</code> which means the runner and your SSH connection will terminate after five minutes. Typically it’s going to take you longer to solve your problem so you should tweak your <code>/.github/workflow/&lt;job&gt;.yaml</code> to increase this value on your local copy, commit and push the changes to your remote branch on GitHub where they will trigger another run of your jobs which should fail and you will have longer to spend connected debugging. Once you’ve solved the problem reduce it back to a few minutes.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Being able to remotely connect to GitHub runners allows you to investigate what went wrong quickly on operating systems you may not have at your disposal locally. Its a quick and efficient way to investigate in finer detail why tests and builds might be failing on a specific operating system or version of the software you are testing.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://github.com/mxschmitt/action-tmate" target="_blank">mxschmitt/action-tmate</a> GitHub page for the <code>tmate</code> action.</li>
<li><a href="https://mxschmitt.github.io/action-tmate/" target="_blank">Debug your GitHub Actions by using tmate | action-tmate</a> documentation for the <code>tmate</code> action.</li>
<li><a href="https://github.com/lhotari/action-upterm" target="_blank">lhotari/action-upterm</a> a fork of the <code>tmate</code> action.</li>
</ul>
<section id="ssh-and-github" class="level3">
<h3 class="anchored" data-anchor-id="ssh-and-github">SSH and GitHub</h3>
<ul>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/checking-for-existing-ssh-keys" target="_blank">Check for existing SSH keys</a></li>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank">Generating a new SSH key and adding it to the ssh-agent</a></li>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account" target="_blank">Adding a new SSH key to your GitHub account</a></li>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/testing-your-ssh-connection" target="_blank">Testing your SSH connection</a></li>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/working-with-ssh-key-passphrases" target="_blank">Working with SSH key passphrases</a></li>
<li><a href="https://www.funtoo.org/Funtoo:Keychain" target="_blank">Keychain Project</a></li>
</ul>



</section>
</section>


<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This is based on the <a href="https://github.com/AFM-SPM/TopoStats/blob/main/.github/workflows/tests.yaml" target="_blank">TopoStats <code>tests.yaml</code></a> package that I work on.↩︎</p></li>
<li id="fn2"><p>Keychain’s are a convenience programmes for managing <code>ssh-agent</code> that are long-running. They mean you can enter your SSH password once, typically on login, and your private keys are held in memory and used whenever you attempt to connect via SSH to a remote machine.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2025,
  author = {Shephard, Neil},
  title = {Debugging {GitHub} {Actions} with Tmate},
  date = {2025-06-10},
  url = {https://blog.nshephard.dev/posts/tmate/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2025" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2025. <span>“Debugging GitHub Actions with
Tmate.”</span> June 10, 2025. <a href="https://blog.nshephard.dev/posts/tmate/">https://blog.nshephard.dev/posts/tmate/</a>.
</div></div></section></div> ]]></description>
  <category>git</category>
  <category>version control</category>
  <category>github</category>
  <category>tmate</category>
  <category>ssh</category>
  <guid>https://blog.nshephard.dev/posts/tmate/</guid>
  <pubDate>Tue, 10 Jun 2025 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/54529600682_763b548c4f_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Version Control with Jujutsu</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/jujutsu/</link>
  <description><![CDATA[ 





<p>I’d bread about and heard a good things about <a href="https://martinvonz.github.io/jj/latest/" target="_blank">Jujutsu</a>, a new Version Control System developed by Martin von Zweigbergk at Google, although it is not an official Google product and is Open Source Software licensed under the Apache 2.0 license. It has its own internal/native backend but also supports using <a href="https://git-scm.com/" target="_blank">Git</a> in the background to undertake all tasks. As such it can be used as a drop-in replacement for <a href="https://git-scm.com/" target="_blank">Git</a>. A big difference from the familiar Git model is that the working copy is automatically committed. If you check out a commit this introduces a new working-copy commit where changes are recorded (no more <code>detached HEAD</code> state!). I recently purchased a refurbished ThinkPad T490s and decided to give <a href="https://nixos.org" target="_blank">NixOS</a> a whirl so what better opportunity to try Jujutsu than to use it to version control my <code>/etc/nixos</code> directory.</p>
<p>This post covers my experience of getting started with Jujutsu.</p>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Whilst notionally installing and using it on NixOS I use both <a href="https://gentoo.org/" target="_blank">Gentoo</a> and <a href="https://archlinux.org" target="_blank">Arch</a> Linux so have installed it on those systems too.</p>
<section id="gentoo" class="level3">
<h3 class="anchored" data-anchor-id="gentoo">Gentoo</h3>
<p><code>jj</code> is available in the <a href="https://overlays.gentoo.org/" target="_blank">Gentoo Overlays</a> <code>guru</code>.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eselect</span> repository enable guru</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eix-sync</span></span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">emerge</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-av</span> dev-vcs/jj</span></code></pre></div>
</section>
<section id="nixos" class="level3">
<h3 class="anchored" data-anchor-id="nixos">NixOS</h3>
<p><code>jj</code> is also available for <a href="https://nixos.org" target="_blank">NixOS</a>. You can use <a href="https://wiki.nixos.org/wiki/Flakes" target="_blank">flake</a> or <a href="https://wiki.nixos.org/wiki/Home_Manager" target="_blank">HomeManager</a>, I opted for the former and added the following to <code>/etc/nixos/flake.nix</code>. Just add the following to <code>/etc/nixos/configuration.nix</code> to install the most recent release system wide.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">environment.systemPackages</span> = with pkgs{</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jujutsu</span></span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb2-5"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span></code></pre></div>
<p>Then either <code>nixos-rebuild test</code> to install and test the installation (you should now have <code>jj</code> in your command line) and if happy <code>nixos-rebuild switch</code> to make the change permanent and available on the next boot.</p>
</section>
<section id="arch-linux" class="level3">
<h3 class="anchored" data-anchor-id="arch-linux">Arch Linux</h3>
<p>Stable version is included in <a href="https://aur.archlinux.org/packages/jj" target="_blank">packages</a>, although you can keep track of development using the <a href="https://aur.archlinux.org/packages/jj-git" target="_blank">AUR <sub>jj-git</sub></a> package.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pacman</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Syu</span> jj</span></code></pre></div>
</section>
<section id="shell-integration" class="level3">
<h3 class="anchored" data-anchor-id="shell-integration">Shell Integration</h3>
<p>There is integration with both <a href="https://www.gnu.org/software/bash/" target="_blank">Bash</a> and <a href="https://www.zsh.org/" target="_blank">ZSH</a> as well as <a href="https://jj-vcs.github.io/jj/latest/install-and-setup/#command-line-completion" target="_blank">other shells</a>.</p>
<section id="bash" class="level4">
<h4 class="anchored" data-anchor-id="bash">Bash</h4>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> util completion bash<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</section>
<section id="zsh" class="level4">
<h4 class="anchored" data-anchor-id="zsh">ZSH</h4>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">autoload</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> compinit</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">compinit</span></span>
<span id="cb5-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> util completion zsh<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</section>
</section>
<section id="initial-configuration" class="level3">
<h3 class="anchored" data-anchor-id="initial-configuration">Initial Configuration</h3>
<p>As with Git you need to add your <code>user.name</code> and <code>user.email</code> to the configuration.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> config set <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your Name"</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> config set <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> user.email <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your@email.address"</span></span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">We</span> can check the configuration…</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">```</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span></span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> config list</span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ui.editor</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/bin/nano"</span></span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ui.pager</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"less"</span></span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user.email</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nshephard@protonmail.com"</span></span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user.name</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neil Shephard"</span></span></code></pre></div>
<p>This looks ok but I found that <code>/usr/bin/nano</code> is <em>wrong</em> for a NixOS system….</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span> nano</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/run/current-system-sw/bin/nano</span></span></code></pre></div>
<p>..so updated that along with a switch from <code>less</code> to <code>most</code> for paging.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> config set <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> ui.editor <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/run/current-system/sw/bin/nano"</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">config</span> set <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> ui.pager <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/run/current-system/sw/bin/most"</span></span></code></pre></div>
</section>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>I wanted to keep <code>/etc/nixos</code> under version control using <code>jj</code> and as advised in <a href="https://steveklabnik.github.io/jujutsu-tutorial/introduction/introduction.html" target="_blank">Steve’s Jujutsu Tutorial</a> opted to use the Git backend.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> /etc/nixos</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git init</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> st</span>
<span id="cb9-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy changes:</span>
<span id="cb9-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> agenix.nix</span>
<span id="cb9-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> audio.nix</span>
<span id="cb9-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> bluetooth.nix</span>
<span id="cb9-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> configuration.nix</span>
<span id="cb9-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> configuration.nix~</span>
<span id="cb9-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> flake.lock</span>
<span id="cb9-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> flake.nix</span>
<span id="cb9-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> flake.nix~</span>
<span id="cb9-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> hardware-configuration.nix</span>
<span id="cb9-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> home.nix</span>
<span id="cb9-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> home.nix~</span>
<span id="cb9-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> luks.nix</span>
<span id="cb9-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> secrets/secrets.nix</span>
<span id="cb9-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> secrets/slack-vpn.age</span>
<span id="cb9-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> xfce.nix</span>
<span id="cb9-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> xfce.nix~</span>
<span id="cb9-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy : vpqtltus 35cc03d2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-22">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: zzzzzzzz 00000000 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>First things first, I’d already edited some files using Emacs and didn’t want the temporary files it leaves behind included. According to the <a href="https://jj-vcs.github.io/jj/latest/working-copy/#ignored-files" target="_blank">documentation</a> there is no <code>.jjignore</code> yet so we use <code>.gitignore</code> instead listing our files and patterns there.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*~</span></span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\#*</span></span></code></pre></div>
<p>…but the files are already being tracked because they were present when the repository was initialised. We therefore need to untrack them with…</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> file untrack</span></code></pre></div>
<p>This failed because <code>~</code> is used in the syntax for <a href="https://jj-vcs.github.io/jj/latest/filesets/" target="_blank">jj filesets</a> which is a method of defining patterns of files. I tried a few things but in the end couldn’t suss it out in the five minutes so took the brute force option of <code>rm -rf .jj</code> and initialising the repository anew. We can look at the status with <code>jj st</code> and it will use our configured pager (which I’ve set to <code>most</code>) to show the changes.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> st</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy changes:</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> .gitignore</span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> agenix.nix</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> audio.nix</span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> bluetooth.nix</span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> configuration.nix</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> flake.lock</span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> flake.nix</span>
<span id="cb12-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> hardware-configuration.nix</span>
<span id="cb12-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> home.nix</span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> luks.nix</span>
<span id="cb12-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> secrets/secrets.nix</span>
<span id="cb12-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> secrets/slack-vpn.age</span>
<span id="cb12-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A</span> xfce.nix</span>
<span id="cb12-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy : nxzzlvzo 43e6338e <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: zzzzzzzz 00000000 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>We can see the changes (i.e.&nbsp;all new files) are already noted as being under the working copy. We can also use <code>jj describe</code> to look at the changes and add a description. If we use the <code>-m "A message"</code> flag and value we can add a message and it will replace the <code>no description set</code> shown by <code>jj st</code>. With <code>jj describe</code> the information is opened up in an editor, and if a message has already been set it will be shown at the top. Note that lines beginning with <code>JJ</code> will be removed (i.e.&nbsp;they are comment lines). On adding a message or changing it the commit ID changes, the change ID remains the same but the commit ID changes over time allowing us to refer to individual commits rather than a whole change set.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> describe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Initial commit with jj :)"</span></span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy now at: nxzzlvzo d2d192ec Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit      : zzzzzzzz 00000000 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<section id="new-commits" class="level3">
<h3 class="anchored" data-anchor-id="new-commits">New commits</h3>
<p>We’re ready to make some changes, but unlike Git we can make our commit <em>first</em> rather than after having made the changes. We do this with <code>jj new</code></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> new</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy now at: mkrknnyv d20e2368 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit      : nxzzlvzo d2d192ec Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>We can now modify a file, in this case I tidied up <code>/etc/nixos/configuration.nix</code> and put all <code>network.*</code> options within a <code>network = {...};</code> block and similar aggregated all <code>nix.*</code> options into a <code>nix = {...};</code> block.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> st</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy changes:</span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">M</span> configuration.nix</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy : mkrknnyv 31f1c759 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: nxzzlvzo d2d192ec Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>We can see the full commit history with <code>jj log</code> (no surprisese there!)</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@</span>  mkrknnyv nshephard@protonmail.com 2024-12-21 16:20:53 31f1c759</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span>  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  zzzzzzzz root<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">00000000</span></span></code></pre></div>
<p>It’s interesting to note that the bold/highlighting of the start of commit hashes gives you an indication of the unique component of that hash (but you’ll have to take my word for that as I’ve not bothered to copy that over to the blog!).</p>
<p>It is important to note that there is no need to explicitly make a commit, the work done/changes are already part of the current commit. When you are ready to start the next piece of work you <code>jj new</code> (optionally with <code>-m "&lt;message&gt;"</code>) to start a new piece of work.</p>
<p>This naturally leads to the question of how to undo work that you have done With <code>jj</code> you can move back to commits using <code>jj edit @-</code> or referring to the commit directly with <code>jj edit &lt;hash&gt;</code> and then use</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> edit @-</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> abandon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>hash_of_latest_commit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
</section>
</section>
<section id="diffing" class="level2">
<h2 class="anchored" data-anchor-id="diffing">Diffing</h2>
<p>You can view differences with <code>jj diff</code> and it will show the differences between the current “<code>HEAD</code>” and the previous commit. I use <code>difftastic</code> (see Configuration section below) so have colourized output which isn’t shown below.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb18-1">    home.nix --- Nix</span>
<span id="cb18-2">    152 152       urldecode = "python3 -c 'import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))'";</span>
<span id="cb18-3">    153 153       urlencode = "python3 -c 'import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))'";</span>
<span id="cb18-4">    154 154     };</span>
<span id="cb18-5">    ... 155     # initExtra = ''</span>
<span id="cb18-6">    ... 156     #   if command -v keychain &gt; /dev/null 2&gt;&amp;1; then eval $(keychain --eval --nogui ${keyFilename} --quiet); fi</span>
<span id="cb18-7">    ... 157     # '';</span>
<span id="cb18-8">    155 158   };</span>
<span id="cb18-9">    156 159</span>
<span id="cb18-10">    157 160   programs.emacs = {</span>
<span id="cb18-11"></span>
<span id="cb18-12">    configuration.nix --- 1/2 --- Nix</span>
<span id="cb18-13">    177   # Some programs need SUID wrappers, can be configured further or are      177   # Some programs need SUID wrappers, can be configured further or are</span>
<span id="cb18-14">    178   # started in user sessions.                                               178   # started in user sessions.</span>
<span id="cb18-15">    179   # programs.mtr.enable = true;                                             179   # programs.mtr.enable = true;</span>
<span id="cb18-16">    180   programs.gnupg.agent = {                                                  180   programs = {</span>
<span id="cb18-17">    ...                                                                             181     gnupg.agent = {</span>
<span id="cb18-18">    181     enable = true;                                                          182       enable = true;</span>
<span id="cb18-19">    ...                                                                             183       # enableSSHSupport = true;</span>
<span id="cb18-20">    ...                                                                             184     };</span>
<span id="cb18-21">    182     enableSSHSupport = true;                                                185     ssh.startAgent = true;</span>
<span id="cb18-22">    183   };                                                                        186   };</span>
<span id="cb18-23">    184                                                                             187</span>
<span id="cb18-24">    185   # List services that you want to enable:                                  188   # List services that you want to enable:</span>
<span id="cb18-25">    186   services = {                                                              189   services = {</span>
<span id="cb18-26"></span>
<span id="cb18-27">    configuration.nix --- 2/2 --- Nix</span>
<span id="cb18-28">    210 213     fprintd = {</span>
<span id="cb18-29">    211 214       enable = true;</span>
<span id="cb18-30">    212 215     };</span>
<span id="cb18-31">    ... 216     # yubikey</span>
<span id="cb18-32">    ... 217     yubikey-agent = {</span>
<span id="cb18-33">    ... 218       enable = true;</span>
<span id="cb18-34">    ... 219     };</span>
<span id="cb18-35">    213 220   };</span>
<span id="cb18-36">    214 221   # Open ports in the firewall.</span>
<span id="cb18-37">    215 222   # networking.firewall.allowedTCPPorts = [ ... ];</span></code></pre></div>
<p>If you want to look at differences between two specific commits you can use the <code>--from</code> and <code>--to</code> options (the former likely being more useful than the later).</p>
</section>
<section id="remotes" class="level2">
<h2 class="anchored" data-anchor-id="remotes">Remotes</h2>
<p>I wanted to back my work up remotely and have a few options the ubiquitous <a href="https://github.com/" target="_blank">GitHub</a>, <a href="https://gitlab.com/" target="_blank">GitLab</a>, or my self-hosted <a href="https://forgejo.org/" target="_blank">Forgejo</a>. I opted for the later which is hosted on the VPS I pay for with <a href="https://ovh.co.uk" target="_blank">OVH</a>.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git remote add origin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>git@forgejo.nshephard.dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>:nshephard/crow.git</span></code></pre></div>
<p>However trying to push failed with a rather cryptic and unhelpful message.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git push</span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Changes</span> to push to origin:</span>
<span id="cb20-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Add</span> bookmark trunk to bfce9c9ab2aa</span>
<span id="cb20-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Error:</span> failed to connect to forgejo.nshephard.dev: Invalid argument<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Os <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>I use a non-standard port for SSH on my server (i.e.&nbsp;not <code>22</code> ). The “trick” here was to use the <code>scp</code> like syntax to specifying the <code>url</code> under the <code>remote</code> in the <code>git</code> configuration which resides in <code>.jj/repo/store/git/config</code></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>]</span>
<span id="cb21-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = ssh://git@forgejo.nshephard.dev:2222/~/nshephard/crow.git</span></code></pre></div>
<p>Success, I can reach the remote, but it fails to authenticate.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb22-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">jj</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">git</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">push</span></span>
<span id="cb22-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Changes</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">to</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">push</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">to</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">origin</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Add</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bookmark</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">trunk</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">to</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bfce9c9ab2aa</span></span>
<span id="cb22-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Error</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">failed</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">to</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">authenticate</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">SSH</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">session</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Unable</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">to</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">extract</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">from</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">private</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">file</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Wrong</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">passphrase</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">or</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">invalid</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unrecognized</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">private</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">key</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">file</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">format</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Ssh</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb22-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Hint</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Jujutsu</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">uses</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">libssh2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">which</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">doesn't respect ~/.ssh/config. Does `ssh -F /dev/null` to the host work?</span></span></code></pre></div>
<p>Checking my <code>~/.ssh/config</code> and my <a href="https://forgejo.org/" target="_blank">Forgejo</a> configuration and I realised that I have it configured to run as user <code>forgejo</code>.</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[remote</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">origin"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb23-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ssh</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">://</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">forgejo</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">@</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">forgejo.nshephard.dev</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">2222</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">nshephard</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">crow.git</span></span></code></pre></div>
</section>
<section id="bookmarks-aka-branches" class="level2">
<h2 class="anchored" data-anchor-id="bookmarks-aka-branches">Bookmarks (aka branches)</h2>
<p>These are mainly for compatibility with Git, <code>jj</code> actually prefers to use anonymous rather than named branches (sometimes called a “branchless” workflow). You create a bookmark at a given point and it stays there until you move it. This is kind of weird compared to Git where commits are stacked on top of each other to make branches and you are always checked out on the <code>HEAD</code> commit at the top or otherwise in a “detached” status.</p>
<p>Create a bookmark with…</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark create <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>If you want to move a bookmark after its creation you can do so…</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark move <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>bookmark_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> --to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>revision<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Note that the default <code>--to</code> is <code>@</code> so <code>jj bookrmark move &lt;bookmark_name&gt;</code> will move it to your current location, whether that is the tip or not.</p>
</section>
<section id="merging-branches" class="level2">
<h2 class="anchored" data-anchor-id="merging-branches">Merging Branches</h2>
<p>I found when it came to pushing to my <a href="https://forgejo.org/" target="_blank">Forgejo</a> instance where I had created the repository I had to first <code>jj git pull</code> to get the initial commit there and then setup remote tracking.</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git push</span>
<span id="cb26-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Warning:</span> Non-tracking remote bookmark trunk@origin exists</span>
<span id="cb26-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Hint:</span> Run <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark track trunk@origin<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> to import the remote bookmark.</span>
<span id="cb26-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nothing</span> changed.</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git fetch</span>
<span id="cb26-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bookmark:</span> trunk@origin <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">new</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> untracked</span>
<span id="cb26-8"></span>
<span id="cb26-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark track trunk@origin</span>
<span id="cb26-10"></span>
<span id="cb26-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> log</span>
<span id="cb26-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 trunk@origin 12c4747e</span>
<span id="cb26-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  Initial commit</span>
<span id="cb26-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> @  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 trunk bfce9c9a</span>
<span id="cb26-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb26-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb26-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding tree to systemPackages</span>
<span id="cb26-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb26-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  ZSH home.nix configuration</span>
<span id="cb26-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb26-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  system: emacs daemon for user</span>
<span id="cb26-22">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb26-23">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb26-24">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb26-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb26-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb26-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding difftastic</span>
<span id="cb26-28">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb26-29">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Tidying up nix and network sections</span>
<span id="cb26-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ○  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb26-31">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├─╯</span>  Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb26-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  zzzzzzzz root<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">00000000</span></span>
<span id="cb26-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#+end_</span></span></code></pre></div>
<p>At this point the two “branches” (<code>trunk@origin</code> and the local <code>trunk</code>) have diverged and are in conflict, preventing me from pushing</p>
<p>jj git push Warning: Bookmark trunk is conflicted Hint: Run <code>jj bookmark list</code> to inspect, and use <code>jj bookmark set</code> to fix it up. Nothing changed.</p>
<p>There is an old command in Jujutsu to <code>jj merge</code> but, as the help informs you, it has been deprecated in favour of <code>jj new</code>. This isn’t too dissimilar to Git though since “merges” are just commits that bring two branches together. The syntax for this is <code>jj new [OPTIONS] [REVISIONS]</code>, by default the <code>REVISIONS</code> is simply <code>@</code> the current “<code>HEAD</code>”, but specifying more than one will merge the two together. You can of course include <code>-m "Message about merging"</code>. Taking the above output from <code>jj log</code> I can make a merge with the following (the minimal hashes are highlighted in the terminal but not above and here the <code>to my</code> refers to merging to the latest commit).</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> new <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"merge: local work with remote init"</span> to my</span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy now at: oupkqwzo da0ebd37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conflict</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge:</span> local work with remote init</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit      : tossulss bfce9c9a trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">??</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Add</span> pcscd to services for GnuPG pinentry</span>
<span id="cb27-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit      : myqxkksp 12c4747e trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">??</span> trunk@origin <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Initial</span> commit</span>
<span id="cb27-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Added</span> 2 files, modified 1 files, removed 0 files</span>
<span id="cb27-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">There</span> are unresolved conflicts at these paths:</span>
<span id="cb27-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.gitignore</span>    2-sided conflict</span></code></pre></div>
<section id="conflicts" class="level3">
<h3 class="anchored" data-anchor-id="conflicts">Conflicts</h3>
<p>The manual covers <a href="https://jj-vcs.github.io/jj/latest/conflicts/" target="_blank">conflict</a> resolution and its worth reading that. That I encountered merge conflicts isn’t entirely unexpected I had created <code>.gitignore</code> both locally and on the remote so bringing them together the is natural. Lets look at this…</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> .gitignore</span>
<span id="cb28-2"></span>
<span id="cb28-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> Conflict <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> of 1</span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%%%%%%%</span> Changes from base to side <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1</span></span>
<span id="cb28-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+##</span> Emacs temporary files</span>
<span id="cb28-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+*~</span></span>
<span id="cb28-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+\#*</span></span>
<span id="cb28-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++++++</span> Contents of side <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#2</span></span>
<span id="cb28-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---&gt; Nix</span></span>
<span id="cb28-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ignore build outputs from performing a nix-build or `nix build` command</span></span>
<span id="cb28-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">result</span></span>
<span id="cb28-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">result-*</span></span>
<span id="cb28-13"></span>
<span id="cb28-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span> Conflict <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> of 1 ends</span></code></pre></div>
<p>This is fairly similar to Git merge conflicts, but I like the <code>side 1~/~side 2</code> notation (you get the same in Git by default but its occluded and you have to read up to understand that first bit delimited by ‘&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;’ is from the current branch and the other bit is from the branch that is being merged).</p>
<p>I know I want both of these included in <code>.gitignore</code> so I make the changes, removing all the conflict markup and save the file. This tidies up the current commit, there is no need to make another commit to take a snapshot of those changes as there is in Git. However the bookmarks are still in conflict so we need to set that to the correct commit.</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> st</span>
<span id="cb29-2"></span>
<span id="cb29-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy changes:</span>
<span id="cb29-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">M</span> .gitignore</span>
<span id="cb29-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy : oupkqwzo f10df751 merge: local work with remote init</span>
<span id="cb29-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: tossulss bfce9c9a trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">??</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Add</span> pcscd to services for GnuPG pinentry</span>
<span id="cb29-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: myqxkksp 12c4747e trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">??</span> trunk@origin <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Initial</span> commit</span>
<span id="cb29-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">These</span> bookmarks have conflicts:</span>
<span id="cb29-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">trunk</span></span>
<span id="cb29-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Use</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark list<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> to see details. Use <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark set <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> -r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>rev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> to resolve.</span>
<span id="cb29-11"></span>
<span id="cb29-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> bookmark set trunk <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> ou</span>
<span id="cb29-13"></span>
<span id="cb29-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> st</span>
<span id="cb29-15"></span>
<span id="cb29-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy changes:</span>
<span id="cb29-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">M</span> .gitignore</span>
<span id="cb29-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy : oupkqwzo f10df751 trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge:</span> local work with remo</span>
<span id="cb29-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: tossulss bfce9c9a Add pcscd to services for GnuPG pine</span>
<span id="cb29-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit: myqxkksp 12c4747e trunk@origin <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Initial</span> commit</span>
<span id="cb29-21"></span>
<span id="cb29-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> log</span>
<span id="cb29-23"></span>
<span id="cb29-24">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@</span>    oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> f10df751</span>
<span id="cb29-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├─╮</span>  merge: local work with remote init</span>
<span id="cb29-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ◆  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 trunk@origin 12c4747e</span>
<span id="cb29-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Initial commit</span>
<span id="cb29-28">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 bfce9c9a</span>
<span id="cb29-29">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb29-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb29-31">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding tree to systemPackages</span>
<span id="cb29-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb29-33">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  ZSH home.nix configuration</span>
<span id="cb29-34">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb29-35">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  system: emacs daemon for user</span>
<span id="cb29-36">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb29-37">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb29-38">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb29-39">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb29-40">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb29-41">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding difftastic</span>
<span id="cb29-42">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb29-43">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Tidying up nix and network sections</span>
<span id="cb29-44">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">○</span> │  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb29-45">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├─╯</span>  Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb29-46">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  zzzzzzzz root<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">00000000</span></span></code></pre></div>
<p>We’ve merged out branches but <code>trunk@origin</code> is behind that merge we can bring that up-to-date by pushing</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> git push</span>
<span id="cb30-2"></span>
<span id="cb30-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Changes</span> to push to origin:</span>
<span id="cb30-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Move</span> forward bookmark trunk from 12c4747edb21 to f10df751ab04</span>
<span id="cb30-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Warning:</span> The working-copy commit in workspace <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'default'</span> became immutable, so a new commit has been created on top of it.</span>
<span id="cb30-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Working</span> copy now at: tuwxwnqw 4e3890c1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb30-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parent</span> commit      : oupkqwzo f10df751 trunk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge:</span> local work with remote init</span>
<span id="cb30-8"></span>
<span id="cb30-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> log</span>
<span id="cb30-10"></span>
<span id="cb30-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@</span>  tuwxwnqw nshephard@protonmail.com 2024-12-23 11:58:36 4e3890c1</span>
<span id="cb30-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb30-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk f10df751</span>
<span id="cb30-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  merge: local work with remote init</span>
<span id="cb30-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">~</span></span></code></pre></div>
<p>Not sure where the rest of the commit history is but it is showing up on the ForgeJo repository <a href="https://forgejo.nshephard.dev/nshephard/crow/commits/branch/trunk" target="_blank">commit history</a>. I’ll return to that later.</p>
</section>
</section>
<section id="revisions-and-revsets" class="level2">
<h2 class="anchored" data-anchor-id="revisions-and-revsets">Revisions and Revsets</h2>
<p>A revision set or “revset” is a range of commits and <code>jj</code> has its own language for describing refsets.</p>
<section id="symbols" class="level3">
<h3 class="anchored" data-anchor-id="symbols">Symbols</h3>
<p>We’ve already encountered <code>@</code> which points to our current working copy that we have checked out (sometimes “<code>HEAD</code>” but could be elsewhere in history).</p>
</section>
<section id="operators" class="level3">
<h3 class="anchored" data-anchor-id="operators">Operators</h3>
<p>The tutorial notes the following common operators.</p>
<ul>
<li><code>x &amp; y</code>: changes that are in both <code>x</code> and <code>y</code>.</li>
<li><code>x | y</code>: changes that are in either <code>x</code> or <code>y</code>.</li>
<li><code>::x</code> Ancestors of <code>x</code>.</li>
<li><code>x::</code> Descendants of <code>x</code>.</li>
</ul>
<p>We found that we couldn’t review the history of the current checked out commit (<code>@</code>) any more but lets see if we can use this new knowledge to find view the log history. We want to look at all ancestors so we can use <code>::t</code> to view the ancestors of the most recent, empty, commit.</p>
<p>****NB**** It might be worth adding a description with <code>jj describe</code> before undertaking work, remember that the changes in the working directory are always part of the current commit.</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jj</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> ::t</span>
<span id="cb31-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@</span>  tuwxwnqw nshephard@protonmail.com 2024-12-23 11:58:36 4e3890c1</span>
<span id="cb31-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">empty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">no</span> description set<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb31-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>    oupkqwzo nshephard@protonmail.com 2024-12-23 11:51:49 trunk f10df751</span>
<span id="cb31-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├─╮</span>  merge: local work with remote init</span>
<span id="cb31-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> ◆  myqxkksp nshephard@noreply.forgejo.nshephard.dev 2024-12-21 15:47:13 12c4747e</span>
<span id="cb31-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Initial commit</span>
<span id="cb31-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  tossulss nshephard@protonmail.com 2024-12-23 07:28:16 bfce9c9a</span>
<span id="cb31-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add pcscd to services for GnuPG pinentry</span>
<span id="cb31-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  olrmoynt nshephard@protonmail.com 2024-12-22 23:03:58 dcd199d9</span>
<span id="cb31-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding tree to systemPackages</span>
<span id="cb31-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  wpttsonz nshephard@protonmail.com 2024-12-22 22:39:32 ca5be2ed</span>
<span id="cb31-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  ZSH home.nix configuration</span>
<span id="cb31-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  twrvtqty nshephard@protonmail.com 2024-12-22 12:27:39 bb4c6bca</span>
<span id="cb31-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  system: emacs daemon for user</span>
<span id="cb31-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  xuzumvqs nshephard@protonmail.com 2024-12-21 22:56:16 ee5dd297</span>
<span id="cb31-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Add btop and htop to system.Packages</span>
<span id="cb31-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  zrxyptxn nshephard@protonmail.com 2024-12-21 22:47:29 75fbf987</span>
<span id="cb31-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Minor tweaks to mark ends of blocks in xfce.nix</span>
<span id="cb31-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  zkowzsvy nshephard@protonmail.com 2024-12-21 20:41:10 c20e2a66</span>
<span id="cb31-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Adding difftastic</span>
<span id="cb31-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  mkrknnyv nshephard@protonmail.com 2024-12-21 16:31:47 18b4e7b1</span>
<span id="cb31-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span> │  Tidying up nix and network sections</span>
<span id="cb31-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span> │  nxzzlvzo nshephard@protonmail.com 2024-12-21 15:48:47 d2d192ec</span>
<span id="cb31-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├─╯</span>  Initial commit with jj :<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb31-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">◆</span>  zzzzzzzz root<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">00000000</span></span></code></pre></div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>The revset language also includes a number of functions that help filter log messages such as <code>author()</code>, <code>description()</code>, <code>ancestors(x, depth)</code> (an extended version of <code>::x</code>) and <code>parents()</code>.</p>
<p>I’m not going to dig too deep into these at the moment as I have limited use for them right now but see the <a href="https://steveklabnik.github.io/jujutsu-tutorial/branching-merging-and-conflicts/revsets.html" target="_blank">Figuring out where our changes are with revsets - Steve’s Jujutsu Tutorial</a> and the <a href="https://jj-vcs.github.io/jj/latest/revsets/" target="_blank">Revset language</a> of the official documentation.</p>
</section>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<p>You can edit the <a href="https://jj-vcs.github.io/jj/latest/config/" target="_blank">configuration</a> either at the <code>--user</code> or <code>--repo</code> level with <code>jj config edit --[user|repo]</code> (to find the path of the users configuration file use <code>jj config path --user</code>, repository configuration is in <code>.jj/repo/config.toml</code>). These are <a href="id:80ebb47c-7c3e-4aa4-93c4-bb15f0ee7a01" target="_blank">TOML</a> files.</p>
<p>I enabled color using the brilliant <a href="https://difftastic.wilfred.me.uk/" target="_blank">difftastic</a></p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode conf code-with-copy"><code class="sourceCode toml"><span id="cb32-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[user]</span></span>
<span id="cb32-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neil Shephard"</span></span>
<span id="cb32-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">email</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nshephard@protonmail.com"</span></span>
<span id="cb32-4"></span>
<span id="cb32-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[ui]</span></span>
<span id="cb32-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">editor</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/run/current-system/sw/bin/nano"</span></span>
<span id="cb32-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pager</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/run/current-system/sw/bin/most"</span></span>
<span id="cb32-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">color</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"always"</span></span>
<span id="cb32-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Use Difftastic by default</span></span>
<span id="cb32-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">diff.tool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"difft"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--color=always"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$left"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$right"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<p>…there are a lot more configuration options available (see <a href="https://jj-vcs.github.io/jj/latest/config/" target="_blank">configuration</a> documentation for full details).</p>
</section>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<p>Two popular workflows are described in the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/" target="_blank">tutorial</a>, the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/the-squash-workflow.html" target="_blank">Squash Workflow</a> and the <a href="https://steveklabnik.github.io/jujutsu-tutorial/real-world-workflows/the-edit-workflow.html" target="_blank">Edit Workflow</a>.</p>
<section id="squash-workflow" class="level3">
<h3 class="anchored" data-anchor-id="squash-workflow">Squash Workflow</h3>
<p>This is kind of link <code>git commit --amend</code> where changes are added to the existing <code>HEAD</code> commit of the branch. The <code>jj</code> workflow has at it’s head (denoted by <code>@</code> in the <code>jj log</code> output) the “unstaged” changes and <code>jj squash</code> adds them to the previous commit, which is typically created <em>before</em> making any changes with a description of the intended work (you could do this with <code>git commit -a --allow-empty -m "bug: I'm going to squash a bug!"</code> ) and then repeatedly <code>git commit --amend</code> as we complete the work. With <code>jj</code> squash workflow though it encourages making smaller more atomic commits and reduces the amount of “/fixing an error/typo” commits by those averse to using <code>--amend</code>. By default all files are included but you can specify just those files you want to include by listing them.</p>
<p>Jujutsu also allows interactive selection of lines to edit via the <code>-i</code> flag. A terminal interface opens and it is possible to select which lines to include prior to making the commit. After having selected all the changes simply hit `c` to confirm them.</p>
<p>If you decide you don’t want to keep the work you can <code>jj abandon</code> the work in progress and it reverts all changes. In fact <code>jj squash</code> offers much of the functionality of <code>git rebase -i</code>.</p>
</section>
<section id="edit-workflow" class="level3">
<h3 class="anchored" data-anchor-id="edit-workflow">Edit Workflow</h3>
<p>Continuing from the previous example we make some more changes, but rather than using <code>new</code>, because there is already an empty change there as we squashed the existing changes into the previous commit leaving <code>@</code> empty, we use <code>jj describe -m "message"</code> to add a message to the empty commit that we are <em>not</em> going to squash. Now make the changes and when ready to start a new piece of work you can use <code>jj new -m ""</code>.</p>
<section id="editing-older-commits" class="level4">
<h4 class="anchored" data-anchor-id="editing-older-commits">Editing older commits</h4>
<p>In Git this can be done either by adding a <code>git commit --fixup</code> or using <code>git rebase -i</code> tp interactively squash commits. In <code>jj</code> though we can use <code>jj new -B @ -m "a new message"</code> and what this does is add a new commit before the <code>~@</code> commit (other references can be used if you want to modify a commit further back in the commit history). You get for free a rebase of descendant commits, of course conflicts can arise but this command <em>will</em> always complete without resolving the conflicts (yet!).</p>
<p>The “<code>HEAD</code>” of the “branch” has been moved to this commit and changes can be made and saved (they’re already included as there is no staging in Jujutsu). When done you can return to the “<code>HEAD</code>” using <code>jj edit &lt;minimal_hash&gt;</code> or the convenience shortcut <code>jj next --edit</code> which moves <code>@</code> to the “child” commit and allows editing.</p>
<p>You can edit earlier commits with <code>jj edit @-</code> for the previous commit or <code>jj edit &lt;commit&gt;</code></p>
</section>
</section>
</section>
<section id="ideinterfaces" class="level2">
<h2 class="anchored" data-anchor-id="ideinterfaces">IDE/Interfaces</h2>
<p>Being an Emacs user I naturally wanted to use Jujutsu via Emacs and was hoping for a <a href="https://magit.vc/" target="_blank">Magit</a> equivalent. Being considerably newer there isn’t anything quite as powerful as Magit just yet but there is work in progress in the form of <a href="https://git.sr.ht/~puercopop/jujutsushi" target="_blank">jujutsushi - A emacs interface to jujutsu</a> and <a href="https://github.com/bennyandresen/jujutsu.el" target="_blank">jujutsu.el: An Emacs interface for jujutsu</a> (although the former’s author has stated they have deprioritized development in light of the later, see <a href="https://www.reddit.com/r/emacs/comments/1hbmpub/comment/m1inz3i/" target="_blank">here</a>).</p>
<p>The <a href="https://github.com/jj-vcs/jj/wiki/" target="_blank">wiki</a> is a useful resource on IDE integration</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>After a few weeks or so tinkering with Jujutsu/<sub>jj</sub> I’ve found there are a number of features that differ from my Git experience to date. Having a mental model of Version Control is important for these to make sense. Obviously I need to spend longer working with the system to have a deeper understanding and appreciation of how it works and a better comparison to Git, but first impressions are good, although switching full scale would mean abandoning the amazing <a href="https://magit.vc/" target="_blank">Magit</a> which is one of the best <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> packages going, but there are some Emacs packages for working with Jujutsu in the pipeline.</p>
<ul>
<li>All changes are “staged”.</li>
<li>Branch names are redundant but are available (as “bookmarks”) for compatibility with Git and these need updating to the most recent commit.</li>
<li>Moving around commits seems more intuitive and there is no warning about the dangers of being in a “detached HEAD” state.</li>
<li>As a consequence it’s easy to update changes that should have been in older commits.</li>
<li>When this happens rebasing descendent commits is free, even if conflicts arise, they are still committed. They will need resolving eventually but you can do this once on the commit you wish to rather than repeatedly and having to rely on <a href="https://git-scm.com/book/en/v2/Git-Tools-Rerere" target="_blank"><code>git rerere</code></a></li>
</ul>
<p>I’d highly recommend reading some other people’s blogs on Jujutsu for a more technical understanding and broader view. In particular I liked the post <a href="https://kubamartin.com/posts/introduction-to-the-jujutsu-vcs/" target="_blank">Jujutsu VCS Introduction and Patterns | Kuba Martin</a>.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://martinvonz.github.io/jj/latest/" target="_blank">Jujutsu Documentation</a></li>
<li><a href="https://github.com/martinvonz/jj#command-line-completion" target="_blank">martinvonz/jj: A Git-compatible VCS that is both simple and powerful</a></li>
</ul>
<section id="tutorials" class="level3">
<h3 class="anchored" data-anchor-id="tutorials">Tutorials</h3>
<ul>
<li><a href="https://steveklabnik.github.io/jujutsu-tutorial/introduction/introduction.html" target="_blank">Steve’s Jujutsu Tutorial</a></li>
</ul>
</section>
<section id="emacs-packages" class="level3">
<h3 class="anchored" data-anchor-id="emacs-packages">Emacs Packages</h3>
<ul>
<li><a href="https://git.sr.ht/~puercopop/jujutsushi" target="_blank">jujutsushi - A emacs interface to jujutsu</a></li>
<li><a href="https://github.com/bennyandresen/jujutsu.el" target="_blank">jujutsu.el: An Emacs interface for jujutsu, inspired by magit and humbly not attempting to match it in scope.</a></li>
<li><a href="https://codeberg.org/vifon/vc-jj.el" target="_blank">vc-jj.el</a></li>
</ul>
</section>
<section id="blogs" class="level3">
<h3 class="anchored" data-anchor-id="blogs">Blogs</h3>
<ul>
<li><a href="https://v5.chriskrycho.com/essays/jj-init/" target="_blank">jj init — Sympolymathesy, by Chris Krycho</a></li>
<li><a href="https://reasonablypolymorphic.com/blog/jj-strategy/index.html" target="_blank">Jujutsu Strategies :: Reasonably Polymorphic</a></li>
<li><a href="https://ofcr.se/jujutsu-merge-workflow" target="_blank">A Better Merge Workflow with Jujutsu | ofcrse by Benjamin Tan</a></li>
<li><a href="https://tonyfinn.com/blog/jj/" target="_blank">Jujutsu (jj), a git compatible VCS - Tony Finn</a></li>
<li><a href="https://www.felesatra.moe/blog/2024/12/23/jj-is-great-for-the-wrong-reason" target="_blank">Jujutsu is great for the wrong reason</a></li>
<li><a href="https://kubamartin.com/posts/introduction-to-the-jujutsu-vcs/" target="_blank">Jujutsu VCS Introduction and Patterns | Kuba Martin</a></li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2025,
  author = {Shephard, Neil},
  title = {Version {Control} with {Jujutsu}},
  date = {2025-02-08},
  url = {https://blog.nshephard.dev/posts/jujutsu/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2025" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2025. <span>“Version Control with Jujutsu.”</span>
February 8, 2025. <a href="https://blog.nshephard.dev/posts/jujutsu/">https://blog.nshephard.dev/posts/jujutsu/</a>.
</div></div></section></div> ]]></description>
  <category>jujutsu</category>
  <category>git</category>
  <category>version control</category>
  <guid>https://blog.nshephard.dev/posts/jujutsu/</guid>
  <pubDate>Sat, 08 Feb 2025 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/54119567525_4e969d081a_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Git - Worktrees</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/git-worktrees/</link>
  <description><![CDATA[ 





<p>A common task in Git workflow is the need to switch/checkout branches and check work that has been done on another branch, running tests, perhaps contributing to code that is out for Pull/Merge Review. If you’ve work in progress on your own branch this means either making a commit or stashing the work to come back to at a later date. Neither of these are particularly problematic as you can <code>git pop</code> stashed work to restore it or <code>git commit --amend</code>, or <code>git commit --fixup</code> and squash commits to maintain small atomic commits and avoid cluttering up the commit history with commits such as “<em>Saving work to review another branch</em>”. But, perhaps unsurprisingly, Git has another way of helping your workflow in this situation. Rather than having branches you can use “<em>worktrees</em>”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/3027/3018839068_ff71bcb5f5_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.flickr.com/photos/slackline/3018839068/" target="_blank">Natures Arches by Me</a></figcaption>
</figure>
</div>
<p>Normally when you’ve <code>git clone</code>’d a repository all configuration files for working with the repository are saved to the repository directory under <code>.git</code> <em>and</em> all files in their current state on the <code>main</code> branch are also copied to the repository directory. If we clone the <a href="https://github.com/ns-rse/pytest-examples" target="_blank">pytest-examples</a> directory we can look at its contents using <code>tree -afHD -L 2</code> (this limits the depth as we don’t need to look deep inside the <code>.git</code> or <code>mypy</code> directories which contain lots of files).</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone git@github.com:ns-rse/pytest-examples.git</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> pytest-examples</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tree</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-afhD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 2</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[4.0K</span> Mar 11 07:26]  .</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 52K Jan  5 11:26]  ./.coverage</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 11 07:26]  ./.git</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 749 Jan  5 11:30]  ./.git/COMMIT_EDITMSG</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 394 Jan  5 11:28]  ./.git/COMMIT_EDITMSG~</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 479 Feb 17 14:08]  ./.git/config</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 556 Feb 17 14:06]  ./.git/config~</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  73 Jan  1 13:24]  ./.git/description</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 222 Mar 11 07:26]  ./.git/FETCH_HEAD</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  21 Mar 11 07:26]  ./.git/HEAD</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  1 13:27]  ./.git/hooks</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.3K Mar 11 07:26]  ./.git/index</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  1 13:24]  ./.git/info</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  1 13:24]  ./.git/logs</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Mar 11 07:26]  ./.git/objects</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  41 Mar 11 07:26]  ./.git/ORIG_HEAD</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 112 Jan  3 15:57]  ./.git/packed-refs</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  1 13:24]  ./.git/refs</span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Jan  1 13:31]  ./.git/rr-cache</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Jan  2 11:52]  ./.github</span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Jan  3 15:57]  ./.github/workflows</span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [3.0K Jan  2 12:06]  ./.gitignore</span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.0K Jan  1 13:24]  ./LICENSE</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 293 Jan  2 12:06]  ./.markdownlint-cli2.yaml</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Jan  5 11:27]  ./.mypy_cache</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 12K Jan  5 11:28]  ./.mypy_cache/3.11</span>
<span id="cb1-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 190 Jan  2 10:39]  ./.mypy_cache/CACHEDIR.TAG</span>
<span id="cb1-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [  34 Jan  2 10:39]  ./.mypy_cache/.gitignore</span>
<span id="cb1-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.7K Mar 11 07:26]  ./.pre-commit-config.yaml</span>
<span id="cb1-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 763 Jan  1 13:25]  ./.pre-commit-config.yaml~</span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 18K Jan  2 12:06]  ./.pylintrc</span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.8K Mar 11 07:26]  ./pyproject.toml</span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.7K Jan  1 17:36]  ./pyproject.toml~</span>
<span id="cb1-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Jan  1 19:04]  ./.pytest_cache</span>
<span id="cb1-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 191 Jan  1 19:04]  ./.pytest_cache/CACHEDIR.TAG</span>
<span id="cb1-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  37 Jan  1 19:04]  ./.pytest_cache/.gitignore</span>
<span id="cb1-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 302 Jan  1 19:04]  ./.pytest_cache/README.md</span>
<span id="cb1-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Jan  1 19:04]  ./.pytest_cache/v</span>
<span id="cb1-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 11 07:26]  ./pytest_examples</span>
<span id="cb1-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.3K Mar 11 07:26]  ./pytest_examples/divide.py</span>
<span id="cb1-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 179 Mar 11 07:26]  ./pytest_examples/__init__.py</span>
<span id="cb1-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  5 11:18]  ./pytest_examples/__pycache__</span>
<span id="cb1-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 491 Mar 11 07:26]  ./pytest_examples/shapes.py</span>
<span id="cb1-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [ 390 Jan  2 13:34]  ./pytest_examples/shapes.py~</span>
<span id="cb1-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Jan  2 16:09]  ./pytest_examples.egg-info</span>
<span id="cb1-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [   1 Jan  2 16:09]  ./pytest_examples.egg-info/dependency_links.txt</span>
<span id="cb1-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [3.1K Jan  2 16:09]  ./pytest_examples.egg-info/PKG-INFO</span>
<span id="cb1-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 481 Jan  2 16:09]  ./pytest_examples.egg-info/requires.txt</span>
<span id="cb1-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 446 Jan  2 16:09]  ./pytest_examples.egg-info/SOURCES.txt</span>
<span id="cb1-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [  16 Jan  2 16:09]  ./pytest_examples.egg-info/top_level.txt</span>
<span id="cb1-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 602 Jan  3 15:57]  ./README.md</span>
<span id="cb1-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [   0 Jan  1 13:31]  ./README.md~</span>
<span id="cb1-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Jan  1 13:30]  ./.ruff_cache</span>
<span id="cb1-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  2 11:57]  ./.ruff_cache/0.1.8</span>
<span id="cb1-58"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  43 Jan  1 13:30]  ./.ruff_cache/CACHEDIR.TAG</span>
<span id="cb1-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [   1 Jan  1 13:30]  ./.ruff_cache/.gitignore</span>
<span id="cb1-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 11 07:26]  ./tests</span>
<span id="cb1-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 681 Mar 11 07:26]  ./tests/conftest.py</span>
<span id="cb1-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  26 Jan  2 12:11]  ./tests/conftest.py~</span>
<span id="cb1-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Jan  5 11:26]  ./tests/__pycache__</span>
<span id="cb1-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.7K Mar 11 07:26]  ./tests/test_divide.py</span>
<span id="cb1-65"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.6K Mar 11 07:26]  ./tests/test_shapes.py</span>
<span id="cb1-66"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [   0 Jan  2 13:36]  ./tests/test_shapes.py~</span>
<span id="cb1-67"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [ 460 Jan  2 16:09]  ./_version.py</span>
<span id="cb1-68"></span>
<span id="cb1-69"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21</span> directories, 43 files</span></code></pre></div>
<p>Lets create the <code>contributing</code> branch</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> contributing</span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# Contributing\n\nContributions to this repository are welcome via Pull Requests."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> CONTRIBUTING.md</span></code></pre></div>
<p>If we want to switch branches without making a commit but save our work in progress as we want to add more to the <code>CONTRIBUTING.md</code> file later we can stash the changes with a message. We then switch to <code>main</code> and create a new branch (<code>citation</code>) for and add a <code>CITATION.cff</code> file.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> stash <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"An example stash"</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch main</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> citation</span>
<span id="cb3-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cff-version: 1.2.0\ntitle: Pytest Examples\ntype: software"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> CITATION.cff</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add CITATION.cff</span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adding CITATION.cff"</span></span></code></pre></div>
<p>When we are ready to return to our <code>contributing</code> branch we can switch and <code>git pop</code> the work we stashed. By default the last stash is popped, but its possible to view all the stashes and select which you wish to pop and restore to the current branch.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch contributing</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> pop</span></code></pre></div>
<section id="worktrees-rather-than-branches" class="level2">
<h2 class="anchored" data-anchor-id="worktrees-rather-than-branches">Worktrees rather than branches</h2>
<p>Worktrees take a different approach to organising branches. They start with a <code>--bare</code> clone of the repository which implies the <code>--no-checkout</code> flag and means that the files that would normally be found under the <code>&lt;repository&gt;/.git</code> directory are copied but are instead placed in the top level of the directory rather than under <code>.git/</code>. No tracked files are copied as they may conflict with these files. You have all the information Git has about the history of the repository and the different commits and branches but none of the <em>actual</em> files.</p>
<p><strong>NB</strong> If you don’t explicitly state a target directory to clone to it will be the repository name suffixed with <code>.git</code>, i.e.&nbsp;in this example <code>pytest-examples.git</code>. I recommend sticking with the convention of using the same repository name so will explicitly state it.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ..</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mv</span> pytest-examples pytest-examples-orig-clone</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--bare</span> git@github.com:ns-rse/pytest-examples.git pytest-examples</span>
<span id="cb5-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> pytest-examples</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tree</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-afhD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 2</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[4.0K</span> Mar 13 07:45]  .</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 129 Mar 13 07:45]  ./config</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  73 Mar 13 07:45]  ./description</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  21 Mar 13 07:45]  ./HEAD</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 07:45]  ./hooks</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 478 Mar 13 07:45]  ./hooks/applypatch-msg.sample</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 896 Mar 13 07:45]  ./hooks/commit-msg.sample</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.6K Mar 13 07:45]  ./hooks/fsmonitor-watchman.sample</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 189 Mar 13 07:45]  ./hooks/post-update.sample</span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 424 Mar 13 07:45]  ./hooks/pre-applypatch.sample</span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.6K Mar 13 07:45]  ./hooks/pre-commit.sample</span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 416 Mar 13 07:45]  ./hooks/pre-merge-commit.sample</span>
<span id="cb5-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.5K Mar 13 07:45]  ./hooks/prepare-commit-msg.sample</span>
<span id="cb5-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.3K Mar 13 07:45]  ./hooks/pre-push.sample</span>
<span id="cb5-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.8K Mar 13 07:45]  ./hooks/pre-rebase.sample</span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 544 Mar 13 07:45]  ./hooks/pre-receive.sample</span>
<span id="cb5-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [2.7K Mar 13 07:45]  ./hooks/push-to-checkout.sample</span>
<span id="cb5-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [2.3K Mar 13 07:45]  ./hooks/sendemail-validate.sample</span>
<span id="cb5-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [3.6K Mar 13 07:45]  ./hooks/update.sample</span>
<span id="cb5-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 07:45]  ./info</span>
<span id="cb5-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [ 240 Mar 13 07:45]  ./info/exclude</span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 07:45]  ./objects</span>
<span id="cb5-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Mar 13 07:45]  ./objects/info</span>
<span id="cb5-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Mar 13 07:45]  ./objects/pack</span>
<span id="cb5-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 249 Mar 13 07:45]  ./packed-refs</span>
<span id="cb5-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [4.0K Mar 13 07:45]  ./refs</span>
<span id="cb5-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 07:45]  ./refs/heads</span>
<span id="cb5-33">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [4.0K Mar 13 07:45]  ./refs/tags</span>
<span id="cb5-34"></span>
<span id="cb5-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9</span> directories, 19 files</span></code></pre></div>
<p>What use is that? Well from this point you can instead of using <code>git branch</code> use <code>git worktree add &lt;branch_name&gt;</code> and it will create a <em>directory</em> with the name of the branch which holds all the files in their current state on that branch.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree add main</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Preparing</span> worktree <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">checking</span> out <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'main'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> is now at 2f7c382 Merge pull request <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#6 from ns-rse/ns-rse/tidy-print</span></span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tree</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-afhD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 2 main/</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[4.0K</span> Mar 13 08:13]  main</span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  64 Mar 13 08:13]  main/.git</span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 08:13]  main/.github</span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Mar 13 08:13]  main/.github/workflows</span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [3.0K Mar 13 08:13]  main/.gitignore</span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.0K Mar 13 08:13]  main/LICENSE</span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 293 Mar 13 08:13]  main/.markdownlint-cli2.yaml</span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.7K Mar 13 08:13]  main/.pre-commit-config.yaml</span>
<span id="cb6-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 18K Mar 13 08:13]  main/.pylintrc</span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.8K Mar 13 08:13]  main/pyproject.toml</span>
<span id="cb6-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 08:13]  main/pytest_examples</span>
<span id="cb6-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.3K Mar 13 08:13]  main/pytest_examples/divide.py</span>
<span id="cb6-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [ 179 Mar 13 08:13]  main/pytest_examples/__init__.py</span>
<span id="cb6-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [ 491 Mar 13 08:13]  main/pytest_examples/shapes.py</span>
<span id="cb6-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 602 Mar 13 08:13]  main/README.md</span>
<span id="cb6-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [4.0K Mar 13 08:13]  main/tests</span>
<span id="cb6-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [ 681 Mar 13 08:13]  main/tests/conftest.py</span>
<span id="cb6-22">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.7K Mar 13 08:13]  main/tests/test_divide.py</span>
<span id="cb6-23">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [1.6K Mar 13 08:13]  main/tests/test_shapes.py</span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5</span> directories, 14 files</span></code></pre></div>
<p>Each branch can have a worktree added for it and then when you want to switch between them its is simply a case of <code>cd</code>ing into the worktree (/branch) you wish to work on. You use Git commands within the directory to apply them to that branch and Git keeps track of everything in the usual manner.</p>
<p>Lets create two worktree’s, the <code>contributing</code> and <code>citation</code> we created above when working with branches.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree add contributing</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree add citation</span></code></pre></div>
<p>You are now free to move between worktrees (/branches) and undertake work on each without having to <code>git stash</code> or <code>git commit</code> work in progress. We can add the <code>CONTRIBUTING.md</code> to the <code>contributing</code> worktree then jump to the <code>citation</code> worktree and add the <code>CITATION.cff</code></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> contributing</span>
<span id="cb8-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# Contributing\n\nContributions to this repository are welcome via Pull Requests."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> CONTRIBUTING.md</span>
<span id="cb8-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ../citation</span>
<span id="cb8-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cff-version: 1.2.0\ntitle: Pytest Examples\ntype: software"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> CITATION.cff</span></code></pre></div>
<p>Neither branches have had the changes committed so Git will not show any differences between them, but we can use <code>diff -qr</code> to compare the directories.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-qr</span> contributing citation</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Only</span> in citation: CITATION.cff</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Only</span> in contributing: CONTRIBUTING.md</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Files</span> contributing/.git and citation/.git differ</span></code></pre></div>
<p>If we commit the changes to each we can <code>git diff</code> them.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> contributing</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add CONTRIBUTING.md</span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adding basic CONTRIBUTING.md"</span></span>
<span id="cb10-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ../citation</span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add CITATION.cff</span>
<span id="cb10-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adding basic CITATION.cff"</span></span>
<span id="cb10-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> diff citation contributing</span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CITATION.cff</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">---</span> Text</span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> cff-version: 1.2.0</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> title: Pytest Examples</span>
<span id="cb10-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span> type: software</span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CONTRIBUTING.md</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">---</span> Text</span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributing</span></span>
<span id="cb10-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb10-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span> Contributions to this repository are welcome via Pull Requests</span></code></pre></div>
<p><strong>NB</strong> The output of <code>git diff</code> may depend on the difftool that you have configured, I use and recommend the brilliant <a href="https://difftastic.wilfred.me.uk/" target="_blank"><code>difftastic</code></a> which has easy <a href="https://difftastic.wilfred.me.uk/git.html" target="_blank">integration with Git</a>.</p>
<section id="listing-worktrees" class="level3">
<h3 class="anchored" data-anchor-id="listing-worktrees">Listing Worktrees</h3>
<p>Just as you can <code>git branch --list</code> you can <code>git worktree list</code></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree list</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples</span>               <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bare</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/citation</span>      19ff076 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">citation</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/contributing</span>  ad56b91 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">contributing</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/main</span>          2f7c382 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">main</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
<section id="moving-worktrees" class="level3">
<h3 class="anchored" data-anchor-id="moving-worktrees">Moving Worktrees</h3>
<p>You can move worktrees to different directories, these do <em>not</em> even have to be within the bare repository that you cloned as Git keeps track of these in the <code>worktrees/</code> directory which has a folder for each of the worktrees you create and the file <code>gitdir</code> points to the location of that particular worktree.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> pytest-examples   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Move to the bare repository</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tree</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-afhD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 2 worktrees</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[4.0K</span> Mar 13 09:27]  worktrees</span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 09:31]  worktrees/citation</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  26 Mar 13 09:31]  worktrees/citation/COMMIT_EDITMSG</span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [   6 Mar 13 09:27]  worktrees/citation/commondir</span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  55 Mar 13 09:27]  worktrees/citation/gitdir</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  25 Mar 13 09:27]  worktrees/citation/HEAD</span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.4K Mar 13 09:31]  worktrees/citation/index</span>
<span id="cb12-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Mar 13 09:27]  worktrees/citation/logs</span>
<span id="cb12-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [   0 Mar 13 09:31]  worktrees/citation/MERGE_RR</span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  41 Mar 13 09:27]  worktrees/citation/ORIG_HEAD</span>
<span id="cb12-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Mar 13 09:27]  worktrees/citation/refs</span>
<span id="cb12-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 09:30]  worktrees/contributing</span>
<span id="cb12-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  29 Mar 13 09:30]  worktrees/contributing/COMMIT_EDITMSG</span>
<span id="cb12-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [   6 Mar 13 09:27]  worktrees/contributing/commondir</span>
<span id="cb12-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  59 Mar 13 09:27]  worktrees/contributing/gitdir</span>
<span id="cb12-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  29 Mar 13 09:27]  worktrees/contributing/HEAD</span>
<span id="cb12-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [1.4K Mar 13 09:30]  worktrees/contributing/index</span>
<span id="cb12-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [4.0K Mar 13 09:27]  worktrees/contributing/logs</span>
<span id="cb12-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [   0 Mar 13 09:30]  worktrees/contributing/MERGE_RR</span>
<span id="cb12-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> ├── [  41 Mar 13 09:27]  worktrees/contributing/ORIG_HEAD</span>
<span id="cb12-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── [4.0K Mar 13 09:27]  worktrees/contributing/refs</span>
<span id="cb12-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [4.0K Mar 13 08:13]  worktrees/main</span>
<span id="cb12-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [   6 Mar 13 08:13]  worktrees/main/commondir</span>
<span id="cb12-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  51 Mar 13 08:13]  worktrees/main/gitdir</span>
<span id="cb12-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  21 Mar 13 08:13]  worktrees/main/HEAD</span>
<span id="cb12-28">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [1.3K Mar 13 08:13]  worktrees/main/index</span>
<span id="cb12-29">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [4.0K Mar 13 08:13]  worktrees/main/logs</span>
<span id="cb12-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> [  41 Mar 13 08:13]  worktrees/main/ORIG_HEAD</span>
<span id="cb12-31">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> [4.0K Mar 13 08:13]  worktrees/main/refs</span>
<span id="cb12-32"></span>
<span id="cb12-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10</span> directories, 19 files</span></code></pre></div>
<p>If we look at the <code>gitdir</code> file in each <code>worktree</code> sub-directory we see where they point to.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> worktrees/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/gitdir</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/citation/.git</span></span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/contributing/.git</span></span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/main/.git</span></span></code></pre></div>
<p>These mirror the locations reported by <code>git worktree list</code>, albeit with <code>.git</code> appended.</p>
<p>If you want to move a worktree you can do so, here we move <code>citation</code> to <code>~/tmp</code>.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree move citation ~/tmp</span></code></pre></div>
</section>
<section id="removing-worktrees" class="level3">
<h3 class="anchored" data-anchor-id="removing-worktrees">Removing worktrees</h3>
<p>It’s simple to remove a worktree after the changes have been merged or it is no longer needed, make sure to “prune” the tree after having done so.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree remove citation</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree prune</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> worktree list</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples</span>               <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bare</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/contributing</span>  ad56b91 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">contributing</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/mnt/work/git/hub/ns-rse/pytest-examples/main</span>          2f7c382 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">main</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Git Worktrees are a useful way of structuring your Git workflows if you have to switch branches regularly. They avoid the need to stash work in progress or make commits. If you do choose to use worktrees as an alternative to branches be mindful that you should remove and prune them after you have finished with them, particularly if you have a large codebase.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://git-scm.com/docs/git-worktree" target="_blank">Git - git-worktree Documentation</a></li>
<li><a href="https://opensource.com/article/21/4/git-worktree" target="_blank">Experiment on your code freely with Git worktree | Opensource.com</a></li>
</ul>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2024,
  author = {Shephard, Neil},
  title = {Git - {Worktrees}},
  date = {2024-03-13},
  url = {https://blog.nshephard.dev/posts/git-worktrees/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2024" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2024. <span>“Git - Worktrees.”</span> March 13, 2024. <a href="https://blog.nshephard.dev/posts/git-worktrees/">https://blog.nshephard.dev/posts/git-worktrees/</a>.
</div></div></section></div> ]]></description>
  <category>git</category>
  <category>worktrees</category>
  <guid>https://blog.nshephard.dev/posts/git-worktrees/</guid>
  <pubDate>Wed, 13 Mar 2024 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/3027/3018839068_ff71bcb5f5_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Git - Making Amends and Fixing things up</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/git-amend-fixup/</link>
  <description><![CDATA[ 





<p><a href="https://git-scm.com" target="_blank">Git</a> is the world’s most popular version control software out there at the moment and if you write code and version control it the chances are you are using it. It’s a complex tool though and there are a bewildering array of options. In this short post we will look at some options for changing commits that have been made.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/53448512934_c045c232c9_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.flickr.com/photos/slackline/53448512934/in/datetaken/" target="_blank">Crown Shy Trees by Me</a></figcaption>
</figure>
</div>
<section id="python-examples" class="level2">
<h2 class="anchored" data-anchor-id="python-examples">Python Examples</h2>
<p>We’ll use my <a href="https://github.com/ns-rse/pytest-examples" target="_blank">pytest-examples</a> as an example for this work but you can do this in any repository you have going. We’ll clone the repository and make a new branch called <code>amend-fixup-tutorial</code>.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone git@github.com:ns-rse/pytest-examples.git</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> pytest-examples</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> amend-fixup-tutorial</span>
<span id="cb1-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Switched</span> to a new branch <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'amend-fixup-tutorial'</span></span></code></pre></div>
</section>
<section id="the-git-dance" class="level2">
<h2 class="anchored" data-anchor-id="the-git-dance">The Git Dance</h2>
<p>A typical Git work flow involves making some changes to one or more files (or adding a new one into the repository). These are staged with <code>git add &lt;files&gt;</code>, or you can use a shortcut <code>git add -u/--update</code> to add all currently tracked files that have been modified if you are not adding anything new, before committing them with a message using <code>git commit -m "&lt;meaningful message about content being added&gt;"</code>.</p>
<p>Lets add a simple <code>CONTRIBUTING.md</code> file to the repository.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"# Contributing\n\nContributions via pull requests are welcome."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> CONTRIBUTING.md</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add CONTRIBUTING.md</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adding CONTRIBUTING.md"</span></span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb3-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">01191a2</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Adding</span> CONTRIBUTING.md</span></code></pre></div>
<p>This should be familiar to users of <a href="https://git-scm.com" target="_blank">Git</a> whether you use the command line interface (CLI), <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs’</a> amazing Git porcelain <a href="https://magit.vc/" target="_blank">magit</a> or any other tool such as <a href="https://www.gitkraken.com/" target="_blank">GitKraken</a> or the support in you IDE such as <a href="https://posit.co/products/open-source/rstudio/" target="_blank">RStudio</a> or VSCode.</p>
</section>
<section id="making-amends" class="level2">
<h2 class="anchored" data-anchor-id="making-amends">Making Amends</h2>
<p>Sometimes you will have made a commit and you realise that you want to add more to it or perhaps you forgot to run your test suite and find that on running it your tests fail so you need to make a correction. In this example we want to be more explicit about how to make contributions and let people know they should fork the branch.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"\n Please make a fork of this repository, make your changes and open a Pull Request."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> CONTRIBUTING.md</span></code></pre></div>
<p>Now you could make a second commit…</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ask for PRs via fork in CONTRIBUTING.md"</span></span></code></pre></div>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9f0655b</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ask</span> for PRs via fork in CONTRIBUTING.md</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">01191a2</span> Adding CONTRIBUTING.md</span></code></pre></div>
<p>…and there is nothing wrong with that. However, Git history can get long and complicated when there are lots of small commits, because these two changes to <code>CONTRIBUTING.md</code> are essentially the same piece of work and if we’d been thinking clearly we would have written about making forks in the first place and made a single commit.</p>
<p>Fortunately Git can help here as there is the <code>git commit --amend</code> option which adds the staged changes to the last commit and allows you to edit the last commit message (if nothing is currently staged then you will be prompted to edit the last commit message). We can undo the last commit using <code>git reset HEAD~1</code> and instead amend the first commit that added the <code>CONTRIBUTING.md</code></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--amend</span></span></code></pre></div>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb8-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4fda15f</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Adding</span> CONTRIBUTING.md</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> CONTRIBUTING.md</span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributing</span></span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Contributions</span> via pull requests are welcome.</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Please</span> make a fork of this repository, make your changes and open a Pull Request.</span></code></pre></div>
<p>We now have one commit which contains the new <code>CONTRIBUTING.md</code> file that contains all the changes we wished to have in the file in the first place and our Git history is slightly more compact.</p>
</section>
<section id="fixing-things-up" class="level2">
<h2 class="anchored" data-anchor-id="fixing-things-up">Fixing things up</h2>
<p>Amending commits is great providing the commit you want to change is the last commit you made (i.e.&nbsp;<code>HEAD</code>). But sometimes you might wish to correct a commit further back in your history and <code>git commit --amend</code> is of no use here. Git can however help here with the <code>git commit --fixup</code> command which allows you to mark a commit as being a “fix up” of an older commit. These can then be autosquashed via an interactive Git rebase.</p>
<p>Let’s add a few empty commits to our <code>amend-fixup-tutorial</code> branch to so we can do this.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-empty</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empty commit for demonstration purposes"</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-empty</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Another empty commit for demonstration purposes"</span></span></code></pre></div>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb10-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8061221</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Another</span> empty commit for demonstration purposes</span>
<span id="cb10-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">65587ce</span> Empty commit for demonstration purposes</span>
<span id="cb10-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4fda15f</span> Adding CONTRIBUTING.md</span></code></pre></div>
<p>And let’s expand our <code>CONTRIBUTING.md</code> file further.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"\nPlease note this repository uses [pre-commit](https://pre-commit.com) to lint the Python code and Markdown files."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> CONTRIBUTING.md</span></code></pre></div>
<p>We want to merge this commit with the first one we made in this tutorial using <code>git commit --fixup</code>. To do this we need to know the hash (<code>4fda15f</code> see output from above <code>git log</code>) or the relative reference of the commit we want which in this case is <code>HEAD~2</code> as it is three commits back from the current <code>HEAD</code> (which is commit <code>0</code>, most indexing in computing starts at <code>0</code> rather than <code>1</code>). Use <em>one</em> for the following <code>git commit --fixup</code> commands (adjusting the hash to yours if you are using that option, you can find this using <code>git log --oneline</code>).</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--fixup</span> 4fda15f</span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--fixup</span> HEAD~2</span></code></pre></div>
<p>We see the commit we have just made starts with <code>fixup!</code> and is then followed by the commit message that it is fixing.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb13-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">97711a4</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fixup!</span> Adding CONTRIBUTING.md</span>
<span id="cb13-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8061221</span> Another empty commit for demonstration purposes</span>
<span id="cb13-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">65587ce</span> Empty commit for demonstration purposes</span>
<span id="cb13-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4fda15f</span> Adding CONTRIBUTING.md</span></code></pre></div>
<p>The final step is to perform the automatic squashing via an interactive rebase, again you can either use the hash or the relative reference.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> rebase <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--autosquash</span> 4fda15f</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> rebase <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--autosquash</span> HEAD~2</span></code></pre></div>
<p>This will open the default editor and because the <code>--autosquash</code> option has been used it will already have marked the commits that need combining with <code>fixup</code>. All you have to do is save the file and exit and we can check the history and look at the contents of the file.</p>
<p><strong>NB</strong> If you find that the necessary commit <em>isn’t</em> already marked navigate to that line and delete <code>pick</code>. The lines below the file you have open give instructions on how you can mark commits for different actions, in this case you can replace <code>pick</code> with either <code>f</code> or <code>fixup</code>. Save and exit and the commits are squashed.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span></span>
<span id="cb15-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0fda21e</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> amend-fixup-tutorial<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Another</span> empty commit for demonstration purposes</span>
<span id="cb15-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">65587ce</span> Empty commit for demonstration purposes</span>
<span id="cb15-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4fda15f</span> Adding CONTRIBUTING.md</span>
<span id="cb15-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> CONTRIBUTING.md</span>
<span id="cb15-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributing</span></span>
<span id="cb15-7"></span>
<span id="cb15-8">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Contributions</span> via pull requests are welcome.</span>
<span id="cb15-9"></span>
<span id="cb15-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Please</span> make a fork of this repository, make your changes and open a Pull Request.</span>
<span id="cb15-11"></span>
<span id="cb15-12">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Please</span> note this repository uses <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">pre</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">commit</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://pre-commit.com</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">to</span> lint the Python code and Markdown files.</span></code></pre></div>
<p>And you’re all done! If you were doing this for real on a repository you could now <code>git push</code> or continue your work. As this was just an example we can switch branches back to <code>main</code> and force deletion of the branch we created.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> switch main</span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> amend-fixup-tutorial</span></code></pre></div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Git has lots of commands to help you maintain a clean history by using <code>--amend</code> and <code>--fixup</code> flags to <code>git commit</code> and in the later case then performing an interactive <code>git rebase -i</code>. This takes a little discipline to get into the practice of but once in the habit of doing so it greatly improves the readability of the Git history and avoids including commit messages such as <code>Fixing typo</code> / <code>Linting code</code> / <code>Fixing tests</code> / <code>I've gone mad!</code>.</p>
<p>If all of this sounds completely unfamiliar to you but you would like to learn more about Git I can highly recommend the introductory course developed by <a href="https://www.r-rse.eu/" target="_blank">Dr Anna Krystalli</a> <a href="https://srse-git-github-zero2hero.netlify.app/" target="_blank">Git and GitHub through GitKraken : From Zero to Hero</a>. This course is run regularly by myself and colleagues in <a href="https://rse.shef.ac.uk" target="_blank">Research Software Engineering</a> for post-graduate researchers and staff at the University of Sheffield.</p>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2024,
  author = {Shephard, Neil},
  title = {Git - {Making} {Amends} and {Fixing} Things Up},
  date = {2024-03-08},
  url = {https://blog.nshephard.dev/posts/git-amend-fixup/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2024" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2024. <span>“Git - Making Amends and Fixing Things
Up.”</span> March 8, 2024. <a href="https://blog.nshephard.dev/posts/git-amend-fixup/">https://blog.nshephard.dev/posts/git-amend-fixup/</a>.
</div></div></section></div> ]]></description>
  <category>git</category>
  <category>amend</category>
  <category>fixup</category>
  <guid>https://blog.nshephard.dev/posts/git-amend-fixup/</guid>
  <pubDate>Fri, 08 Mar 2024 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/53448512934_c045c232c9_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Git Remotes Revisited</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/git-remotes-revisited/</link>
  <description><![CDATA[ 





<p>I’ve written before about <a href="https://ns-rse.github.io/posts/git-remotes/" target="_blank">Git Remotes</a> but in my on-going effort to improve my understanding of the tools I use daily I’ve discovered that it is possible to have a single <code>remote</code> push to two different URLs so am revisiting the topic and perhaps writing a little more clearly on it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/53494024371_1eecc0b722_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.flickr.com/photos/slackline/53494024371/in/datetaken/" target="_blank">Microcosmos by Me</a></figcaption>
</figure>
</div>
<p><a href="https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes" target="_blank">Remotes</a> are where other copies of your repository exist and typically where collaboration occurs (i.e.&nbsp;issue tracking, merge requests, bug reports etc.).</p>
<p>The main remote that a repository is configured to use by default is called <code>origin</code> but it is possible to have multiple remotes tracked by your local copy.</p>
<section id="listing-remotes" class="level2">
<h2 class="anchored" data-anchor-id="listing-remotes">Listing Remotes</h2>
<p>List remotes with <code>git remote [-v]</code> the <code>-v</code> flag will show the URLs that are stored for the short-cut.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> forgejo@forgejo.hopto.org:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> forgejo@forgejo.hopto.org:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span> git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span> git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>You can get more information about a remote using <code>git remote show origin</code></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote show origin</span>
<span id="cb2-2"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> remote origin</span>
<span id="cb2-3">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fetch</span> URL: git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb2-4">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Push</span>  URL: git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb2-5">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD</span> branch: main</span>
<span id="cb2-6">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Remote</span> branches:</span>
<span id="cb2-7">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span>                                                tracked</span>
<span id="cb2-8">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">refs/merge-requests/18/head</span>                         new <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">next</span> fetch will store in remotes/origin</span>
<span id="cb2-9">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">refs/pullreqs/15</span>                                    stale <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git remote prune'</span> to remove<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-10">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">refs/remotes/origin/nshephard/update-pre-commit</span>     stale <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git remote prune'</span> to remove<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-11">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">refs/remotes/origin/nshephard/update-readme</span>         stale <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git remote prune'</span> to remove<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-12">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Local</span> branches configured for <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git pull'</span>:</span>
<span id="cb2-13">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span>                            merges with remote main</span>
<span id="cb2-14">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nshephard/fix-mtime</span>             merges with remote nshephard/fix-mtime</span>
<span id="cb2-15">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nshephard/update-pre-commit</span>     merges with remote nshephard/update-pre-commit</span>
<span id="cb2-16">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Local</span> ref configured for <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git push'</span>:</span>
<span id="cb2-17">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span> pushes to main <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">out</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">of</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>This can be useful to show you what you need to tidy up if there are lots of stale branches around. In this example I can run <code>git remote prune origin</code> as advised to remove these.</p>
<section id="default-remote" class="level3">
<h3 class="anchored" data-anchor-id="default-remote">Default Remote</h3>
<p>The default remote to push to can be set with the following command, it will likely already be set to <code>origin</code> so this would not change anything.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--local</span> remote.pushDefault origin</span></code></pre></div>
<p>This adds the following to your <code>.git/config</code> if it wasn’t already there.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote]</span></span>
<span id="cb4-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushDefault</span> = origin</span></code></pre></div>
</section>
</section>
<section id="adding-remotes" class="level2">
<h2 class="anchored" data-anchor-id="adding-remotes">Adding Remotes</h2>
<p>It is straight forward to add a remote with <code>git remote add &lt;shortcut&gt; &lt;URL&gt;</code> where the URL is either the <code>https</code> or the <code>git</code> URL.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote add forgejo forgejo@forgejo.hopto.org:nshephard/mvdate.git</span></code></pre></div>
<p>This adds details to your <code>.git/config</code> so that it has the following</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>]</span>
<span id="cb6-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb6-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/heads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>:refs/remotes/origin/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/merge-requests/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/head:refs/pullreqs/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forgejo"</span>]</span>
<span id="cb6-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb6-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/heads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>:refs/remotes/forgejo/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote]</span></span>
<span id="cb6-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushDefault</span> = origin</span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>]</span>
<span id="cb6-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> = origin</span>
<span id="cb6-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/main</span></code></pre></div>
<p>Two remotes are defined, <code>origin</code> and <code>forgejo</code>, the default to push to is set to <code>origin</code> and the <code>main</code> branch is setup to track the remote <code>origin</code>.</p>
<section id="pushing-to-specific-remote" class="level3">
<h3 class="anchored" data-anchor-id="pushing-to-specific-remote">Pushing to specific remote</h3>
<p>With two remotes setup you can choose, at the branch level, where to push your changes by specifying the remote you wish to use. If you wanted to push a newly created branch, <code>change-just-for-forgejo</code>, to the newly added <code>forgejo</code> remote you would configure it with.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git switch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> change-just-for-forgejo</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-empty</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test push just to forgejo"</span></span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git push <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set-upstream</span> forgejo change-just-for-forgejo</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enumerating</span> objects: 2, done.</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Counting</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2/2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> done.</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Writing</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2/2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> 376 bytes <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">376.00</span> KiB/s, done.</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Total</span> 2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> reused 0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> pack-reused 0</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> Create a new pull request for <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'change-just-for-forgejo'</span>:</span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span>   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>https://forgejo.hopto.org/nshephard/mvdate/compare/main...change-just-for-forgejo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> . Processing 1 references</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> Processed 1 references in total</span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">To</span> ssh://forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span>   [new branch]      change-just-for-forgejo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> change-just-for-forgejo</span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'change-just-for-forgejo'</span> set up to track <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'forgejo/change-just-for-forgejo'</span>.</span></code></pre></div>
<p>Git reports that the local <code>change-just-for-forgejo</code> has been setup to track <code>forgejo/change-just-for-forgejo</code> and the following entry has been added to <code>.git/config</code></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"change-just-for-forgejo"</span>]</span>
<span id="cb8-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forgejo"</span></span>
<span id="cb8-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/change-just-for-forgejo</span></code></pre></div>
</section>
<section id="a-note-on-ssh-ports" class="level3">
<h3 class="anchored" data-anchor-id="a-note-on-ssh-ports">A Note on SSH Ports</h3>
<p>If a remote is using a non-standard port for SSH connections (i.e.&nbsp;anything other than <code>22</code>) then you have to use a different format for specifying the remote URL. Instead of <code>forgejo@forgejo.hopto.org:nshephard/mvdate.git</code> you must explicitly state the protocol (<code>ssh://</code>) and include the port so that it reads <code>ssh://forgejo@forgejo.hopto.org:1234</code> and so to add it you would be added with the following</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote add forgejo ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>I use a non-standard port and so use that convention for the remainder of this article. If you do not use a non-standard port you can either change the port (<code>1234</code>) to the default (<code>22</code>) or use the conventional syntax for referring to the remote.</p>
</section>
</section>
<section id="mirroring-remotes" class="level2">
<h2 class="anchored" data-anchor-id="mirroring-remotes">Mirroring Remotes</h2>
<p>The really neat thing is that it is possible to have a local repository track multiple remotes, which means when you push your changes it will go to both. You could configure an alias to push to both of the remotes we currently have defined, but there is an excellent post on <a href="https://stackoverflow.com/a/14290145/1444043" target="_blank">StackOverflow</a> that shows how to do this with Git itself because each remote can have multiple <code>pushurls</code>.</p>
<p>As we have added a second remote to our configuration our <code>.git/config</code> for <a href="https://gitlab.com/nsshephard/mvdate" target="_blank">mvdate</a> our configuration currently looks like this.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>]</span>
<span id="cb10-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb10-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/heads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>:refs/remotes/origin/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb10-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/merge-requests/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/head:refs/pullreqs/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forgejo"</span>]</span>
<span id="cb10-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb10-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/heads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>:refs/remotes/forgejo/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote]</span></span>
<span id="cb10-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushDefault</span> = origin</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>]</span>
<span id="cb10-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> = origin</span>
<span id="cb10-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/main</span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"change-just-for-forgejo"</span>]</span>
<span id="cb10-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> = forgejo</span>
<span id="cb10-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/change-just-for-forgejo</span></code></pre></div>
<p>As above, there are two remotes are defined, <code>origin</code> and <code>forgejo</code>, the default to push to is set to <code>origin</code> and the <code>main</code> branch is setup to track <code>origin</code> whilst the <code>change-just-for-forgejo</code> branch is setup to track <code>forgejo</code>.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>How do we get the <code>origin</code> remote setup and configured to push to both gitlab and forgejo? This can be done using the <code>set-url --add --push</code> options to <code>git remote</code>, below we add <code>forgejo</code> as a push target to <code>origin</code>.</p>
<p><strong>NB</strong> Note I use a non-standard SSH port in the following, see above note.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote set-url <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--add</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--push</span> origin ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>But this has removed the original <code>push</code> target under <code>origin</code> which pointed to <code>gitlab</code> so we need to add that back in.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote set-url <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--add</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--push</span> origin git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgejo</span> ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb13-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>We now have two <code>push</code> targets on <code>origin</code>, one pointing to <code>gitlab.com</code> (using the default port <code>22</code>) and one pointing to <code>forgejo.hopto.org</code> (on port <code>1234</code>) and as the default target is <code>origin</code> when we <code>git push</code> it will send the changes to both. We still have the <code>forgejo</code> remote defined and it only tracks the <code>forgejo</code> URL.</p>
<p>We can test this with an empty commit on a new branch, <code>test-both</code>, which we first create.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git switch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> test-both</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-empty</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Testing pushing to GitLab and Forgejo"</span></span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[test-both</span> c07caf6] Testing pushing to GitLab and Forgejo</span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git push</span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enumerating</span> objects: 1, done.</span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Counting</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1/1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> done.</span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Writing</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1/1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> 210 bytes <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">210.00</span> KiB/s, done.</span>
<span id="cb14-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Total</span> 1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> reused 0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> pack-reused 0</span>
<span id="cb14-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb14-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> Create a new pull request for <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test-both'</span>:</span>
<span id="cb14-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span>   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>https://forgejo.hopto.org/nshephard/mvdate/compare/main...test-both<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> . Processing 1 references</span>
<span id="cb14-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> Processed 1 references in total</span>
<span id="cb14-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">To</span> ssh://forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb14-16"></span>
<span id="cb14-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span>   [new branch]      test-both <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> test-both</span>
<span id="cb14-18"></span>
<span id="cb14-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test-both'</span> set up to track <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'origin/test-both'</span>.</span>
<span id="cb14-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enumerating</span> objects: 26, done.</span>
<span id="cb14-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Counting</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">26/26</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> done.</span>
<span id="cb14-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Writing</span> objects: 100% <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">26/26</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> 16.75 KiB <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8.37</span> MiB/s, done.</span>
<span id="cb14-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Total</span> 26 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> reused 0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">delta</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> pack-reused 0</span>
<span id="cb14-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb14-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span> To create a merge request for test-both, visit:</span>
<span id="cb14-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span>   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>https://gitlab.com/nshephard/mvdate/-/merge_requests/new<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>merge_request%5Bsource_branch%5D=test-both<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote:</span></span>
<span id="cb14-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">To</span> gitlab.com:nshephard/mvdate.git</span>
<span id="cb14-29"></span>
<span id="cb14-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span>   [new branch]      test-both <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> test-both</span>
<span id="cb14-31"></span>
<span id="cb14-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test-both'</span> set up to track <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'origin/test-both'</span>.</span></code></pre></div>
<p>The output above shows that the branch <code>test-both</code> was pushed to both the URLs we have configured as push targets to <code>origin</code> and if you visit the repositories you will find the branches now exist there.</p>
</section>
<section id="deleting-remotes" class="level2">
<h2 class="anchored" data-anchor-id="deleting-remotes">Deleting Remotes</h2>
<p>In my use case I simply want to push both remotes so that they mirror each other so I can delete the <code>forgejo</code> remote. This will leave the push URL for that remote under the configuration for <code>origin</code> and allows us to set any branch to use the <code>origin</code> as a the remote and any changes will be pushed to both.</p>
<p>There may be instances where you want to leave the additional remote in place if you wanted to push some changes just to that remote so its not essential that you remove it, but if you want to you can delete reference to a remote from your local configuration.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote remove forgejo</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">origin</span>  git@gitlab.com:nshephard/mvdate.git <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Because the <code>change-just-for-forgejo</code> was setup to track the <code>forejo</code> remote we would need to change that target, we can do so with the following</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git switch change-just-for-forgejo</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❱</span> git branch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set-upstream-to</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>origin/change-just-for-forgejo change-just-for-forgejo</span></code></pre></div>
<p>This changes the remote target for the branches definition and our configuration now looks like the following.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>]</span>
<span id="cb17-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb17-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/heads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>:refs/remotes/origin/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb17-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span> = +refs/merge-requests/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/head:refs/pullreqs/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb17-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushurl</span> = ssh://forgejo@forgejo.hopto.org:1234/nshephard/mvdate.git</span>
<span id="cb17-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushurl</span> = git@gitlab.com:nshephard/mvdate.git</span>
<span id="cb17-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[remote]</span></span>
<span id="cb17-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pushDefault</span> = origin</span>
<span id="cb17-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>]</span>
<span id="cb17-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> = origin</span>
<span id="cb17-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/main</span>
<span id="cb17-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[branch</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"change-just-for-forgejo"</span>]</span>
<span id="cb17-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remote</span> = origin</span>
<span id="cb17-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">merge</span> = refs/heads/change-just-for-forgejo</span></code></pre></div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Having a local repository push to two remotes is a simple way of a mirroring. Whether you have a use case for it depends on what you are doing. I could easily imagine this could get very complicated if changes were pushed by others to each remote, but I wouldn’t be surprised if Git is regularly used in this way by others.</p>
<p>Of course if you want to push a branch that you wish to keep private to one remote only then you would have to be very careful in how you use this setup. The original StackOverflow solution inspired that this post suggests creating an independent remote (e.g.&nbsp;<code>all</code>) so that you can push changes to <code>origin</code> or the second remote (in this example <code>forgejo</code>) and use <code>all</code> only when you wish to push changes to both.</p>
<p>Its been good for me to return to a topic I’ve delved into in the past, this second time round I feel I’ve got a slightly better grasp of what I’m doing and have a neater solution to achieve what is required.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes" target="_blank">Git - Working with Remotes</a></li>
<li><a href="https://git-scm.com/docs/git-remote" target="_blank">Git - git-remote Documentation</a></li>
<li><a href="https://stackoverflow.com/questions/14290113/git-pushing-code-to-two-remotes" target="_blank">github - Git - Pushing code to two remotes - Stack Overflow</a></li>
</ul>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2024,
  author = {Shephard, Neil},
  title = {Git {Remotes} {Revisited}},
  date = {2024-02-17},
  url = {https://blog.nshephard.dev/posts/git-remotes-revisited/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2024" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2024. <span>“Git Remotes Revisited.”</span> February 17,
2024. <a href="https://blog.nshephard.dev/posts/git-remotes-revisited/">https://blog.nshephard.dev/posts/git-remotes-revisited/</a>.
</div></div></section></div> ]]></description>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <guid>https://blog.nshephard.dev/posts/git-remotes-revisited/</guid>
  <pubDate>Sat, 17 Feb 2024 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/53494024371_1eecc0b722_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Git Remotes</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/git-remotes/</link>
  <description><![CDATA[ 





<p><a href="https://git.scm" target="_blank">Git</a> and various forges such as <a href="https://github.com" target="_blank">GitHub</a> <a href="https://gitlab.com" target="_blank">GitLab</a> are useful collaborative tools for version controlling, sharing and working collaboratively. Normally a repository resides on your local computer and it tracks a remote (often referred to as <code>origin</code>)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/49833632231_bd701b7621_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://flickr.com/photos/slackline/49833632231/" target="_blank">Looking up by me</a></figcaption>
</figure>
</div>
<section id="gitconfig" class="level2">
<h2 class="anchored" data-anchor-id="gitconfig"><code>.git/config</code></h2>
<p>When you initialise or clone a repository a hidden directory <code>.git</code> is created. Within this resides the configuration file for the repository <code>.git/config</code> that defines how Git is to behave when performing actions on the repository.</p>
<section id="core" class="level3">
<h3 class="anchored" data-anchor-id="core"><code>core</code></h3>
</section>
<section id="remote" class="level3">
<h3 class="anchored" data-anchor-id="remote"><code>remote</code></h3>
<p>The <code>remote</code> field defines the location of the repository to which code is synced via pushing and pulling. Typically and by default this is called the <code>origin</code> and you have a section that defines the <code>url</code> and the <code>fetch</code> for this remote.</p>
<p>The <code>url</code> field can take two forms, either one based on <code>https</code> in which case the prefix of the value will be <code>https://github.com/</code> or one based on <code>ssh</code> in which case the prefix will be <code>git@github.com:</code>. What follows is then the user account or organisation (e.g.&nbsp;<code>ns-rse</code> for my personal repositories) followed by <code>/&lt;repo-name&gt;</code> (e.g.&nbsp;for this repository that is <code>ns-rse.github.io</code>).</p>
<p>The <code>fetch</code> field is what in Git parlance is called a <a href="https://git-scm.com/book/it/v2/Git-Internals-The-Refspec" target="_blank">Refspec</a> (Reference Specification). This takes the form <code>&lt;src&gt;:&lt;dst&gt;</code> and is a method of mapping references on the remote side (<code>&lt;src&gt;</code>) to those locally (<code>&lt;dst&gt;</code>) and it is this that maps the local branches (<code>refs/heads/*</code>) to their counterparts on the remote (<code>refs/remotes/origin/*</code>). If there is a <code>+</code> prefix it tells git to up-date the reference even if there is no <a href="https://www.git-basics.com/docs/git-merge/fast-forward" target="_blank">fast-forward</a>.</p>
<pre class="config"><code>[remote "origin"]
    url = git@github.com:ns-rse/ns-rse.github.io
    fetch = +refs/heads/*:refs/remotes/origin/*</code></pre>
</section>
<section id="branch" class="level3">
<h3 class="anchored" data-anchor-id="branch"><code>branch</code></h3>
<p>What follows is then a series of entries for <code>branch</code> which defines further how each local <code>branch</code> maps to a <code>remote</code> and where it should <code>merge</code> to. Each branch has a name define in the section header and within two parameters are set the <code>remote</code> which by default points to the <code>origin</code> (defined in the above <code>remote</code>) section and a <code>merge</code> field which defines the local reference to the branch under <code>refs/head/&lt;branch-name&gt;</code>.</p>
</section>
</section>
<section id="having-a-private-branch" class="level2">
<h2 class="anchored" data-anchor-id="having-a-private-branch">Having a Private branch</h2>
<p>Sometimes the need might arise to develop a feature in private. This is fine if you have no intention of sharing the work with others, you create a branch on your local computer and never push it to a forge. However, there will arise times where you do want to share you work with others whilst keeping things private. This too is possible and can be achieved by creating a private repository on your own account rather than using the original and configuring a branch to track that instead.</p>
<section id="creating-a-second-remote" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-second-remote">Creating a second <code>remote</code></h3>
<p>Start by creating a new repository on GitHub/GitLab and making it private from the outset. Do <em>not</em> include any additional information such as <code>.gitignore</code>, <code>README.md</code> or <code>LICENSE.md</code> it should be completely empty.</p>
<p>You can then add it as a new <code>remote</code> to your existing repository in one of two ways.</p>
<section id="git-at-the-command-line" class="level4">
<h4 class="anchored" data-anchor-id="git-at-the-command-line">Git at the Command Line</h4>
<p>You should have some instructions shown on GitHub one of which is <strong>…or push an existing repository from the command line</strong>. The first line of this is telling you how to add a new remote to the repository. called <code>origin</code> and to point towards the repository you have just created. You will likely already have an <code>origin</code> remote defined so you need to choose a different name and point it to the correct location.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> remote add private-work git@github.com:ns-rse/private-work</span></code></pre></div>
</section>
<section id="check-your-.gitconfig" class="level4">
<h4 class="anchored" data-anchor-id="check-your-.gitconfig">Check your <code>.git/config</code></h4>
<p>If you now look at your <code>.git/config</code> file there should be two entries for <code>[remote ""]</code> one for origin (i.e.&nbsp;<code>[remote "origin"]</code>) and one for the new remote that has just been added <code>[remote "private-work"]</code>. Of course, because <code>.git/config</code> is just a text configuration file you can edit it and enter these values manually yourself if you want to.</p>
<p><strong>NB</strong> Either of the above methods will append these options to the bottom of the file so if you can’t see it immediately scroll down.</p>
</section>
</section>
<section id="track-your-new-remote" class="level3">
<h3 class="anchored" data-anchor-id="track-your-new-remote">Track your new remote</h3>
<p>Now that you have a secondary <code>remote</code> defined you can create a branch and set it to track the private remote you have created and configured. Create a new branch by using <code>git checkout -b</code></p>
<section id="command-line" class="level4">
<h4 class="anchored" data-anchor-id="command-line">Command Line</h4>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> private-feature</span></code></pre></div>
<p>You then set the upstream using <code>--set-upstream-to</code> or its shorthand <code>-u</code>, at this stage you don’t have anything to include so make an empty commit</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set-upstream-to</span> private-work private-work</span></code></pre></div>
</section>
<section id="magit" class="level4">
<h4 class="anchored" data-anchor-id="magit">Magit</h4>
</section>
<section id="check-.gitconfig" class="level4">
<h4 class="anchored" data-anchor-id="check-.gitconfig">Check <code>.git/config</code></h4>
<p>Returning to your <code>.git/config</code> file you should now have an additional entry for a <code>branch</code> underneath the new entry for the <code>remote</code> and the value for <code>remote</code> under <code>branch</code> is the name of the <code>remote</code>.</p>
<pre class="config"><code>[remote "private-work"]
 url = git@github.com:ns-rse/private-work.git
 fetch = +refs/heads/*:refs/remotes/private-work/*
[branch "private-feature"]
 remote = private-work
 merge = refs/heads/private-feature</code></pre>
</section>
</section>
</section>
<section id="keeping-up-to-date" class="level2">
<h2 class="anchored" data-anchor-id="keeping-up-to-date">Keeping up to Date</h2>
<p>The private repository you setup on GitHub/GitLab should now have a copy of the <code>private-work</code> branch you created locally.</p>
<p>If you are collaborating with others the <code>main</code>/<code>master</code> branch may move ahead of yours as others work is merged in. You therefore need to regularly update your private branch by merging or rebasing from the <code>origin</code> rather than the <code>private-work</code> remote your branch is configured to track. The difference between merging and rebasing is beyond the scope of this article, there are pros and cons to each</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout main</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> pull</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout private-work</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> merge main</span></code></pre></div>
<p>Or you can merge directly from origin with</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout private-feature</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> merge origin/main</span></code></pre></div>
</section>
<section id="checkout-someone-elses-private-branch" class="level2">
<h2 class="anchored" data-anchor-id="checkout-someone-elses-private-branch">Checkout someone else’s private branch</h2>
<p>Inevitably the need might arise for a collaborator to test your private branch. In which case they need to be granted permission to the private repository by the developer who created it. This is done via <em>Settings &gt; Collaborators</em> and inviting them to work on your repository.</p>
<p>Once they have accepted the invitation they will also have to add a secondary <code>remote</code> and the <code>branch</code> they are working on. They can follow the instructions above to set up a remote, however they should <em>not</em> follow the instructions to <code>branch</code> because that branch already exists on your private repository.</p>
<p>but because <code>.git/config</code> is just a text file you can copy the lines from your configuration and share it with your collaborator and they can add them to their <code>.git/config</code> file. Once these options have been added they</p>
</section>
<section id="bonus---using-magit" class="level2">
<h2 class="anchored" data-anchor-id="bonus---using-magit">Bonus - Using Magit</h2>
<p>If you use <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> and the amazing <a href="https://magit.vc" target="_blank">Magit</a> you can of course do this via the Magit interface. In the Magit buffer for the repository (e.g.&nbsp;<code>magit: ns-rse.github.io</code>) press <code>M</code> to bring up the <code>Remote</code> transient buffer. You then press <code>a</code> to add a remote and are prompted for a name for the remote (in this example we use the same as above <code>private-work</code>), this can be anything you want other than <code>origin</code> which is already defined, and then the URL this will be <code>git@github.com:&lt;account-name&gt;/&lt;private-repo-name&gt;.git</code>.</p>
<p>To create a branch in Magit press <code>b</code> then <code>l</code> to select a local branch and enter <code>main</code> (or <code>master</code>), then make sure its upto date with the <code>origin</code> by Pulling with <code>P</code> then <code>u</code>. Now create a new branch by pressing <code>b</code> and since it will be a new press <code>c</code> to create it. You will be prompted for the name of a branch from which to branch from and then for the name of your branch.</p>
<p>In the Magit buffer for the repository you are working on pushes are made with <code>P</code>. The Transient buffer then offers you a choice of places to push to, one of which is <code>elsewhere</code> which is accessed by the <code>e</code> key. You can then type in the name of the remote tracking branch as defined under the <code>remote</code> entry you configured above which in this case is <code>private-work</code>.</p>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2023,
  author = {Shephard, Neil},
  title = {Git {Remotes}},
  date = {2023-10-06},
  url = {https://blog.nshephard.dev/posts/git-remotes/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2023" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2023. <span>“Git Remotes.”</span> October 6, 2023. <a href="https://blog.nshephard.dev/posts/git-remotes/">https://blog.nshephard.dev/posts/git-remotes/</a>.
</div></div></section></div> ]]></description>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <guid>https://blog.nshephard.dev/posts/git-remotes/</guid>
  <pubDate>Fri, 06 Oct 2023 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/49833632231_bd701b7621_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Pre-commit and R Packaging</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/pre-commit-r/</link>
  <description><![CDATA[ 





<p>This post is aimed at getting you up and running with the R <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">precommit</a> Package. This shouldn’t be confused with the Python <a href="https://ns-rse.github.io/pre-commit" target="_blank">pre-commit</a> Package although as you might suspect they are closely related.</p>
<p>The R package (<code>precommit</code>) consists of a number of R specific hooks that are run by <code>pre-commit</code> before commits are made and check various aspects of your code for compliance with certain style and coding standards (mostly aspects of R packages and I’ll be posting more on R packaging in due course).</p>
<p>A major part of this post is about getting things setup on Windows, I’ve only given a light overview of some of the hooks and common problems encountered as I’ve gone about using and learning R packaging because not everyone uses Windows.</p>
<p>Most of the work on the R package is by <a href="https://github.com/lorenzwalthert/" target="_blank">Lorenz Walthert</a>, if you find it useful consider sponsoring his work, these things take a lot of time and effort and whilst they can be used for free are worth supporting.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/52985095726_49c5b394f1_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://flickr.com/photos/slackline/52985095726/" target="_blank">Erwin Wurm sculpture at Yorkshire Sculpture Park</a> by me</figcaption>
</figure>
</div>
<section id="pre-commit" class="level2">
<h2 class="anchored" data-anchor-id="pre-commit">pre-commit</h2>
<p>I love using <a href="https://pre-commit.com" target="_blank">pre-commit</a> in my development pipelines and have <a href="https://ns-rse.github.io/#category=pre-commit" target="_blank">blogged about it</a> a few times already. It saves so much hassle (once you are used to it) not just for yourself but also your collaborators who are reviewing your Pull Requests. The <a href="https://github.com/lorenzwalthert/precommit" target="_blank">R precommit package</a> comes with a set of hooks that can be enabled and configured individually. I’ve recently and reason to start making and R package and as I’ve not used R much for a few years and this was my first time attempting to develop a package, I decided to use the hooks to impose the various style standards and checks that are expected.</p>
<p>I opted to enable <em>all</em> of the hooks. I’ve not covered them all here in detail (yet) but describe some of them below and show how to use some additional hooks from the <a href="https://usethis.r-lib.org" target="_blank">usethis</a> package too.</p>
<section id="codemetar" class="level3">
<h3 class="anchored" data-anchor-id="codemetar">codemetar</h3>
<p>There is a hook for checking the <a href="https://codemeta.github.io/" target="_blank">Codemeta</a>, which is in JSON-LD format is created correctly. The R package <a href="https://cran.r-project.org/web//packages//codemetar/vignettes/codemetar.html" target="_blank">codemetar</a> facilitates creating this and pulls metadata from the <code>DESCRIPTION</code>, <code>README.Rmd</code> and other aspects of your package to format them in JSON Codemeta. It comes with a handy function to write the file for you, so after installing you can just run <code>codemetar::write_codemeta()</code> which will create the <code>codemeta.json</code> for you. Remember to run this each and every time you update and of the files from which the metadata is created (although keep an eye on <a href="https://github.com/lorenzwalthert/precommit/issues/491" target="_blank">#491</a> which suggests updating automatically)</p>
</section>
<section id="roxygenize" class="level3">
<h3 class="anchored" data-anchor-id="roxygenize">roxygenize</h3>
<p><a href="https://roxygen2.r-lib.org/" target="_blank">Roxygen2</a> is a package for making the documentation to go with your package, it does this by parsing the documentation strings (“docstrings” for short) that you adorn your functions with that describe the arguments and show example usages. This hook requires additional configuration in <code>.pre-commit-config.yaml</code> as you have to install your package dependencies. Fortunately there is a helper function in the <code>precommit</code> package so you can just run <code>precommit::snippet_generate("additional-deps-roxygenize")</code> and it will output the YAML that you need to add to your <code>.pre-commit-config.yaml</code>. It might look something like the following.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> no-debug-statement</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> roxygenize</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">additional_dependencies</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    data.table</span></span>
<span id="cb1-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    dplyr</span></span>
<span id="cb1-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    dtplyr</span></span>
<span id="cb1-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    duckdb</span></span>
<span id="cb1-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    IMD</span></span>
<span id="cb1-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    lubridate</span></span>
<span id="cb1-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    stringr</span></span></code></pre></div>
</section>
<section id="style-files" class="level3">
<h3 class="anchored" data-anchor-id="style-files">style-files</h3>
<p>The <code>style-files</code> hook runs the <a href="https://styler.r-lib.org/" target="_blank">styler</a> package against your code to ensure it follows the <a href="https://style.tidyverse.org/" target="_blank">tidyverse style guide</a> by default, although it can be configured to use a custom style guide of your own creation.</p>
</section>
<section id="lintr" class="level3">
<h3 class="anchored" data-anchor-id="lintr">lintr</h3>
<p>The <a href="https://lintr.r-lib.org/" target="_blank">lintr</a> package lints your code automatically. It can be configured by adding a <code>.lintr</code> configuration file to your repository, a simple example is shown below. Note the indented closing parenthesis is important you get a complaint about that and any other formatting issues.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">linters<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linters_with_defaults</span>(</span>
<span id="cb2-2">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">line_length_linter</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>),</span>
<span id="cb2-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object_name_linter =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object_usage_linter =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb2-5">  )</span></code></pre></div>
</section>
<section id="spell-check" class="level3">
<h3 class="anchored" data-anchor-id="spell-check"><code>spell-check</code></h3>
<p>This is a useful hook that checks your spelling and adds unusual words to a custom dictionary <code>inst/WORDLIST</code>.</p>
</section>
<section id="deps-in-desc" class="level3">
<h3 class="anchored" data-anchor-id="deps-in-desc"><code>deps-in-desc</code></h3>
<p>This hook ensures that all dependencies that are loaded by your package are listed in the <code>DESCRIPTION</code> file so that when the package is installed the necessary dependencies are also pulled in, fairly essential..</p>
</section>
</section>
<section id="usethis-package" class="level2">
<h2 class="anchored" data-anchor-id="usethis-package">usethis package</h2>
<p>The <a href="https://usethis.r-lib.org" target="_blank">usethis</a> package is a compliment to the <a href="https://devtools.r-lib.org" target="_blank">devtools</a> package that has a lot of very useful helper functions. Some of these enable additional <code>pre-commit</code> hooks whilst others enable GitHub actions, which are part of Continuous Integration pipelines and I would highly recommend enabling them.</p>
<section id="readme.rmd" class="level3">
<h3 class="anchored" data-anchor-id="readme.rmd"><code>README.Rmd</code></h3>
<p>The <a href="https://usethis.r-lib.org/reference/use_readme_rmd.html" target="_blank"><code>user_readme_rmd()</code></a> function automatically generates a <code>README.Rmd</code> template and will also create a <code>pre-commit</code> hook that keeps it synchronised with <code>README.md</code> whenever you update it. This is useful because the later, plain-markdown, file is automatically rendered by GitHub/GitLab/Codeberg as your repositories front-page.</p>
</section>
<section id="use_github_action" class="level3">
<h3 class="anchored" data-anchor-id="use_github_action"><code>use_github_action()</code></h3>
<p>Invoking <code>use_github_action()</code> within your package repository will prompt you for the type of action you wish to add to it. There are, as of writing, three options.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">use_github_action</span>()</span>
<span id="cb3-2">    Which action do you want to add? (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> to exit)</span>
<span id="cb3-3">    (See <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>github.com<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tree<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>v2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>examples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> other options)</span>
<span id="cb3-4"></span>
<span id="cb3-5">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> check<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standard<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Run <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R CMD check</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> on Linux, macOS, and Windows</span>
<span id="cb3-6">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>coverage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Compute test coverage and report to https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>about.codecov.io</span>
<span id="cb3-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> pr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>commands<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Add <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>document and <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>style commands <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> pull requests</span></code></pre></div>
<p>Selecting one will write a file to <code>/.github/workflows/&lt;FILENAME&gt;.yaml</code> and then print out code to add a badge to your repository.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">Selection<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-2">    ✔ Adding <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*.html'</span> to <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.github/.gitignore'</span></span>
<span id="cb4-3">    ✔ Creating <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.github/workflows/'</span></span>
<span id="cb4-4">    ✔ Saving <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r-lib/actions/examples/check-standard.yaml@v2'</span> to <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.github/workflows/R-CMD-check.yaml'</span></span>
<span id="cb4-5">    • Learn more at <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>github.com<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>v2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>examples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>README.md<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>.</span>
<span id="cb4-6">    • Copy and paste the following lines into <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'README.Rmd'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-7">      <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!--</span> badges<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> start <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span></span>
<span id="cb4-8">      [<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>[R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CMD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>check](https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>github.com<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>CUREd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Plus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cuRed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>workflows<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CMD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>check.yaml<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>badge.svg)](https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>github.com<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>CUREd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Plus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cuRed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>actions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>workflows<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CMD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>check.yaml)</span>
<span id="cb4-9">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!--</span> badges<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> end <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span></span>
<span id="cb4-10">      [Copied to clipboard]</span></code></pre></div>
</section>
<section id="badges" class="level3">
<h3 class="anchored" data-anchor-id="badges">Badges</h3>
<p>Most of the GitHub Action functions described above include output that can be copy and pasted into <code>README.Rmd</code> to include badges in your GitHub front page. Again the <a href="https://usethis.r-lib.org/reference/badges.html" target="_blank">usethis</a> has you covered and can generate the necessary code for the different badges it supports.</p>
</section>
</section>
<section id="gotchas" class="level2">
<h2 class="anchored" data-anchor-id="gotchas">Gotchas</h2>
<p>When starting out I found that I regularly didn’t pass the <code>pre-commit</code> hooks first time. This can be jarring and confusing to start with but its not something to worry about, they are there to ensure your code and package meet the standards required. If you ever come to submit to <a href="https://cran.r-project.org" target="_blank">CRAN</a> you will be grateful to have adhered to these standards.</p>
<p>Below I detail common “gotchas” I encountered when developing the package, what they mean and how to resolve them.</p>
<section id="the-following-spelling-errors-were-found" class="level3">
<h3 class="anchored" data-anchor-id="the-following-spelling-errors-were-found"><code>The following spelling errors were found:</code></h3>
<p>The <code>spell-check</code> hook <em>will</em> fail if you’ve introduced new words that aren’t in standard dictionaries with messages similar to the those shown below. Sometimes these will be new words, sometimes they might be catching typos you have made. In the example below <code>famiy</code> should be <code>family</code> so you need to correct the source of the typo (and you’re told where this is, in this case it was line 27 of <code>CITATION.cff</code>), or if the new word should be added to the dictionary you will have to stage the updated <code>inst/WORDLIST</code> file for inclusion in your commit.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">spell-check..............................................................Failed</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> hook id: spell-check</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> exit code: 1</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> files were modified by this hook</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ℹ</span> Using R 4.3.1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lockfile</span> was generated with R 4.2.1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ℹ</span> Using R 4.3.1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lockfile</span> was generated with R 4.2.1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">The</span> following spelling errors were found:</span>
<span id="cb5-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WORD</span>    FOUND IN</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">famiy</span>   CITATION.cff:27</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">All</span> spelling errors found were copied to inst/WORDLIST assuming they were not spelling errors and will be ignored in the future. Please  review the above list and for each word that is an actual typo:</span>
<span id="cb5-12"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> fix it in the source code.</span>
<span id="cb5-13"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> remove it again manually from inst/WORDLIST to make sure it<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s not</span></span>
<span id="cb5-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">   ignored in the future.</span></span>
<span id="cb5-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> Then, try committing again.</span></span>
<span id="cb5-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Error: Spell check failed</span></span>
<span id="cb5-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Execution halted</span></span></code></pre></div>
</section>
<section id="codemeta.json-is-out-of-date" class="level3">
<h3 class="anchored" data-anchor-id="codemeta.json-is-out-of-date"><code>! codemeta.json is out of date</code></h3>
<p>If you modify the <code>DESCRIPTION</code> or <code>CITATION.cff</code> then the <code>codemeta-description-updated</code> hook <em>will</em> fail with error messages similar to the following.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">codemeta-description-updated.............................................Failed</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> hook id: codemeta-description-updated</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> exit code: 1</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ℹ</span> Using R 4.3.1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lockfile</span> was generated with R 4.2.1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ℹ</span> Using R 4.3.1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lockfile</span> was generated with R 4.2.1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Error:</span></span>
<span id="cb6-8"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">! </span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">codemeta.json</span> is out of date<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">please</span> re-run codemetar::write_codemeta<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Backtrace:</span></span>
<span id="cb6-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">▆</span></span>
<span id="cb6-11"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1.</span> └─rlang::abort<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"codemeta.json is out of date; please re-run codemetar::write_codemeta()."</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Execution</span> halted</span></code></pre></div>
<p>This means yo need to update the <code>codemeta.json</code> with</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">codemetar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_codemeta</span>()</span></code></pre></div>
</section>
<section id="warning-undocumented-code-objects" class="level3">
<h3 class="anchored" data-anchor-id="warning-undocumented-code-objects"><code>Warning: Undocumented code objects:</code></h3>
<p>If this error arises its because there is a <code>.Rd</code> file missing. You can generate these by ensuring you have the appropriate docstring definition prior to your function and then use the <code>roxygen2::reoxygenise()</code> function to generate the documentation automatically. Don’t forget to <code>git stage</code> and <code>git commit</code> the files to your repository, pushing if needed (e.g.&nbsp;a Continuous Integration pipeline is failing).</p>
</section>
</section>
<section id="windows" class="level2">
<h2 class="anchored" data-anchor-id="windows">Windows</h2>
<p>I haven’t used Windows for about 23 years but I often have colleagues who do and that was the case with the R package that I have started developing so I needed to get all members of the team up and running with the <code>precommit</code> R package/pipeline.</p>
<p>Windows doesn’t come with Python by default, but <a href="https://pre-commit.com" target="_blank">pre-commit</a> is written in Python and so an environment is required in order to run the above pre-commit hooks. There are many options for this, including using <a href="https://learn.microsoft.com/en-us/windows/wsl/install" target="_blank">Windows Subsystem for Linux (WSL)</a>. I opted to try the solution provided in the <a href="https://cran.r-project.org/web/packages/precommit/vignettes/precommit.html" target="_blank">precommit vignette</a>. This shows how to use the <a href="https://rstudio.github.io/reticulate/" target="_blank">reticulate</a> package which acts as a glue between <a href="https://r-project.org" target="_blank">R</a> and <a href="https://python.org" target="_blank">Python</a>, to handle installing a <a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a> environment and setting up <code>precommit</code>/<code>pre-commit</code>.</p>
<p>The following runs you through the things you need to install (R, RStudio, GitBash), setting up GitHub with <a href="https://ns-rse.github.io/#category=ssh" target="_blank">SSH</a> keys and enabling <code>precommit</code> for your R package locally.</p>
<section id="install-r" class="level3">
<h3 class="anchored" data-anchor-id="install-r">Install <a href="https://www.r-project.org" target="_blank">R</a></h3>
<p>When installing the defaults are fine, request admin permissions if required.</p>
</section>
<section id="install-rstudio" class="level3">
<h3 class="anchored" data-anchor-id="install-rstudio">Install <a href="https://posit.co/downloads/" target="_blank">Rstudio</a></h3>
<p>Defaults are fine, request admin permissions if required.</p>
</section>
<section id="install-gitbash" class="level3">
<h3 class="anchored" data-anchor-id="install-gitbash">Install <a href="https://git-scm.com/download/win" target="_blank">GitBash</a></h3>
<p>During installation you’ll be asked a number of questions, if you’re unsure how to respond to any of them the following provides guidance.</p>
<ol type="1">
<li><strong>Text Editor</strong> - Configure with your choice of editor, obviously you’ll want to have <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> available and select that! <span class="emoji" data-emoji="wink">😉</span></li>
<li><strong>Adjust your PATH environment</strong> - At the bare minimum go with the <code>Recommended</code> option and allow <em>Git from the command line and also from 3rd-party software</em>. Optionally I would recommend the third option of <em>Use Git and optional UNIX tools from the Command Prompt</em>, particularly if you are either a) familiar with UNIX commands or b) not at all familiar with them (as you won’t have to re-learn the Windows commands, just learn the Bash commands they are more widely applicable).</li>
<li><strong>Use Bundled SSH library</strong> - Use the bundled SSH library.</li>
<li><strong>Use Bundled OpenSSL library</strong> - Use the bundled OpenSSL library.</li>
<li><strong>Checkout Windows-style, commit Unix-style line endings</strong> - This is fine, it just changes the internal representation of the carriage return to be more universal.</li>
<li><strong>Use MinTTY</strong> - The default terminal of MSYS2 is fine and more functional than the Windows’ default console window.</li>
<li><strong>Default Merge behaviour</strong> - The default (fast-forward or merge) this is fine.</li>
<li><strong>Choose a credential helper</strong> - Select <em>None</em> here, we will let RStudio manage these.</li>
<li><strong>Configure Extra Options</strong> - Defaults are fine.</li>
<li><strong>Configuring experimental options</strong> - No need to enable any of these.</li>
</ol>
<section id="configure-git" class="level4">
<h4 class="anchored" data-anchor-id="configure-git">Configure Git</h4>
<p>Start a GitBash shell and configure your email address and name.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.email <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"you@example.com"</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your Name"</span></span></code></pre></div>
</section>
</section>
<section id="configure-rstudiogithub-with-ssh-keys" class="level3">
<h3 class="anchored" data-anchor-id="configure-rstudiogithub-with-ssh-keys">Configure RStudio/GitHub with SSH keys</h3>
<ol type="1">
<li>Start RStudio</li>
<li>Create SSH key - Navigate to <em>Tools &gt; General Options &gt; Git/SVN &gt; Create SSH Key</em> and under <em>SSH key type</em> select the default (<em>ED25519</em>) this is a <a href="https://blog.g3rt.nl/upgrade-your-ssh-keys.html" target="_blank">very secure elliptic curve algorithm</a> and is supported by GitHub. Use a secure password (i.e.&nbsp;long), do <strong>not</strong> change the location it is created at.</li>
<li>Once created select <em>View public key</em> and use <em>Ctrl + c</em> to copy this to your clipboard.</li>
<li>Navigate to <a href="https://github.com/" target="_blank">GitHub</a> and login then click on your avatar in the top right and select <em>Settings &gt; SSH and GPG keys &gt; New SSH Key</em>.</li>
<li>Give the key a name and paste into the box below where indicated/instructed then click on <em>Add SSH key</em>.</li>
</ol>
</section>
<section id="clone-repository" class="level3">
<h3 class="anchored" data-anchor-id="clone-repository">Clone Repository</h3>
<p>Its likely that you will have an existing repository that you wish to work on with this pipeline, if so you will have to clone it locally so you can work on it with the <code>precommit</code> pipeline. The following assumes you have added your SSH key to your GitHub account as described above.</p>
<ol type="1">
<li>Navigate to the repository you wish to clone (e.g.&nbsp;<a href="https://github.com/CUREd-Plus/cuRed/" target="_blank">https://github.com/CUREd-Plus/cuRed/</a>) and click on the <em>Code</em> button then select <em>SSH</em> under the <em>Local</em> tab in the box that appears.</li>
<li>Click on the box that has two small squares to the right of some text to copy the URL to clipboard.</li>
<li>Return to RStudio and start a new project with <em>File &gt; New Project &gt; Version Control &gt; Git</em> and paste the URL into the <em>Repository URL</em>. Select a location to clone to under <em>Create project as subdirectory of:</em>, e.g.&nbsp;<code>c:/Users/&lt;username&gt;/work/cuRed</code> (replacing <code>&lt;username&gt;</code> with <em>your</em> username).</li>
<li>If prompted for password enter it. If asked to answer <em>Yes\/No</em> answer <em>Yes</em> and then if prompted to <em>Store password for this session</em> answer <em>Yes</em>.</li>
<li>You should now have cloned the repository and have a project to work on.</li>
</ol>
</section>
<section id="install-pre-commit" class="level3">
<h3 class="anchored" data-anchor-id="install-pre-commit">Install <code>pre-commit</code></h3>
<p>As mentioned above <code>pre-commit</code> refers to two things, primarily it is the Python package <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> that does all the work of running Linting, Tests etc. before making commits. It also refers to an R package <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">precommit</a> (note the omission of the hyphen <code>-</code>) that works with the Python package to enable use of various R packages that carry out such checks. Because it is a Python package it needs a Python Virtual Environment to run. This may sound unfamiliar but don’t worry the R <code>precommit</code> package and documentation guides you through doing so, what follows is a rehash of the <a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">official documentation</a>.</p>
<section id="install-precommit-and-reticulate" class="level4">
<h4 class="anchored" data-anchor-id="install-precommit-and-reticulate">Install <code>precommit</code> and <code>reticulate</code></h4>
<p>From RStudio install the <code>remotes</code> and <code>reticulate</code> package, then install the most recent version of <code>precommit</code> directly from GitHub.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remotes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reticulate"</span>))</span>
<span id="cb9-2">remotes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lorenzwalthert/precommit"</span>)</span></code></pre></div>
</section>
<section id="install-miniconda-environment" class="level4">
<h4 class="anchored" data-anchor-id="install-miniconda-environment">Install Miniconda environment</h4>
<p>You can now use <code>reticulate</code> to install a <a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a> virtual environment framework for R to run Python packages (i.e.&nbsp;<code>pre-commit</code>).</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timeout=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>)</span>
<span id="cb10-2">reticulate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_miniconda</span>()</span></code></pre></div>
</section>
<section id="install-pre-commit-framework" class="level4">
<h4 class="anchored" data-anchor-id="install-pre-commit-framework">Install <code>pre-commit</code> framework</h4>
<p>This step now installs the Python package <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> within a new Miniconda virtual environment (by default <code>r-precommit</code>). There will be a fair bit of output here as all the dependencies in Python for <code>pre-commit</code> are downloaded.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">precommit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_precommit</span>()</span>
<span id="cb11-2">precommit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoupdate</span>()</span></code></pre></div>
</section>
<section id="use-precommit-with-the-existing-project" class="level4">
<h4 class="anchored" data-anchor-id="use-precommit-with-the-existing-project">Use <code>precommit</code> with the existing project</h4>
<p>You should have cloned the repository you wish to enable <code>precommit</code> to use (see above). You now need to enable <code>precommit</code> for this local copy of the repository. This will place a script in <code>.git/hooks/pre-commit</code> that says which Miniconda environment to use (<code>r-precommit</code>) and will activate this whenever a commit is made, the <code>install_hooks = TRUE</code> ensures that the R specific hooks and their required environments are installed (under <code>\~/.config/pre-commit/</code>).</p>
<p>Make sure you have opened the <code>.Rproj</code> file in RStudio, this ensures you are within the project directory that you want to install <code>precommit</code> to (alternatively used <code>setwd()</code>).</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">precommit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">use_precommit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">install_hooks =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</section>
</section>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://r-pkgs.org/" target="_blank">R Packages book by Hadley Wickham and Jenny Bryan</a></li>
<li><a href="https://happygitwithr.com" target="_blank">Happy Git and GitHub for the useR by Jenny Bryan</a></li>
</ul>
<section id="r-packages" class="level3">
<h3 class="anchored" data-anchor-id="r-packages">R Packages</h3>
<ul>
<li><a href="https://devtools.r-lib.org/" target="_blank">devtools</a></li>
<li><a href="https://usethis.r-lib.org" target="_blank">usethis</a></li>
<li><a href="https://roxygen2.r-lib.org/" target="_blank">roxygen2</a></li>
<li><a href="https://cran.r-project.org/web//packages/precommit/vignettes/precommit.html" target="_blank">R precommit</a></li>
<li>(<a href="https://github.com/lorenzwalthert/precommit" target="_blank">GitHub | lorenzwalthert/precommit</a> check the <a href="https://github.com/lorenzwalthert/precommit/issues" target="_blank">Issues</a>, can be useful for troubleshooting.</li>
</ul>
</section>
<section id="python" class="level3">
<h3 class="anchored" data-anchor-id="python">Python</h3>
<ul>
<li><a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a></li>
</ul>
</section>
<section id="pre-commit-1" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit-1">Pre-commit</h3>
<ul>
<li><a href="https://pre-commit.com" target="_blank">pre-commit</a></li>
<li><a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a></li>
<li><a href="https://ns-rse.github.io/#category=pre-commit" target="_blank">ns-rse | pre-commit</a> blog posts I’ve made about <code>pre-commit</code>.</li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2023,
  author = {Shephard, Neil},
  title = {Pre-Commit and {R} {Packaging}},
  date = {2023-07-29},
  url = {https://blog.nshephard.dev/posts/pre-commit-r/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2023" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2023. <span>“Pre-Commit and R Packaging.”</span> July
29, 2023. <a href="https://blog.nshephard.dev/posts/pre-commit-r/">https://blog.nshephard.dev/posts/pre-commit-r/</a>.
</div></div></section></div> ]]></description>
  <category>quarto</category>
  <category>R</category>
  <category>git</category>
  <category>pre-commit</category>
  <category>github actions</category>
  <guid>https://blog.nshephard.dev/posts/pre-commit-r/</guid>
  <pubDate>Sat, 29 Jul 2023 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52985095726_49c5b394f1_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Pre-Commit : Useful Hooks</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/pre-commit-hooks/</link>
  <description><![CDATA[ 





<p>I’m a big fan of <a href="https://pre-commit.com" target="_blank">pre-commit</a> and have written about it before (see posts on <a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">pre-commit</a>, <a href="https://ns-rse.github.io/posts/pre-commit-ci/" target="_blank">pre-commit CI</a> and <a href="https://ns-rse.github.io/posts/pre-commit-updating/" target="_blank">pre-commit updating</a>). This post discusses some of the <a href="https://pre-commit.com/hooks" target="_blank">hooks</a> that I use and how to configure them.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://live.staticflickr.com/65535/52842122133_2b441c61ad_k.jpg" class="img-fluid figure-img"></p>
<figcaption><a href="https://www.flickr.com/photos/slackline/52842122133/in/datetaken/" target="_blank"><em>Irridescent</em> Picture by me</a></figcaption>
</figure>
</div>
<section id="python-linting" class="level2">
<h2 class="anchored" data-anchor-id="python-linting">Python Linting</h2>
<section id="ruff" class="level3">
<h3 class="anchored" data-anchor-id="ruff">Ruff</h3>
<p><a href="https://github.com/charliermarsh/ruff" target="_blank">ruff</a> is a Python linter written in Rust which means its considerably faster than many native linters. It aims for parity with Flake8 and covers a lot of the linting that PyLint undertakes too. Its configured via <code>pyproject.toml</code> which makes incorporating it into your Python Package simple.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/charliermarsh/ruff-pre-commit</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v0.0.191</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ruff</span></span></code></pre></div>
<p>Configuration is, as noted, via <code>pyproject.toml</code> and you may find the post on <a href="https://ns-rse.github.io/posts/python-packaging/" target="_blank">Python Packaging</a> worth reading to understand more on this.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.ruff]</span></span>
<span id="cb2-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">exclude</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># per-file-ignores = []</span></span>
<span id="cb2-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">line-length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span></span>
<span id="cb2-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">target-version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"py310"</span></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Allow autofix for all enabled rules (when `--fix`) is provided.</span></span>
<span id="cb2-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fixable</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"U"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unfixable</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span></span></code></pre></div>
</section>
<section id="black" class="level3">
<h3 class="anchored" data-anchor-id="black">Black</h3>
<p><a href="https://black.readthedocs.io/en/stable/index.html" target="_blank">Black</a> is an opinionated formatter for Python that is <a href="https://pep8.org/" target="_blank">PEP8</a> compliant. By using <code>black</code> to format your code you end up with a consistent style across the code base and commit changes end up being minimal. This helps speed up code-review of pull-requests.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/psf/black</span></span>
<span id="cb3-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22.10.0</span></span>
<span id="cb3-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> black</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span></code></pre></div>
<p>Configuration is, as noted, via <code>pyproject.toml</code> and you may find the post on <a href="https://ns-rse.github.io/posts/pre-commit-updating/" target="_blank">Python Packaging</a> worth reading to understand more on this.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.black]</span></span>
<span id="cb4-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">line-length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span></span>
<span id="cb4-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">target-version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"py38"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"py39"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"py310"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">include</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.pyi?$"</span></span></code></pre></div>
</section>
<section id="pydocstyle" class="level3">
<h3 class="anchored" data-anchor-id="pydocstyle">pydocstyle</h3>
<p>You can check your docstrings are correctly written using the <a href="https://www.pydocstyle.org/en/stable/usage.html#usage-with-the-pre-commit-git-hooks-framework" target="_blank">pydocstyle</a> hook.</p>
<p>Its pretty straight-forward to use and accepts arguments so you can pass all the command line options you might want to use into the hook when it runs. It supports three different doc string styles, <code>pep257</code>, <code>numpy</code> and <code>google</code>.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> repo  https://github.com/pycqa/pydocstyle</span></span>
<span id="cb5-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.3.0</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # pick a git hash / tag to point to</span></span>
<span id="cb5-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pydocstyle</span></span>
<span id="cb5-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> --convention=numpy</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        # Optionally ignore rules</span></span>
<span id="cb5-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> --ignore=D101,D2</span></span></code></pre></div>
<p>Alternatively you can add configuration options to your projects <code>pyproject.toml</code> under a <code>[tool.pydocstyle]</code> section.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[tool.pydocstyle]</span></span>
<span id="cb6-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">convention</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numpy"</span></span>
<span id="cb6-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ignore</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb6-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D101"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D2"</span></span>
<span id="cb6-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
</section>
<section id="markdown-linting" class="level2">
<h2 class="anchored" data-anchor-id="markdown-linting">Markdown Linting</h2>
<p><a href="https://github.com/DavidAnson/markdownlint-cli2" target="_blank">markdownlint-cli2</a> is a useful and highly configurable hook for linting <a href="https://www.markdownguide.org" target="_blank">Markdown</a> and <a href="https://commonmark.org/" target="_blank">CommonMark</a>. I wanted to use it on this blog though which is written using <a href="https://quarto.org/docs/authoring/markdown-basics.html" target="_blank">Quarto</a> and therefore uses <a href="https://pandoc.org/MANUAL.html#pandocs-markdown" target="_blank">PandocMarkdown</a> with files that have extension <code>.qmd</code>. I therefore enable the hook in <code>.pre-commit-config.yaml</code> with a configuration file specified</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/DavidAnson/markdownlint-cli2</span></span>
<span id="cb7-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v0.6.0</span></span>
<span id="cb7-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb7-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> markdownlint-cli2</span></span>
<span id="cb7-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.markdownlin-cli2.yaml</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span></code></pre></div>
<p>..and add a sample configuration file (e.g.&nbsp;<code>.mardownlint-cli2.yaml</code> although other formats such as JSON can be used) is shown below and <code>markdownlint-cli2</code> picks this up automatically.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Configuration</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">config</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # MD013 - line-length</span></span>
<span id="cb8-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">line_length</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb8-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">line_length</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span></span>
<span id="cb8-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">code_blocks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb8-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tables</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb8-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb8-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">allowed_elements</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb8-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> div</span></span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Globs</span></span>
<span id="cb8-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">globs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb8-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"**/*.qmd"</span></span>
<span id="cb8-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.qmd"</span></span>
<span id="cb8-16"></span>
<span id="cb8-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fix any fixable errors</span></span>
<span id="cb8-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span></code></pre></div>
</section>
<section id="emacs-lisp" class="level2">
<h2 class="anchored" data-anchor-id="emacs-lisp">Emacs Lisp</h2>
<p>As I use <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> I have recourse to write some <a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/" target="_blank">Emacs Lisp</a> and so its useful to applying formatting to my <code>.el</code> files before committing them. <a href="https://github.com/eschulte/lisp-format" target="_blank">lisp-format</a> does the job nicely.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb9-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/eschulte/lisp-format</span></span>
<span id="cb9-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 088c8f78ca41204b44f2636275517ac09a2de6a9</span></span>
<span id="cb9-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb9-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> lisp-format</span></span>
<span id="cb9-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> formatter of lisp code</span></span>
<span id="cb9-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Run lisp-format against lisp files</span></span>
<span id="cb9-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> script</span></span>
<span id="cb9-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">files</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> \.(lisp|cl|asd|scm|el)$</span></span>
<span id="cb9-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> lisp-format -i</span></span></code></pre></div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>There are a <em>lot</em> of hooks out there to be used with <a href="https://pre-commit.com" target="_blank">pre-commit</a> and incorporated into your Continuous Integration pipeline with <a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a>. Which you find useful will depend to a large extent on the languages that you are using for any given project. Here I’ve focused mainly on common tools for Python Packages, Markdown and Lisp but you can find hooks for Docker, Ansible, Rust, Go, JavaScript, C++ and many more, there is even <a href="https://github.com/jorisroovers/gitlint" target="_blank">gitlint</a> which lints your commit messages! Checkout the long list of available <a href="https://pre-commit.com/hooks" target="_blank">hooks</a> and try some out.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<section id="related-pre-commit-posts" class="level3">
<h3 class="anchored" data-anchor-id="related-pre-commit-posts">Related pre-commit posts</h3>
<ul>
<li><a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">pre-commit</a></li>
<li><a href="https://ns-rse.github.io/posts/pre-commit-ci/" target="_blank">pre-commit CI</a></li>
<li><a href="https://ns-rse.github.io/posts/pre-commit-updating/" target="_blank">pre-commit updating</a></li>
</ul>
</section>
<section id="pre-commit-hooks" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit-hooks">Pre-commit hooks</h3>
<ul>
<li><a href="https://pre-commit.com" target="_blank">pre-commit</a> (<a href="https://pre-commit.com/hooks" target="_blank">pre-commit hooks</a>)</li>
<li><a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a></li>
<li><a href="https://github.com/charliermarsh/ruff" target="_blank">ruff</a></li>
<li><a href="https://github.com/DavidAnson/markdownlint-cli2" target="_blank">markdownlint-cli2</a></li>
<li><a href="https://black.readthedocs.io/en/stable/index.html" target="_blank">Black</a></li>
<li><a href="https://github.com/eschulte/lisp-format" target="_blank">lisp-format</a></li>
<li><a href="https://github.com/jorisroovers/gitlint" target="_blank">gitlint</a></li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2023,
  author = {Shephard, Neil},
  title = {Pre-Commit : {Useful} {Hooks}},
  date = {2023-05-07},
  url = {https://blog.nshephard.dev/posts/pre-commit-hooks/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2023" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2023. <span>“Pre-Commit : Useful Hooks.”</span> May 7,
2023. <a href="https://blog.nshephard.dev/posts/pre-commit-hooks/">https://blog.nshephard.dev/posts/pre-commit-hooks/</a>.
</div></div></section></div> ]]></description>
  <category>code</category>
  <category>analysis</category>
  <category>linting</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>pre-commit</category>
  <guid>https://blog.nshephard.dev/posts/pre-commit-hooks/</guid>
  <pubDate>Sun, 07 May 2023 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52842122133_2b441c61ad_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Pre-Commit.ci : Integrating Pre-Commit into CI/CD</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/pre-commit-ci/</link>
  <description><![CDATA[ 





<p><strong>NB</strong> If you’ve not read it already I would recommend reading my previous post on using <a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">pre-commit</a> as the contents described herein assume that you are already using <a href="https://pre-commit.com" target="_blank">pre-commit</a> in your development.</p>
<p>Having <a href="https://pre-commit.com" target="_blank">pre-commit</a> setup locally to run before making commits is great. Typically code lives in a “forge” such as <a href="https://github.com" target="_blank">GitHub</a> or <a href="https://gitlab.com" target="_blank">GitLab</a> and as <code>pre-commit</code> is run on each commit you shouldn’t have any problems when you come to <code>git push</code> your code to the remote <code>origin</code> repository (i.e.&nbsp;the repository hosted on GitHub/GitLab) as all <code>pre-commit</code> checks will have to have passed before this will take place.</p>
<p>But what if for some reason you disabled <code>pre-commit</code> just to make some changes rather than addressing the failed linting or test? Or if you work on an open-source project and someone else contributes how can you ensure that their contributed code meets the code-style chosen by the project and that all tests pass in light of the changes that are being introduced?</p>
<section id="continuous-integration-continuous-delivery-cicd" class="level2">
<h2 class="anchored" data-anchor-id="continuous-integration-continuous-delivery-cicd">Continuous Integration / Continuous Delivery (CI/CD)</h2>
<p>The solution to this is Continuous Integration/Continuous Delivery (CI/CD) which runs various hooks on GitHub/GitLab etc. in response to specific tasks/actions that occur on the repository. The exact name or system used depends on the forge, on GitHub these are <a href="https://docs.github.com/en/actions" target="_blank">GitHub Actions</a> (see also <a href="https://github.com/marketplace?type=actions" target="_blank">Actions Marketplace</a>) whilst on GitLab uses <a href="https://docs.gitlab.com/ee/ci/pipelines/" target="_blank">Pipelines</a>. There are even standalone systems which integrate with both such as the popular <a href="https://www.jenkins.io" target="_blank">Jenkins</a>.</p>
<p><strong>By employing <code>pre-commit</code> as part of your CI/CD pipeline you ensure code meets the standards (linting, tests etc.) you wish contributions to meet before it is merged into your <code>main</code>/<code>master</code> branch`</strong></p>
<p>These work by running processes under certain conditions, for example on a <code>push</code> to the <code>main</code> branch or a <code>tag</code> that begins with <code>v</code>, and they might run processes such as running the test suite for your project to ensure all tests pass, build web-pages or build the package for deployment to a repository (e.g.&nbsp;<a href="https://pypi.org" target="_blank">PyPI</a>). They are really useful and flexible systems and can be leveraged to run <code>pre-commit</code> on your code when Pull Requests (PR) are made to ensure the PR passes the various hooks. Ultimately a PR results in a <code>commit</code> to <code>master</code>/<code>main</code> and so its logically consistent that Pull Requests should pass <code>pre-commit</code> prior to being merged.</p>
<p>Under any system you could write your own hook to run <code>pre-commit</code> but there is an even easier and more efficient solution if you use GitHub in the form of <a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a>.</p>
</section>
<section id="github-and-pre-commit.ci" class="level2">
<h2 class="anchored" data-anchor-id="github-and-pre-commit.ci">GitHub and pre-commit.ci</h2>
<p>Currently <a href="https://pre-commit.ci" target="_blank">pre-commit.ci</a> only supports GitHub although support of other systems is in the pipeline. <code>pre-commit.ci</code> doesn’t need any configuration beyond your already existing <code>.pre-commit-config.yaml</code> (see <a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">Pre-commit : Protecting Your Future Self</a>). Where a <code>pre-commit</code> hook corrects formatting issues as is the case with some of the defaults such as <code>trailing-whitespace</code> or <code>check-yaml</code>, or if you are using Python linters such as <a href="https://black.readthedocs.io/en/stable/" target="_blank"><code>black</code></a> or <a href="https://github.com/charliermarsh/ruff" target="_blank"><code>ruff</code></a> which fix errors, <code>pre-commit.ci</code> can commit these changes and push them back to the Pull Request automatically. In a similar vein it will also routinely update the <code>rev</code> used in your <code>.pre-commit-config.yaml</code>, commit the change and push it back to your repository.</p>
<p>It is also really fast because <code>pre-commit.ci</code> keeps the virtual environments that are used in tests cached whereas if you wrote your own action to run this the GitHub runner that is spun up to run GitHub Actions would have to download all of these each time the action is run is they are not persistent.</p>
<p>Use of <code>pre-commit.ci</code> is free for open-source repositories and there are paid options for private or organisation repositories.</p>
<blockquote class="blockquote">
<p><strong>Benefits of pre-commit.ci</strong></p>
<ul>
<li>Supports GitHub but more to come in the future.</li>
<li>Zero configuration, just need <code>.pre-commit-config.yaml</code>.</li>
<li>Corrects &amp; commits formatting issues automatically without need for developer to reformat.</li>
<li>Automatically updates <code>.pre-commit-config.yaml</code> for you (e.g.&nbsp;new <code>rev</code>).</li>
<li>Faster than your own GitHub Action.</li>
<li>Free for open source repositories (paid for version for private/organisation repositories).</li>
</ul>
</blockquote>
<section id="configuration-.pre-commit-config.yaml" class="level3">
<h3 class="anchored" data-anchor-id="configuration-.pre-commit-config.yaml">Configuration (<code>.pre-commit-config.yaml</code>)</h3>
<p>Whilst not required it is possible to configure the behaviour of <code>pre-commit.ci</code> by adding a <code>ci:</code> section to your <code>.pre-commit-config.yaml</code>. The fields are fairly self-explanatory as the example below shows. Its possible to toggle whether to <code>autofix_prs</code> and to set the <code>autofix_commit_msg</code>. The <code>autoupdate_schedule</code> can be set to <code>weekly</code>, <code>monthly</code> or <code>quarterly</code> along with a custom <code>autoupdate_commit_msg</code>. Finally you can optionally disable some hooks from being run only in <code>pre-commit.ci</code>.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ci</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autofix_prs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autofix_commit_msg</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'[pre-commit.ci] Fixing issues with pre-commit'</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoupdate_schedule</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> weekly</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoupdate_commit_msg</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'[pre-commit.ci] pre-commit automatically updated revs.'</span></span>
<span id="cb1-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skip</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pylint</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> # Optionally list ids of hooks to skip on CI</span></span></code></pre></div>
</section>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Setup is relatively straight-forward, head to <a href="https://pre-commit.ci" target="_blank">https://pre-commit.ci</a> and sign-in with your GitHub account and grant <code>pre-commit.ci</code> access to your account.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/pre-commit-ci.png" class="img-fluid figure-img"></p>
<figcaption>Pre-commit CI</figcaption>
</figure>
</div>
<p>Once you have granted access you can choose which repositories <code>pre-commit.ci</code> has access to. It is possible to grant access to all repositories but I would recommend doing so on a per-repository basis so you know and are in control of what is happening across your repositories. If you have administration rights to organisation repositories these should be listed in the “<em>Select repositories</em>” pull-down menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/github-pre-commit-access.png" class="img-fluid figure-img"></p>
<figcaption>Granting pre-commit.ci access to GitHub</figcaption>
</figure>
</div>
</section>
<section id="pre-commit.ci-jobs" class="level3">
<h3 class="anchored" data-anchor-id="pre-commit.ci-jobs"><code>pre-commit.ci</code> jobs</h3>
<p>When logged into <code>pre-commit.ci</code> using your GitHub account you are presented with a page similar to the following which lists the accounts and any organisations that you have authorised <code>pre-commit.ci</code> to access.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/account-pre-commit-ci.png" class="img-fluid figure-img"></p>
<figcaption>Pre-commit.ci account access</figcaption>
</figure>
</div>
<p>You can follow the links through to view the history of jobs run by <code>pre-commit.ci</code> and whether they pass or fail. The page shows the current status and provides both Markdown and reStructured Text code for adding badges to your source documents (e.g.&nbsp;the Markdown badge can be added to your repositories top-level <code>README.md</code> and the badge will be displayed on GitHub)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/pre-commit-ci-pass2.png" class="img-fluid figure-img"></p>
<figcaption>Pre-commit.ci jobs pass</figcaption>
</figure>
</div>
<p>You can click through and see the results of a given run and when they <a href="https://results.pre-commit.ci/run/github/168173540/1674062271.Tj4xDOxqRFu3CDIPhXkMJA" target="_blank">pass</a> they look similar to the output you would have seen when making commits locally.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/pre-commit-ci-pass3.png" class="img-fluid figure-img"></p>
<figcaption>Pre-commit.ci jobs pass</figcaption>
</figure>
</div>
<p>But sometimes things will <a href="https://results.pre-commit.ci/run/github/168173540/1674061180.-2Eo_dbfRAGrukip387Nhg" target="_blank">fail</a> as shown below where the <code>trailing-whitespace</code> hook failed and the file was modified. But since <code>pre-commit.ci</code> corrects and pushes such changes automatically you can see at the bottom that these changes were pushed to the Pull Request from which the originated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/pre-commit-ci-fail.png" class="img-fluid figure-img"></p>
<figcaption>Pre-commit.ci jobs fail</figcaption>
</figure>
</div>
</section>
</section>
<section id="gitlab" class="level2">
<h2 class="anchored" data-anchor-id="gitlab">GitLab</h2>
<p>As <a href="https://pre-commit.ci" target="_blank"><code>pre-commit.ci</code></a> doesn’t (yet) support GitLab integrating <code>pre-commit</code> into your GitLab Pipeline is a little more involved. What follows is based on the excellent post on <a href="https://stackoverflow.com/collectives/articles/71270196/how-to-use-pre-commit-to-automatically-correct-commits-and-merge-requests-with-g" target="_blank">StackOverflow</a> describing how to achieve this integration.</p>
<p>You should already have a valid <code>.pre-commit-config.yaml</code> in place (if not work through <a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">Pre-commit : Protecting your future self (blog-post)</a>). To enable <code>pre-commit</code> on your <a href="https://docs.gitlab.com/ee/ci/pipelines/" target="_blank">GitLab Pipeline</a> you need to to have a pipeline in place. This is a file in the root of your repository called <code>.gitlab-ci.yml</code>. You need to add the following to this file…</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">variables</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # since we're not using merge request pipelines in this example,</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # we will configure the pre-commit job to run on branch pipelines only.</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # If you ARE using merge request pipelines, you can omit this section</span></span>
<span id="cb2-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PRE_COMMIT_DEDUPLICATE_MR_AND_BRANCH</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PRE_COMMIT_AUTO_FIX_BRANCH_ONLY</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remote</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://gitlab.com/yesolutions/gitlab-ci-templates/raw/main/templates/pre-commit-autofix.yaml'</span></span></code></pre></div>
<p>This uses the <code>pre-commit-autofix.yaml</code> from <a href="https://gitlab.com/yesolutions/" target="_blank">yesolutions</a> to run <code>pre-commit</code> and as the configuration shows automatically apply fixes <code>pre-commit</code> makes to your code. There are more options available for configuring this pipeline and they are documented <a href="https://gitlab.com/yesolutions/gitlab-ci-templates" target="_blank">here</a>.</p>
<p>Because you are allowing a third-party pipeline to access your repository when pushing the changes <code>pre-commit</code> makes back to your repository for this to work you <em>must</em> create a <a href="https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html" target="_blank">project access token</a>. Under the repositories <em>Settings &gt; Access Tokens</em> you can create a new token with an expiry date. You must then create a CI/CD variable called <code>PRE_COMMIT_ACCESS_TOKEN</code> with this token as a value.</p>
<p>Once you have done this your CI/CD pipeline should show at the very start the <code>.pre</code> stage…</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/gitlab-pre-commit-pipeline.png" class="img-fluid figure-img"></p>
<figcaption>GitLab pre-commit pipeline.</figcaption>
</figure>
</div>
<p>…and you can click through on this to see the details of the pipeline. Note that it takes a while to run as it has to download and initialise all of the environments for each configured hook unlike <a href="https://pre-commit.ci" target="_blank"><code>pre-commit.ci</code></a> (this is akin to writing your own <a href="https://docs.github.com/en/actions" target="_blank">GitHub Action</a> to run <code>pre-commit</code> which would also have to download and initialise the environments).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://blog.nshephard.dev/posts/pre-commit-ci/img/gitlab-pre-commit-pipeline-pass.png" class="img-fluid figure-img"></p>
<figcaption>Success! GitLab pre-commit hooks pass!</figcaption>
</figure>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This article has covered</p>
<ul>
<li>Why to integrate <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> into your Continuous Integration/Delivery pipeline.</li>
<li>What the <a href="https://pre-commit.ci" target="_blank"><code>pre-commit.ci</code></a> service is and the benefits it provides.</li>
<li>How to integrate <a href="https://pre-commit.ci" target="_blank"><code>pre-commit.ci</code></a> with <a href="https://github.com" target="_blank">GitHub</a> repositories.</li>
<li>How to integrate <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a> with <a href="https://gitlab.com" target="_blank">GitLab</a> repositories.</li>
</ul>
<p>By automating linting and testing in this manner you improve and shorten the feedback loop for developers and contributors which frees up more time and focus on the code itself.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">Pre-commit : Protecting your future self (blog-post)</a>- pre-requisite reading if you are not already using <a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a></li>
<li><a href="https://ns-rse.github.io/pre-commit/" target="_blank">Pre-commit : Protecting your future self (slides)</a> - slides from a talk given at Research Computing at the University of Leeds that extended the above blog post to cover the material in this post (hit <code>s</code> to see the “speaker notes” <span class="emoji" data-emoji="wink">😉</span>).</li>
<li><a href="https://pre-commit.com" target="_blank"><code>pre-commit</code></a></li>
<li><a href="https://pre-commit.ci" target="_blank"><code>pre-commit.ci</code></a></li>
<li><a href="https://stackoverflow.com/collectives/articles/71270196/how-to-use-pre-commit-to-automatically-correct-commits-and-merge-requests-with-g" target="_blank">How to use pre-commit to automatically correct commits and merge requests with GitLab CI - Stack Overflow</a></li>
</ul>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2023,
  author = {Shephard, Neil},
  title = {Pre-Commit.ci : {Integrating} {Pre-Commit} into {CI/CD}},
  date = {2023-02-06},
  url = {https://blog.nshephard.dev/posts/pre-commit-ci/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2023" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2023. <span>“Pre-Commit.ci : Integrating Pre-Commit into
CI/CD.”</span> February 6, 2023. <a href="https://blog.nshephard.dev/posts/pre-commit-ci/">https://blog.nshephard.dev/posts/pre-commit-ci/</a>.
</div></div></section></div> ]]></description>
  <category>code</category>
  <category>analysis</category>
  <category>linting</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>pre-commit</category>
  <guid>https://blog.nshephard.dev/posts/pre-commit-ci/</guid>
  <pubDate>Mon, 06 Feb 2023 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52596382383_eefbf62543_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Who’s to Blame</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/whos_to_blame/</link>
  <description><![CDATA[ 





<p><a href="https://www.git-scm.com/docs/git-blame" target="_blank">Git blame</a> shows who made changes to which line of code for a given point in its history.</p>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>Git blame works on individual files and so requires a filename, there are a host of options, for example <code>-e</code> prints the authors email address <code>-w</code> ignores changes to white space and <code>-L 10,20</code> restricts output to the specified line range. If you want a the blame for a specific revision then you must include the hash.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> blame <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10,20 f923la git_blame.org</span></code></pre></div>
</section>
<section id="alias" class="level2">
<h2 class="anchored" data-anchor-id="alias">Alias</h2>
<p>Some people don’t like the pejorative nature of the word <code>blame</code>. That’s ok though, with a tweak to our configuration its possible to use the alias <code>praise</code> or simply <code>who</code>.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># blame alias</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> alias.praise blame</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> praise <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L1,30</span> git_blame.org</span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># who alias</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> alias.who blame</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> who <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L1,30</span> git_blame.org</span></code></pre></div>
<p>For more detailed information on the array of options refer to the <a href="https://www.git-scm.com/docs/git-blame" target="_blank">official documentation</a> or see <code>git blame --help</code>.</p>
</section>
<section id="ignoring-blame" class="level2">
<h2 class="anchored" data-anchor-id="ignoring-blame">Ignoring blame</h2>
<p>Sometimes the case arises where you want to ignore blame. Perhaps the most common example is when an existing code base has been <a href="../linting" target="_blank">linted</a> to conform to a particular style guide. Looking at who performed these changes is not informative and masks who made the changes and why. Its possible to ignore specific commits on the command line with <code>--ignore-revs &lt;hash&gt; &lt;file&gt;</code>, but it will quickly become tedious to remember to ignore all blame across multiple commits. Fortunately you can save the commits to ignore to the file <code>.git-blame-ignore-revs</code> (along with comments) so that they are stored. The full commit (40 characters) of hashes should be used.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PEP8 compliance for module X</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c00177a6121f86c001f338feff3280fd576fdbf3</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PEP8 compliance for module Y</span></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">db27fa5f18299ca631efc430512a3f358c2b154f</span></span></code></pre></div>
<p>Now that you have the revisions in place to be ignored when reporting blame you can choose not to use it.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> blame <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ignore-revs-file</span> .git-blame-ignore-revs git_blame.org</span></code></pre></div>
<p>…but this is tedious to remember to have to do each time and ideally others on your team should use this file too. You can configure Git to use this file by modifying the local configuration. Make sure to add it to your repository so that others can use it.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config blame.ignoreRevsFile .git-blame-ignore-revs</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .git-blame-ignore-revs</span></code></pre></div>
<p>As of <a href="https://github.com/orgs/community/discussions/5033#discussioncomment-2318478" target="_blank">2022-03-08</a> GitHub will also <a href="https://docs.github.com/en/repositories/working-with-files/using-files/viewing-a-file#ignore-commits-in-the-blame-view" target="_blank">ignore commits in the blame view</a> that are listed in <code>.git-blame-ignore-revs</code> providing this file is in the root of your project folder.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<section id="general" class="level3">
<h3 class="anchored" data-anchor-id="general">General</h3>
<ul>
<li><a href="https://www.atlassian.com/git/tutorials/inspecting-a-repository/git-blame" target="_blank">Atlassian | git blame</a></li>
</ul>
</section>
<section id="resources" class="level3">
<h3 class="anchored" data-anchor-id="resources">Resources</h3>
<ul>
<li><a href="https://www.moxio.com/blog/43/ignoring-bulk-change-commits-with-git-blame" target="_blank">Ignoring bulk change commits with git blame</a></li>
<li><a href="https://csswizardry.com/2017/05/little-things-i-like-to-do-with-git/#praise-people" target="_blank">Little things I like to do with Git</a></li>
<li><a href="https://stackoverflow.com/a/3959409/1444043" target="_blank">Is there a way to customize the output of git blame</a></li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2022,
  author = {Shephard, Neil},
  title = {Who’s to {Blame}},
  date = {2022-12-17},
  url = {https://blog.nshephard.dev/posts/whos_to_blame/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2022" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2022. <span>“Who’s to Blame.”</span> December 17, 2022.
<a href="https://blog.nshephard.dev/posts/whos_to_blame/">https://blog.nshephard.dev/posts/whos_to_blame/</a>.
</div></div></section></div> ]]></description>
  <category>code</category>
  <category>analysis</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>blame</category>
  <guid>https://blog.nshephard.dev/posts/whos_to_blame/</guid>
  <pubDate>Sat, 17 Dec 2022 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52065067830_734d0ebd51_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Pre-Commit : Customising and Updating</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/pre-commit-updates/</link>
  <description><![CDATA[ 





<p><a href="https://pre-commit.com/" target="_blank">Pre-commit</a> is a tool for running hooks prior to making commits to your Git history. If you’re not familiar with it then you may want to read the earlier post <a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">Pre-Commit : Protecting your future self</a>. This article discusses updating <code>pre-commit</code> and is prompted by a change in the <code>flake8</code> repository.</p>
<section id="pre-commit-hooks" class="level2">
<h2 class="anchored" data-anchor-id="pre-commit-hooks">Pre-commit hooks</h2>
<p>A lot of the power of <code>pre-commit</code> comes from the vast array of <a href="https://pre-commit.com/hooks.html" target="_blank">hooks</a> that are available that users make available. These are included under <code>repos:</code> section of the <code>.pre-commit-config.yaml</code> and typically require a minimum of the <code>repo:</code> and the <code>rev:</code> to use and then optionally a <code>hooks:</code> section. The <code>sample-config</code> that <code>pre-commit</code> will auto-generate looks like…</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v4.3.0</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> trailing-whitespace</span></span>
<span id="cb1-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> end-of-file-fixer</span></span>
<span id="cb1-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-yaml</span></span>
<span id="cb1-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-added-large-files</span></span></code></pre></div>
<p>After finding a repository and hook that you wish to use <a href="https://pre-commit.com/hooks.html" target="_blank">hooks</a> repository you need to add it to your <code>.pre-commit-config.yaml</code>. Here we add the <a href="https://github.com/PyCQA/pylint" target="_blank"><code>pylint</code></a> repository and whilst it only has one hook we explicitly add it.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb2-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v4.3.0</span></span>
<span id="cb2-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> trailing-whitespace</span></span>
<span id="cb2-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> end-of-file-fixer</span></span>
<span id="cb2-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-yaml</span></span>
<span id="cb2-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-added-large-files</span></span>
<span id="cb2-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/PyCQA/pylint</span></span>
<span id="cb2-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v2.15.5</span></span>
<span id="cb2-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb2-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pylint</span></span></code></pre></div>
<p>If a repository has more than one <code>hook</code> available then it can be enabled by listing its <code>id:</code> as is the case in the <code>hooks</code> above for the <code>pre-commit-hooks</code> repository.</p>
</section>
<section id="local-hooks" class="level2">
<h2 class="anchored" data-anchor-id="local-hooks">Local Hooks</h2>
<p>In some instances the provisioned repositories do not always meet the requirements. One example of this is the <a href="https://github.com/pycqa/pylint" target="_blank">pylint action</a> which parses the code-base to detect errors using <a href="https://pylint.pycqa.org/en/latest/" target="_blank">pylint</a>. Typically most Python packages have their own dependencies but because the Pylint action pulls down and uses its own virtual environment these packages are not installed. As a consequence <code>pylint</code> reports a lot of <code>import-error</code> as its unable to import the required dependencies.</p>
<p>The solution to this is to write a local hook, which instead of defining a GitHub repository as the <code>repo:</code> uses the value <code>local</code>. Thus to run <code>pylint</code> in a local environment from <code>pre-commit</code> you would add the following to your <code>.pre-commit-config.yaml</code></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb3-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v4.3.0</span></span>
<span id="cb3-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> trailing-whitespace</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> end-of-file-fixer</span></span>
<span id="cb3-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-yaml</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-added-large-files</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -   repo: https://github.com/PyCQA/pylint</span></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     rev: v2.15.5</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     hooks:</span></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     -   id: pylint</span></span>
<span id="cb3-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb3-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pylint</span></span>
<span id="cb3-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> PyLint</span></span>
<span id="cb3-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> python -m pylint.__main__</span></span>
<span id="cb3-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> system</span></span>
<span id="cb3-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">files</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> \.py$</span></span></code></pre></div>
<p>For this to work you would have to ensure that you have a virtual environment activated that includes the package dependencies, including <code>pylint</code>, when you make you <code>git commit</code> so that <code>pre-commit</code> can find and import all the required packages.</p>
</section>
<section id="updating-pre-commit" class="level2">
<h2 class="anchored" data-anchor-id="updating-pre-commit">Updating <code>pre-commit</code></h2>
<p>After adding a new repo and hook it will not be immediately ready to use as the environment has not been initialised. You can wait until your next commit or force this with the <code>autoupdate</code> option. This will update <em>all</em> repositories that are defined in your configuration.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> pre-commit autoupdate</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Updating</span> https://github.com/pre-commit/pre-commit-hooks ... updating v3.2.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> v4.3.0.</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Updating</span> https://github.com/PyCQA/pylint ... <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> Initializing environment for https://github.com/PyCQA/pylint.</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">already</span> up to date.</span></code></pre></div>
</section>
<section id="repository-changes" class="level2">
<h2 class="anchored" data-anchor-id="repository-changes">Repository Changes</h2>
<p>Sometimes, albeit rarely, repositories change their location as was the case recently when <a href="https://gitlab.com/PyCQA/flake8" target="_blank">flake8</a> moved from <a href="https://gitlab.com" target="_blank">GitLab</a> to <a href="https://github.com/PyCQA/flake8" target="_blank">GitHub</a>. As a consequence any <code>pre-commit</code> that uses <code>flake8</code> repo/hook and configured to run in Continuous Integration pipelines failed as it was unable to download and run the <code>flake8</code> environment. The solution is simply to update the <code>repo:</code>.</p>
<p>Before this change the entry for <code>flake8</code> looked like…</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://gitlab.com/pycqa/flake8.git</span></span>
<span id="cb5-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9.2</span></span>
<span id="cb5-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> flake8</span></span>
<span id="cb5-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">additional_dependencies</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flake8-print</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb5-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topostats"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tests"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb5-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span></code></pre></div>
<p>To update to use the new repository it should point to <code>github.com</code> as shown below.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pycqa/flake8.git</span></span>
<span id="cb6-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9.2</span></span>
<span id="cb6-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb6-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">   </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> flake8</span></span>
<span id="cb6-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">additional_dependencies</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flake8-print</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb6-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">args</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topostats"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tests"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb6-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span></code></pre></div>
<p>After making this change you have to <code>pre-commit autoupdate</code> to force downloading and updating from the new source, otherwise your existing older revision will be used locally.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://ns-rse.github.io/posts/pre-commit/" target="_blank">Pre-Commit : Protecting your future self</a></li>
<li><a href="https://pre-commit.com/" target="_blank">Pre-commit</a></li>
<li><a href="https://pre-commit.com/hooks.html" target="_blank">Pre-commit hooks</a></li>
<li><a href="https://github.com/PyCQA/pylint" target="_blank">pylint</a></li>
<li><a href="https://github.com/PyCQA/flake8" target="_blank">flake8</a></li>
</ul>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2022,
  author = {Shephard, Neil},
  title = {Pre-Commit : {Customising} and {Updating}},
  date = {2022-11-15},
  url = {https://blog.nshephard.dev/posts/pre-commit-updates/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2022" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2022. <span>“Pre-Commit : Customising and
Updating.”</span> November 15, 2022. <a href="https://blog.nshephard.dev/posts/pre-commit-updates/">https://blog.nshephard.dev/posts/pre-commit-updates/</a>.
</div></div></section></div> ]]></description>
  <category>code</category>
  <category>analysis</category>
  <category>linting</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>pre-commit</category>
  <guid>https://blog.nshephard.dev/posts/pre-commit-updates/</guid>
  <pubDate>Tue, 15 Nov 2022 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52358442614_416d014454_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Git : Custom SSH credentials for git repositories</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/git-ssh/</link>
  <description><![CDATA[ 





<p>How to configure individual Git repositories to use specific SSH keys. This is useful if you have more than one account on a forge, for example a personal and work account.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Typically when pushing and pulling changes to a forge such as <a href="https://github.com" target="_blank">GitHub</a>, <a href="https://gitlab.com" target="_blank">GitLab</a> or <a href="https://codeberg.org" target="_blank">Codeberg</a> you use an SSH (<em>S</em>ecure <em>SH</em>ell) key to authenticate that you have permission to access the repository.</p>
</section>
<section id="ssh-keys" class="level2">
<h2 class="anchored" data-anchor-id="ssh-keys">SSH Keys</h2>
<section id="concept" class="level3">
<h3 class="anchored" data-anchor-id="concept">Concept</h3>
<p>SSH keys are, in conjunction with “keychains”, used to save you having to enter a password each time you connect from one computer to another. They are generated on your computer and consist of two parts, a private key which remains on your computer and a public key which you place on remote computers you wish to connect to. There is a password associated with your key which is required to “unlock” your private key on your computer. Only an unlocked private key will match with a public key. Think of the public key as the lock on your front door, and the private key the key you carry on your traditional, physical, keychain/keyring. Only when the two match will things be unlocked, although you have to unlock your private key when you want to use it just as you have to get your keys out of your pocket (although “keychains” help with this).</p>
</section>
<section id="generation" class="level3">
<h3 class="anchored" data-anchor-id="generation">Generation</h3>
<p>There are different algorithms for generating SSH key pairs. DSA is no longer considered secure and RSA keys should have at least 2048-bits if not 4096-bits. A good choice these days is to use an elliptic curve based key such as ed25519 as they are shorter and faster. For more on why you should use this key see the article <a href="https://blog.g3rt.nl/upgrade-your-ssh-keys.html" target="_blank">Upgrade your SSH keys!</a>.</p>
<p>To generate a key use the following command entering a secure (i.e.&nbsp;<a href="xkcd.com/936/" target="_blank">long</a>) password.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssh-keygen</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> 100 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> ed25519</span></code></pre></div>
<p>You will be prompted for a filename to save your keys to, so you should know where to find them (the default is <code>~/.ssh/id_ed25519[.pub]</code>). You have a private key <code>~/.ssh/id_ed25519</code> and a public <code>~/.ssh/id_ed25519.pub</code> and we will use this to set up authentication on your Git Forge.</p>
</section>
<section id="forge-configuration" class="level3">
<h3 class="anchored" data-anchor-id="forge-configuration">Forge Configuration</h3>
<p>Under your account settings on your chosen Git Forge navigate to <em>Settings &gt; SSH and GPG Keys</em> and select <em>Add New Key</em> on (<a href="https://github.com/settings/keys" target="_blank">GitHub</a>). On GitLab navigate to <em>Preferences &gt; SSH Keys</em> <a href="https://gitlab.com/-/profile/keys" target="_blank">GitLab</a>), this page allows you to add a new key.</p>
<p>You need to copy and paste your public key into the <code>Key</code> box on these pages and give it a name (typically the hostname of your computer is a good choice). To view your public key simply use <code>cat</code> and copy and paste it. You can optionally choose to set an expiration date for your key which is good practice but means you have to generate new keys in the future.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> ~/.ssh/id_ed25519.pub</span></code></pre></div>
</section>
</section>
<section id="git-global-ssh-configuration" class="level2">
<h2 class="anchored" data-anchor-id="git-global-ssh-configuration">Git Global SSH Configuration</h2>
<p>Typically your global configuration for which key to use is set in <code>~/.ssh/config</code> with an entry similar to the below.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> github.com</span>
<span id="cb3-2">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User</span> git</span>
<span id="cb3-3">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Port</span> 22</span>
<span id="cb3-4">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PreferredAuthentications</span> publickey</span>
<span id="cb3-5">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IdentityFile</span> ~/.ssh/id_ed25519</span></code></pre></div>
<p>Here it uses the User name <code>git</code> on port <code>22</code>. The preferred authentication method is using a <code>publickey</code> and the private key used is stored locally at <code>~/.ssh/id_ed25519</code>.</p>
<p>When asked to connect to a forge using SSH (e.g.&nbsp;<code>git pull</code> or <code>git push</code>) will look through the <code>~/.ssh/config</code> file to see if there is a configuration section that matches the target and if so use the configuration defined there-in. You will then be prompted for your SSH private key password.</p>
<section id="what-are-keychains" class="level3">
<h3 class="anchored" data-anchor-id="what-are-keychains">What are Keychains?</h3>
<p>You may be wondering how an SSH key makes your life easier, you are still prompted to enter a password when trying to interact with a Git Forge, or use it in a more traditional manner to connect over SSH to another server. This is where the magic of a “keychain” steps in to make your life easier, you still have to enter a password but only once to add your SSH key to the “keychain”. Typically keychains are front-ends for interacting with and managing <a href="https://www.ssh.com/academy/ssh/agent" target="_blank">SSH agent</a>. The name is apt since you add your SSH key to the keychain once, typically on log-in, and are asked for your password to unlock it and then stores it in the SSH agent. Then each time SSH requires an SSH key it retrieves it from the keychain rather than prompting you for a password.</p>
<p>There are many different implementations of keychain such as the <a href="https://www.funtoo.org/Funtoo:Keychain" target="_blank">Funtoo Keychain Project</a>, <a href="https://wiki.gnome.org/Apps/Seahorse" target="_blank">Seahorse</a> the GNOME GUI management tool,</p>
</section>
</section>
<section id="git-per-repository-configuration" class="level2">
<h2 class="anchored" data-anchor-id="git-per-repository-configuration">Git Per Repository Configuration</h2>
<p>We now get to the meat of this post, how to configure individual repositories to use specific SSH keys. This may be desirable if you have two accounts on the same forge e.g.&nbsp;both on GitHub.com or both on GitLab.com? As of Git 2.10.0 you can configure each repository to use a specific key (<a href="https://superuser.com/a/912281" target="_blank">source</a>). At the command line…</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> a/git/repository</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config core.sshCommand <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ssh -i ~/.ssh/work_ed25519 -F /dev/null"</span></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--local</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Username"</span></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--local</span> user.email <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repos@username.com"</span></span></code></pre></div>
<p>This adds the following to the repositories configuration which is stored under <code>.git/config</code> and you can of course enter this directly to the configuration file yourself.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[core]</span></span>
<span id="cb5-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sshCommand</span> = ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> ~/.ssh/work_ed25519 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span> /dev/null</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[user]</span></span>
<span id="cb5-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span> = Username</span>
<span id="cb5-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span> = repos@username.com</span></code></pre></div>
<p>What is this doing? Well it’s instructing Git to run ssh using the private key file (with the <code>-i</code> flag to specify the <code>identity_file</code>) that is located at <code>~/.ssh/work_ed25519</code>. Providing you have…</p>
<ol type="a">
<li>Already uploaded the public key (<code>work_ed25519.pub</code>) to your GitHub account.</li>
<li>Stored this key in a Keychain as described above.</li>
</ol>
<p>…you shouldn’t be prompted for a password.</p>
<p>You can now configure, on a repository basis, which SSH key is used by Git when pushing/pulling changes from the remote <code>origin</code> (typically a forge such as GitHub, GitLab, Codeberg or so forth). If however you have multiple projects you wish to setup with an alternative SSH key configuration it can be tedious to configure each repository. Thankfully Git &gt;= 2.13 introduced <a href="https://git-scm.com/docs/git-config#_conditional_includes" target="_blank">Conditional includes</a> to the configuration.</p>
</section>
<section id="conditional-includes" class="level2">
<h2 class="anchored" data-anchor-id="conditional-includes">Conditional Includes</h2>
<p>You global configuration is stored in <code>~/.gitconfig</code> and defines key variables such <code>user</code> and <code>name</code>, the default <code>editor</code> and many other options, including a customised <code>sshCommand</code> as was added above to a local <code>.git/config</code> file.</p>
<p>Git 2.13 introduced the aforementioned <a href="https://git-scm.com/docs/git-config#_conditional_includes" target="_blank">Conditional includes</a> which works “_by setting a <code>includeIf.&lt;condition&gt;.path</code> variable to the name of the file to be included.”. For our current case-use the <code>&lt;condition&gt;</code> we are interested in is whether the <code>path</code>, which is interpreted as a pattern, is a <code>gitdir</code> then we include what follows.</p>
<p>For example, we place all of our work related Git repositories under the <code>~/work/</code> directory and wish to use <code>~/.ssh/work_ed25519</code> for these and keep all of our personal repositories elsewhere and wish to use our main <code>~/.ssh/id_ed25519</code> key for those.</p>
<p>Out <code>~/.gitconfig</code> should look like</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[user]</span></span>
<span id="cb6-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span> = Your Name</span>
<span id="cb6-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span> = your.personal@email.com</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[includeIf</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gitdir:~/work/"</span>]    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Directory paths ending in '/** has the globbing wildcard '**' added by default.</span></span>
<span id="cb6-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">path</span> = ~/work/.gitconfig_work</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[core]</span></span>
<span id="cb6-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sshCommand</span> = ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> ~/.ssh/id_ed25519 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span> /dev/null</span></code></pre></div>
<p>Then our <code>~/work/.gitconfig_work</code> can contain the alternative values we wish to use for all repositories under the <code>~/work/</code> directory.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[user]</span></span>
<span id="cb7-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span> = Your Name</span>
<span id="cb7-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span> = your.work@email.com</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[core]</span></span>
<span id="cb7-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sshCommand</span> = ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> ~/.ssh/work_ed25519 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span> /dev/null</span></code></pre></div>
</section>
<section id="commit-verification-with-ssh" class="level2">
<h2 class="anchored" data-anchor-id="commit-verification-with-ssh">Commit verification with SSH</h2>
<p>Verification of commits is a useful security feature, but beyond the scope of this article but as doing so with SSH keys is a recently supported feature on GitHub (see blog <a href="https://github.blog/changelog/2022-08-23-ssh-commit-verification-now-supported/" target="_blank">SSH commit verification now supported</a>) I felt it worth mentioning.</p>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<section id="ssh" class="level3">
<h3 class="anchored" data-anchor-id="ssh">SSH</h3>
<ul>
<li><a href="https://www.ssh.com/academy/ssh" target="_blank">SSH Academy</a></li>
<li><a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_1" target="_blank">OpenSSH Key Management, Part 1</a></li>
<li><a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_2" target="_blank">OpenSSH Key Management, Part 2</a></li>
<li><a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_3" target="_blank">OpenSSH Key Management, Part 3</a></li>
</ul>
</section>
<section id="forges" class="level3">
<h3 class="anchored" data-anchor-id="forges">Forges</h3>
<ul>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh" target="_blank">GitHub | Connect with SSH</a></li>
<li><a href="https://docs.gitlab.com/ee/user/ssh.html" target="_blank">GitLab | Use SSH keys to communicate with GitLab</a></li>
<li><a href="https://docs.codeberg.org/security/ssh-key/" target="_blank">Codeberg | Adding an SSH key to your account</a></li>
</ul>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2022,
  author = {Shephard, Neil},
  title = {Git : {Custom} {SSH} Credentials for Git Repositories},
  date = {2022-08-28},
  url = {https://blog.nshephard.dev/posts/git-ssh/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2022" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2022. <span>“Git : Custom SSH Credentials for Git
Repositories.”</span> August 28, 2022. <a href="https://blog.nshephard.dev/posts/git-ssh/">https://blog.nshephard.dev/posts/git-ssh/</a>.
</div></div></section></div> ]]></description>
  <category>ssh</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>keychain</category>
  <guid>https://blog.nshephard.dev/posts/git-ssh/</guid>
  <pubDate>Sun, 28 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/48816178863_85ee1fe7f1_k.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Pre-Commit : Protecting your future self</title>
  <dc:creator>Neil Shephard</dc:creator>
  <link>https://blog.nshephard.dev/posts/pre-commit/</link>
  <description><![CDATA[ 





<p><a href="https://pre-commit.com/" target="_blank">Pre-commit</a> is a powerful tool for executing a range of hooks prior to making commits to your Git history. This is useful because it means you can automatically run a range of linting tools on your code across an array of languages to ensure your code is up-to-scratch <em>before</em> you make the commit.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Pre-commit is written in Python but that isn’t a limitation as it will lint YAML, JSON, C, JavaScript, Go, Rust, TOML, Terraform, Jupyter Notebooks, and so on. The list of <a href="https://pre-commit.com/hooks.html" target="_blank">supported hooks</a> is vast.</p>
<p>For those unfamiliar with version control and Git in particular this will likely all sound alien. If you are new to the world of version control and Git I can highly recommend the <a href="https://srse-git-github-zero2hero.netlify.app/" target="_blank">Git &amp; Github through GitKraken Client - From Zero to Hero!</a> course offered by the <a href="https://rse.shef.ac.uk" target="_blank">Research Software Engineering</a> at the University of Sheffield and developed by Alumni <a href="https://www.r-rse.eu/" target="_blank">Anna Krystalli</a>.</p>
<section id="what-is-a-hook" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-hook">What is a “hook”?</h3>
<p>In computing a “hook” refers to something that is run prior to or in response to a requested action. In the context of the current discussion we are talking about hooks that relate to actions undertaken in Git version control and specifically actions that are run before a “commit” is made.</p>
<p>When you have initialised a directory to be under Git version control the settings and configuration are stored in the <code>.git/</code> sub-directory. There is the <code>.git/config</code> file for the repositories configuration but also the <code>.git/hooks/</code> directory that is populated with a host of <code>*.sample</code> files with various different names that give you an in-road into what different hooks you might want to run. Its worth spending a little time reading through these if you haven’t done so yet as they provide useful examples of how various hooks work.</p>
</section>
<section id="why-pre-commit-hooks" class="level3">
<h3 class="anchored" data-anchor-id="why-pre-commit-hooks">Why pre-commit hooks?</h3>
<p>Typically when writing code you should <a href="https://ns-rse.github.io/posts/linting/" target="_blank">lint</a> your code to ensure it conforms to agreed style guides and remove any “<a href="https://en.wikipedia.org/wiki/Code_smell" target="_blank">code smells</a>” that may be lingering (code that violates design principles). It won’t guarantee that your code is perfect but its a good starting point to improving it. People who write a lot of code have good habits of doing these checks manually prior to making commits. Experienced coders will have configured their Integrated Development Environment (IDE) to apply many such “hooks” on saving a file they have been working on.</p>
<p>At regular points in your workflow you save your work and check it into Git by making a commit and that is where <code>pre-commit</code> comes in to play because it will run all the hooks it has been configured to run against the files you are including in your commit. If any of the hooks fail then your commit is <em>not</em> made. In some cases <code>pre-commit</code> will automatically correct the errors (e.g.&nbsp;removing trailing white-space; applying <a href="https://github.com/psf/black" target="_blank">black</a> formatting if configured) but in others you have to correct them yourself before a commit can be successfully made.</p>
<p>Initially this can be jarring, but it saves you, and more importantly those who you are asking to review your code, time and effort. Your code meets the required style and is a little bit cleaner before being sent out for review. Long term linting your code is beneficial (see <a href="2022-04-19-linting" target="_blank">Linting - What is all the fluff about?</a>).</p>
</section>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Pre-commit is written in Python and so you will need Python installed on your system in order to use it. Aside from that there is little else extra that is required to be manually installed as pre-commit installs virtual environments specific for each enabled hook.</p>
<p>Most systems provide <code>pre-commit</code> in their package management system but typically you should install <code>pre-commit</code> within your virtual environment or under your user account.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install pre-commit</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> conda-forge pre-commit</span></code></pre></div>
<p>If you are working on a Python project then you should include <code>pre-commit</code> as a requirement (either in <code>requirements-dev.txt</code>) or under the <code>dev</code> section of <code>[options.extras_require]</code> in your <code>setup.cfg</code> as shown below.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[options.extras_require]</span></span>
<span id="cb2-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dev</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb2-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pre-commit</span></span>
<span id="cb2-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pytest</span></span>
<span id="cb2-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pytest-cov</span></span></code></pre></div>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<p>Configuration of pre-commit is via a file in the root of your Git version controlled directory called <code>.pre-commit-config.yaml</code>. This file should be included in your Git repository, you can create a blank file or <code>pre-commit</code> can generate a sample configuration for you.</p>
<pre class="{bash}"><code># Empty configuration
touch .pre-commit-config.yaml
# Auto-generate basic configuration
pre-commit sample-config &gt; .pre-commit-config.yaml
git add .pre-commit-config.yaml</code></pre>
<section id="hooks" class="level3">
<h3 class="anchored" data-anchor-id="hooks">Hooks</h3>
<p>Each hook is associated with a repository (<code>repo</code>) and a version (<code>rev</code>) within it. Many are available from the <code>https://github.com/pre-commit/pre-commit-hooks</code>. The default set of <code>pre-commit</code> hooks might look like the following.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb4-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb4-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v4.3.0</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> # Use the ref you want to point at</span></span>
<span id="cb4-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> trailing-whitespace</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> text</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb4-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-docstring-first</span></span>
<span id="cb4-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-case-conflict</span></span>
<span id="cb4-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> end-of-file-fixer</span></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb4-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> requirements-txt-fixer</span></span>
<span id="cb4-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> check-yaml</span></span></code></pre></div>
</section>
<section id="hooks-from-external-repositories" class="level3">
<h3 class="anchored" data-anchor-id="hooks-from-external-repositories">Hooks from External Repositories</h3>
<p>Some hooks are available from dedicated repositories, for example the following runs <a href="https://github.com/psf/black" target="_blank">Black</a>, <a href="https://flake8.pycqa.org/en/latest/" target="_blank">Flake8</a> and <a href="https://pylint.pycqa.org/en/latest/" target="_blank">Pylint</a> on your code and should follow under the above (with the same level of indenting to be valid YAML).</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/psf/black</span></span>
<span id="cb5-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22.6.0</span></span>
<span id="cb5-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> black</span></span>
<span id="cb5-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://gitlab.com/pycqa/flake8.git</span></span>
<span id="cb5-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9.2</span></span>
<span id="cb5-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> flake8</span></span>
<span id="cb5-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">additional_dependencies</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flake8-print</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb5-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb5-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> https://github.com/pycqa/pylint</span></span>
<span id="cb5-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v2.15.3</span></span>
<span id="cb5-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pylint</span></span></code></pre></div>
<p>An extensive list of <a href="https://pre-commit.com/hooks.html" target="_blank">supported hooks</a> is available. It lists the repository from which the hook is derived along with its name.</p>
</section>
<section id="local-hooks" class="level3">
<h3 class="anchored" data-anchor-id="local-hooks">Local Hooks</h3>
<p>You can also define <a href="https://pre-commit.com/#new-hooks" target="_blank">new hook</a> and configure them under the <code>- repo: local</code>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb6-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hooks</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb6-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;id&gt;</span></span>
<span id="cb6-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;descriptive name&gt;</span></span>
<span id="cb6-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">language</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> python</span></span>
<span id="cb6-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">entry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb6-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">types</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">python</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span></code></pre></div>
<p>For some examples of locally defined hooks see the <a href="https://github.com/pandas-dev/pandas/blob/main/.pre-commit-config.yaml" target="_blank">Pandas .pre-commit-config.yaml</a>.</p>
</section>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>Before <code>pre-commit</code> will run you need to install it within your repository. This puts the file <code>.git/hooks/pre-commit</code> in place that contains the hooks you have configured to run. To install this you should have your <code>.pre-commit-config.yaml</code> in place and then run the following.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pre-commit</span> install</span></code></pre></div>
<p>Once installed and configured there really isn’t much to be said for using <code>pre-commit</code>, just make commits and before you can make a successful commit <code>pre-commit</code> must run with all the hooks you have configured passing. By default <code>pre-commit</code> only runs on files that are staged and ready to be committed, if you have unstaged files these will be stashed prior to running the <code>pre-commit</code> hook and restored afterwards. Should you wish to run these manually without making a commit then, after activating a virtual environment if you are using one, simply make a <code>git commit</code> or you can run.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pre-commit</span> run</span></code></pre></div>
<p>If any of the configured hooks fail then the commit will not be made. Some hooks such as <a href="https://github.com/psf/black" target="_blank">black</a> may reformat files in place and you can then make another commit recording those changes and the hook should pass. Its important to pay close attention to the output.</p>
<p>If you want to run a specific hook you simply add the <code>&lt;id&gt;</code> after <code>run</code>.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pre-commit</span> run <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Or if you want to force running against all files (except unstaged ones) you can do so.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pre-commit</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--all-files</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Across all files/hooks</span></span></code></pre></div>
<p>And these two options can be combined to run a specific hook against all files.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pre-commit</span> run <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> --all-files</span></code></pre></div>
<p>You may find that you wish to switch branches to work on another feature or fix a bug but that your current work doesn’t pass the <code>pre-commit</code> and you don’t wish to sort that out immediately. The solution to this is to use <code>git stash</code> to temporarily save your current uncommitted work and restore the working directory and index to its previous state. You are then free to switch branches and work on another feature or fix a bug, commit and push those changes and then switch back.</p>
<p>Imagine you are working on branch <code>a</code> but are asked to fix a bug on branch <code>b</code>. You go to commit your work but find that <code>a</code> does not pass <code>pre-commit</code> but you wish to work on <code>b</code> anyway. Starting on branch <code>a</code> you stash your changes, switch branches, make and commit your changes to branch <code>b</code> then switch back to <code>a</code> and unstash your work there.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> stash</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout b</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Work on branch b</span></span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>changed_files_on_branch_b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fixing bug on branch b"</span></span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push</span>
<span id="cb12-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout a</span>
<span id="cb12-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> stash apply</span></code></pre></div>
</section>
<section id="updating" class="level2">
<h2 class="anchored" data-anchor-id="updating">Updating</h2>
<p>You can update hooks locally by running <code>pre-commit autoupdate</code>. This will update your <code>.pre-commit-config.yaml</code> with the latest version of repositories you have configured and these will run both locally and if you use CI/CD as described below. However this will <em>not</em> update any packages that are part of the <code>- repo: local</code> that you may have implemented and it is your responsibility to handle these.</p>
</section>
<section id="pre-commit-cicd" class="level2">
<h2 class="anchored" data-anchor-id="pre-commit-cicd">Pre-commit CI/CD</h2>
<p>Ideally contributors will have setup their system to work with pre-commit and be running such checks prior to making pushes. It is however useful to enable running pre-commit as part of your Continuous Integration/Development pipeline (CI/CD). This can be done with both <a href="https://gitlab.com" target="_blank">GitLab</a> and <a href="https://github.com" target="_blank">GitHub</a> although similar methods are available for many <a href="https://pre-commit.com/#usage-in-continuous-integration" target="_blank">continuous integration systems</a>.</p>
<section id="github" class="level3">
<h3 class="anchored" data-anchor-id="github">GitHub</h3>
<p>GitHub actions reside in the <code>.github/workflows/</code> directory of your project. A simple pre-commit action is available on the Marketplace at <a href="https://github.com/marketplace/actions/pre-commit" target="_blank">pre-commit/action</a>. Copy this template to <code>.github/workflows/pre-commit.yml</code> and include it in your Git repository.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .github/workflows/pre-commit.yml</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adding pre-commit GitHub Action"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push</span></code></pre></div>
</section>
<section id="gitlab" class="level3">
<h3 class="anchored" data-anchor-id="gitlab">GitLab</h3>
<p>If you use GitLab the following article describes how to configure a CI job to run as part of your repository.</p>
<ul>
<li><a href="https://stackoverflow.com/collectives/gitlab/articles/71270196/how-to-use-pre-commit-to-automatically-correct-commits-and-merge-requests-with-g" target="_blank">How to use pre-commit to automatically correct commits and merge requests with GitLab CI</a></li>
</ul>
</section>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://pre-commit.com/" target="_blank">Pre-commit</a></li>
<li><a href="https://pre-commit.com/hooks.html" target="_blank">Supported hooks</a></li>
<li><a href="https://github.com/marketplace/actions/pre-commit" target="_blank">GitHub Action</a></li>
<li><a href="https://stackoverflow.com/collectives/gitlab/articles/71270196/how-to-use-pre-commit-to-automatically-correct-commits-and-merge-requests-with-g" target="_blank">GitLab CI</a></li>
</ul>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{shephard2022,
  author = {Shephard, Neil},
  title = {Pre-Commit : {Protecting} Your Future Self},
  date = {2022-08-28},
  url = {https://blog.nshephard.dev/posts/pre-commit/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-shephard2022" class="csl-entry quarto-appendix-citeas">
Shephard, Neil. 2022. <span>“Pre-Commit : Protecting Your Future
Self.”</span> August 28, 2022. <a href="https://blog.nshephard.dev/posts/pre-commit/">https://blog.nshephard.dev/posts/pre-commit/</a>.
</div></div></section></div> ]]></description>
  <category>code</category>
  <category>analysis</category>
  <category>linting</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <category>pre-commit</category>
  <guid>https://blog.nshephard.dev/posts/pre-commit/</guid>
  <pubDate>Sun, 28 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://live.staticflickr.com/65535/52294716597_ea3be238c0_k.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
